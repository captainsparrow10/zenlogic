"use strict";(globalThis.webpackChunkerp_docs=globalThis.webpackChunkerp_docs||[]).push([[2572],{8453:(e,n,r)=>{r.d(n,{R:()=>o,x:()=>a});var s=r(6540);const t={},i=s.createContext(t);function o(e){const n=s.useContext(i);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:o(e.components),s.createElement(i.Provider,{value:n},e.children)}},8882:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>c,contentTitle:()=>a,default:()=>_,frontMatter:()=>o,metadata:()=>s,toc:()=>l});const s=JSON.parse('{"id":"deployment/docker-compose","title":"Docker Compose - Deployment Completo","description":"Configuraci\xf3n completa de Docker Compose para desplegar todo el sistema ERP con todos los microservicios e infraestructura.","source":"@site/docs/deployment/docker-compose.md","sourceDirName":"deployment","slug":"/deployment/docker-compose","permalink":"/zenlogic/deployment/docker-compose","draft":false,"unlisted":false,"editUrl":"https://github.com/your-repo/edit/main/docs/deployment/docker-compose.md","tags":[],"version":"current","sidebarPosition":1,"frontMatter":{"sidebar_position":1},"sidebar":"docs","previous":{"title":"PostgreSQL - Base de Datos","permalink":"/zenlogic/integraciones/postgresql"},"next":{"title":"Estrategia de Testing","permalink":"/zenlogic/testing/estrategia-testing"}}');var t=r(4848),i=r(8453);const o={sidebar_position:1},a="Docker Compose - Deployment Completo",c={},l=[{value:"Arquitectura de Deployment",id:"arquitectura-de-deployment",level:2},{value:"Docker Compose Completo",id:"docker-compose-completo",level:2},{value:"Scripts de Inicializaci\xf3n",id:"scripts-de-inicializaci\xf3n",level:2},{value:"init-scripts/01-create-databases.sql",id:"init-scripts01-create-databasessql",level:3},{value:"init-scripts/02-enable-extensions.sql",id:"init-scripts02-enable-extensionssql",level:3},{value:"Configuraci\xf3n de Nginx",id:"configuraci\xf3n-de-nginx",level:2},{value:"nginx/nginx.conf",id:"nginxnginxconf",level:3},{value:"Configuraci\xf3n de Prometheus",id:"configuraci\xf3n-de-prometheus",level:2},{value:"prometheus/prometheus.yml",id:"prometheusprometheusyml",level:3},{value:"Environment Variables (.env)",id:"environment-variables-env",level:2},{value:"Comandos de Deployment",id:"comandos-de-deployment",level:2},{value:"Iniciar todos los servicios",id:"iniciar-todos-los-servicios",level:3},{value:"Ver logs de un servicio espec\xedfico",id:"ver-logs-de-un-servicio-espec\xedfico",level:3},{value:"Reiniciar un servicio",id:"reiniciar-un-servicio",level:3},{value:"Escalar un servicio",id:"escalar-un-servicio",level:3},{value:"Ver estado de servicios",id:"ver-estado-de-servicios",level:3},{value:"Detener todos los servicios",id:"detener-todos-los-servicios",level:3},{value:"Detener y eliminar vol\xfamenes",id:"detener-y-eliminar-vol\xfamenes",level:3},{value:"Health Checks",id:"health-checks",level:2},{value:"Acceso a UIs",id:"acceso-a-uis",level:2},{value:"Troubleshooting",id:"troubleshooting",level:2},{value:"Ver logs de infraestructura",id:"ver-logs-de-infraestructura",level:3},{value:"Conectar a PostgreSQL",id:"conectar-a-postgresql",level:3},{value:"Conectar a Redis",id:"conectar-a-redis",level:3},{value:"Verificar conectividad entre servicios",id:"verificar-conectividad-entre-servicios",level:3},{value:"Pr\xf3ximos Pasos",id:"pr\xf3ximos-pasos",level:2}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",mermaid:"mermaid",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"docker-compose---deployment-completo",children:"Docker Compose - Deployment Completo"})}),"\n",(0,t.jsx)(n.p,{children:"Configuraci\xf3n completa de Docker Compose para desplegar todo el sistema ERP con todos los microservicios e infraestructura."}),"\n",(0,t.jsx)(n.h2,{id:"arquitectura-de-deployment",children:"Arquitectura de Deployment"}),"\n",(0,t.jsx)(n.mermaid,{value:'graph TB\n    subgraph "External"\n        Client[Cliente/Browser]\n    end\n\n    subgraph "Load Balancer"\n        Nginx[Nginx]\n    end\n\n    subgraph "Microservices"\n        Auth[Auth Service<br/>:8001]\n        Catalog[Catalog Service<br/>:8002]\n        Inventory[Inventory Service<br/>:8003]\n        Order[Order Service<br/>:8004]\n        Audit[Audit Service<br/>:8005]\n    end\n\n    subgraph "Infrastructure"\n        Postgres[(PostgreSQL<br/>:5432)]\n        Redis[(Redis<br/>:6379)]\n        RabbitMQ[RabbitMQ<br/>:5672, :15672]\n    end\n\n    Client --\x3e Nginx\n    Nginx --\x3e Auth\n    Nginx --\x3e Catalog\n    Nginx --\x3e Inventory\n    Nginx --\x3e Order\n    Nginx --\x3e Audit\n\n    Auth --\x3e Postgres\n    Catalog --\x3e Postgres\n    Inventory --\x3e Postgres\n    Order --\x3e Postgres\n    Audit --\x3e Postgres\n\n    Auth --\x3e Redis\n    Catalog --\x3e Redis\n    Inventory --\x3e Redis\n    Order --\x3e Redis\n\n    Auth --\x3e RabbitMQ\n    Catalog --\x3e RabbitMQ\n    Inventory --\x3e RabbitMQ\n    Order --\x3e RabbitMQ\n    Audit --\x3e RabbitMQ\n\n    Catalog -.gRPC.-> Auth\n    Inventory -.gRPC.-> Catalog\n    Inventory -.gRPC.-> Auth\n    Order -.gRPC.-> Catalog\n    Order -.gRPC.-> Inventory'}),"\n",(0,t.jsx)(n.h2,{id:"docker-compose-completo",children:"Docker Compose Completo"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:'version: \'3.8\'\n\nservices:\n  # ============================================================================\n  # Infrastructure Services\n  # ============================================================================\n\n  postgres:\n    image: postgres:15-alpine\n    container_name: erp-postgres\n    environment:\n      POSTGRES_USER: erp_user\n      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-erp_secure_password_123}\n      POSTGRES_DB: postgres\n    ports:\n      - "5432:5432"\n    volumes:\n      - postgres_data:/var/lib/postgresql/data\n      - ./init-scripts:/docker-entrypoint-initdb.d\n    networks:\n      - erp-network\n    healthcheck:\n      test: ["CMD-SHELL", "pg_isready -U erp_user"]\n      interval: 10s\n      timeout: 5s\n      retries: 5\n\n  redis:\n    image: redis:7.2-alpine\n    container_name: erp-redis\n    command: redis-server --requirepass ${REDIS_PASSWORD:-redis_secure_password_123}\n    ports:\n      - "6379:6379"\n    volumes:\n      - redis_data:/data\n    networks:\n      - erp-network\n    healthcheck:\n      test: ["CMD", "redis-cli", "ping"]\n      interval: 10s\n      timeout: 3s\n      retries: 5\n\n  rabbitmq:\n    image: rabbitmq:3.12-management-alpine\n    container_name: erp-rabbitmq\n    environment:\n      RABBITMQ_DEFAULT_USER: ${RABBITMQ_USER:-erp_user}\n      RABBITMQ_DEFAULT_PASS: ${RABBITMQ_PASSWORD:-rabbitmq_secure_password_123}\n      RABBITMQ_DEFAULT_VHOST: erp\n    ports:\n      - "5672:5672"   # AMQP\n      - "15672:15672" # Management UI\n    volumes:\n      - rabbitmq_data:/var/lib/rabbitmq\n      - ./rabbitmq/rabbitmq.conf:/etc/rabbitmq/rabbitmq.conf\n    networks:\n      - erp-network\n    healthcheck:\n      test: ["CMD", "rabbitmq-diagnostics", "ping"]\n      interval: 30s\n      timeout: 10s\n      retries: 5\n\n  # ============================================================================\n  # Auth Service\n  # ============================================================================\n\n  auth-service:\n    build:\n      context: ./services/auth-service\n      dockerfile: Dockerfile\n    container_name: erp-auth-service\n    environment:\n      # Database\n      DATABASE_URL: postgresql://erp_user:${POSTGRES_PASSWORD:-erp_secure_password_123}@postgres:5432/auth_db\n\n      # Redis\n      REDIS_URL: redis://:${REDIS_PASSWORD:-redis_secure_password_123}@redis:6379/0\n\n      # RabbitMQ\n      RABBITMQ_URL: amqp://${RABBITMQ_USER:-erp_user}:${RABBITMQ_PASSWORD:-rabbitmq_secure_password_123}@rabbitmq:5672/erp\n      RABBITMQ_EXCHANGE: auth_events\n\n      # Service Config\n      HTTP_PORT: 8001\n      GRPC_PORT: 50050\n      SERVICE_NAME: auth-service\n\n      # JWT\n      JWT_SECRET_KEY: ${JWT_SECRET_KEY:-your-secret-key-change-in-production}\n      JWT_ALGORITHM: HS256\n      JWT_ACCESS_TOKEN_EXPIRE_MINUTES: 30\n      JWT_REFRESH_TOKEN_EXPIRE_DAYS: 7\n\n      # Security\n      BCRYPT_ROUNDS: 12\n      MAX_LOGIN_ATTEMPTS: 5\n      LOCKOUT_DURATION_MINUTES: 30\n\n      # Environment\n      ENVIRONMENT: ${ENVIRONMENT:-development}\n      LOG_LEVEL: ${LOG_LEVEL:-INFO}\n    ports:\n      - "8001:8001"  # HTTP\n      - "50050:50050" # gRPC\n    depends_on:\n      postgres:\n        condition: service_healthy\n      redis:\n        condition: service_healthy\n      rabbitmq:\n        condition: service_healthy\n    networks:\n      - erp-network\n    volumes:\n      - ./logs/auth:/app/logs\n    healthcheck:\n      test: ["CMD", "curl", "-f", "http://localhost:8001/health"]\n      interval: 30s\n      timeout: 10s\n      retries: 3\n      start_period: 40s\n\n  # ============================================================================\n  # Catalog Service\n  # ============================================================================\n\n  catalog-service:\n    build:\n      context: ./services/catalog-service\n      dockerfile: Dockerfile\n    container_name: erp-catalog-service\n    environment:\n      # Database\n      DATABASE_URL: postgresql://erp_user:${POSTGRES_PASSWORD:-erp_secure_password_123}@postgres:5432/catalog_db\n\n      # Redis\n      REDIS_URL: redis://:${REDIS_PASSWORD:-redis_secure_password_123}@redis:6379/1\n      CACHE_TTL_SECONDS: 3600\n\n      # RabbitMQ\n      RABBITMQ_URL: amqp://${RABBITMQ_USER:-erp_user}:${RABBITMQ_PASSWORD:-rabbitmq_secure_password_123}@rabbitmq:5672/erp\n      RABBITMQ_EXCHANGE: catalog_events\n\n      # Service Config\n      HTTP_PORT: 8002\n      GRPC_PORT: 50052\n      SERVICE_NAME: catalog-service\n\n      # gRPC Clients\n      AUTH_GRPC_HOST: auth-service\n      AUTH_GRPC_PORT: 50050\n\n      # Environment\n      ENVIRONMENT: ${ENVIRONMENT:-development}\n      LOG_LEVEL: ${LOG_LEVEL:-INFO}\n    ports:\n      - "8002:8002"  # HTTP\n      - "50052:50052" # gRPC\n    depends_on:\n      postgres:\n        condition: service_healthy\n      redis:\n        condition: service_healthy\n      rabbitmq:\n        condition: service_healthy\n      auth-service:\n        condition: service_healthy\n    networks:\n      - erp-network\n    volumes:\n      - ./logs/catalog:/app/logs\n    healthcheck:\n      test: ["CMD", "curl", "-f", "http://localhost:8002/health"]\n      interval: 30s\n      timeout: 10s\n      retries: 3\n      start_period: 40s\n\n  # ============================================================================\n  # Inventory Service\n  # ============================================================================\n\n  inventory-service:\n    build:\n      context: ./services/inventory-service\n      dockerfile: Dockerfile\n    container_name: erp-inventory-service\n    environment:\n      # Database\n      DATABASE_URL: postgresql://erp_user:${POSTGRES_PASSWORD:-erp_secure_password_123}@postgres:5432/inventory_db\n\n      # Redis\n      REDIS_URL: redis://:${REDIS_PASSWORD:-redis_secure_password_123}@redis:6379/3\n\n      # RabbitMQ\n      RABBITMQ_URL: amqp://${RABBITMQ_USER:-erp_user}:${RABBITMQ_PASSWORD:-rabbitmq_secure_password_123}@rabbitmq:5672/erp\n      RABBITMQ_EXCHANGE: inventory_events\n      RABBITMQ_PREFETCH_COUNT: 10\n\n      # Service Config\n      HTTP_PORT: 8003\n      GRPC_PORT: 50053\n      SERVICE_NAME: inventory-service\n\n      # gRPC Clients\n      CATALOG_GRPC_HOST: catalog-service\n      CATALOG_GRPC_PORT: 50052\n      AUTH_GRPC_HOST: auth-service\n      AUTH_GRPC_PORT: 50050\n\n      # Business Logic\n      RESERVATION_TTL_MINUTES: 15\n      DEFAULT_MIN_STOCK: 20\n      DEFAULT_MAX_STOCK: 1000\n\n      # Environment\n      ENVIRONMENT: ${ENVIRONMENT:-development}\n      LOG_LEVEL: ${LOG_LEVEL:-INFO}\n    ports:\n      - "8003:8003"  # HTTP\n      - "50053:50053" # gRPC\n    depends_on:\n      postgres:\n        condition: service_healthy\n      redis:\n        condition: service_healthy\n      rabbitmq:\n        condition: service_healthy\n      catalog-service:\n        condition: service_healthy\n    networks:\n      - erp-network\n    volumes:\n      - ./logs/inventory:/app/logs\n    healthcheck:\n      test: ["CMD", "curl", "-f", "http://localhost:8003/health"]\n      interval: 30s\n      timeout: 10s\n      retries: 3\n      start_period: 40s\n\n  # ============================================================================\n  # Order Service\n  # ============================================================================\n\n  order-service:\n    build:\n      context: ./services/order-service\n      dockerfile: Dockerfile\n    container_name: erp-order-service\n    environment:\n      # Database\n      DATABASE_URL: postgresql://erp_user:${POSTGRES_PASSWORD:-erp_secure_password_123}@postgres:5432/order_db\n\n      # Redis\n      REDIS_URL: redis://:${REDIS_PASSWORD:-redis_secure_password_123}@redis:6379/4\n\n      # RabbitMQ\n      RABBITMQ_URL: amqp://${RABBITMQ_USER:-erp_user}:${RABBITMQ_PASSWORD:-rabbitmq_secure_password_123}@rabbitmq:5672/erp\n      RABBITMQ_EXCHANGE: order_events\n\n      # Service Config\n      HTTP_PORT: 8004\n      SERVICE_NAME: order-service\n\n      # gRPC Clients\n      CATALOG_GRPC_HOST: catalog-service\n      CATALOG_GRPC_PORT: 50052\n      INVENTORY_GRPC_HOST: inventory-service\n      INVENTORY_GRPC_PORT: 50053\n\n      # Payment Gateways\n      STRIPE_API_KEY: ${STRIPE_API_KEY:-sk_test_...}\n      STRIPE_WEBHOOK_SECRET: ${STRIPE_WEBHOOK_SECRET:-whsec_...}\n      PAYPAL_CLIENT_ID: ${PAYPAL_CLIENT_ID:-}\n      PAYPAL_CLIENT_SECRET: ${PAYPAL_CLIENT_SECRET:-}\n      PAYPAL_MODE: sandbox\n\n      # Shipping\n      FEDEX_API_KEY: ${FEDEX_API_KEY:-}\n      UPS_API_KEY: ${UPS_API_KEY:-}\n\n      # Business Logic\n      ORDER_RESERVATION_TTL_MINUTES: 15\n      FREE_SHIPPING_THRESHOLD: 50.00\n      DEFAULT_CURRENCY: USD\n\n      # Environment\n      ENVIRONMENT: ${ENVIRONMENT:-development}\n      LOG_LEVEL: ${LOG_LEVEL:-INFO}\n    ports:\n      - "8004:8004"  # HTTP\n    depends_on:\n      postgres:\n        condition: service_healthy\n      redis:\n        condition: service_healthy\n      rabbitmq:\n        condition: service_healthy\n      inventory-service:\n        condition: service_healthy\n    networks:\n      - erp-network\n    volumes:\n      - ./logs/order:/app/logs\n    healthcheck:\n      test: ["CMD", "curl", "-f", "http://localhost:8004/health"]\n      interval: 30s\n      timeout: 10s\n      retries: 3\n      start_period: 40s\n\n  # ============================================================================\n  # Audit Service\n  # ============================================================================\n\n  audit-service:\n    build:\n      context: ./services/audit-service\n      dockerfile: Dockerfile\n    container_name: erp-audit-service\n    environment:\n      # Database\n      DATABASE_URL: postgresql://erp_user:${POSTGRES_PASSWORD:-erp_secure_password_123}@postgres:5432/audit_db\n\n      # RabbitMQ (NO Redis - audit data is historical)\n      RABBITMQ_URL: amqp://${RABBITMQ_USER:-erp_user}:${RABBITMQ_PASSWORD:-rabbitmq_secure_password_123}@rabbitmq:5672/erp\n      RABBITMQ_PREFETCH_COUNT: 50\n\n      # Event Consumers\n      CONSUME_AUTH_EVENTS: "true"\n      CONSUME_CATALOG_EVENTS: "true"\n      CONSUME_INVENTORY_EVENTS: "true"\n      CONSUME_ORDER_EVENTS: "true"\n\n      # Service Config\n      HTTP_PORT: 8005\n      SERVICE_NAME: audit-service\n\n      # Retention Policy\n      AUDIT_RETENTION_DAYS: 2555  # 7 years\n      BATCH_INSERT_SIZE: 100\n      BATCH_TIMEOUT_SECONDS: 1\n\n      # Environment\n      ENVIRONMENT: ${ENVIRONMENT:-development}\n      LOG_LEVEL: ${LOG_LEVEL:-INFO}\n    ports:\n      - "8005:8005"  # HTTP\n    depends_on:\n      postgres:\n        condition: service_healthy\n      rabbitmq:\n        condition: service_healthy\n    networks:\n      - erp-network\n    volumes:\n      - ./logs/audit:/app/logs\n    healthcheck:\n      test: ["CMD", "curl", "-f", "http://localhost:8005/health"]\n      interval: 30s\n      timeout: 10s\n      retries: 3\n      start_period: 40s\n\n  # ============================================================================\n  # Nginx (Reverse Proxy / Load Balancer)\n  # ============================================================================\n\n  nginx:\n    image: nginx:alpine\n    container_name: erp-nginx\n    ports:\n      - "80:80"\n      - "443:443"\n    volumes:\n      - ./nginx/nginx.conf:/etc/nginx/nginx.conf:ro\n      - ./nginx/ssl:/etc/nginx/ssl:ro\n    depends_on:\n      - auth-service\n      - catalog-service\n      - inventory-service\n      - order-service\n      - audit-service\n    networks:\n      - erp-network\n    healthcheck:\n      test: ["CMD", "nginx", "-t"]\n      interval: 30s\n      timeout: 10s\n      retries: 3\n\n  # ============================================================================\n  # Monitoring & Observability\n  # ============================================================================\n\n  prometheus:\n    image: prom/prometheus:latest\n    container_name: erp-prometheus\n    command:\n      - \'--config.file=/etc/prometheus/prometheus.yml\'\n      - \'--storage.tsdb.path=/prometheus\'\n      - \'--web.console.libraries=/usr/share/prometheus/console_libraries\'\n      - \'--web.console.templates=/usr/share/prometheus/consoles\'\n    ports:\n      - "9090:9090"\n    volumes:\n      - ./prometheus/prometheus.yml:/etc/prometheus/prometheus.yml:ro\n      - prometheus_data:/prometheus\n    networks:\n      - erp-network\n    restart: unless-stopped\n\n  grafana:\n    image: grafana/grafana:latest\n    container_name: erp-grafana\n    environment:\n      GF_SECURITY_ADMIN_USER: ${GRAFANA_USER:-admin}\n      GF_SECURITY_ADMIN_PASSWORD: ${GRAFANA_PASSWORD:-admin}\n      GF_USERS_ALLOW_SIGN_UP: "false"\n    ports:\n      - "3000:3000"\n    volumes:\n      - grafana_data:/var/lib/grafana\n      - ./grafana/dashboards:/etc/grafana/provisioning/dashboards:ro\n      - ./grafana/datasources:/etc/grafana/provisioning/datasources:ro\n    networks:\n      - erp-network\n    depends_on:\n      - prometheus\n    restart: unless-stopped\n\n  jaeger:\n    image: jaegertracing/all-in-one:latest\n    container_name: erp-jaeger\n    environment:\n      COLLECTOR_ZIPKIN_HOST_PORT: ":9411"\n    ports:\n      - "5775:5775/udp"  # Zipkin compact\n      - "6831:6831/udp"  # Jaeger compact\n      - "6832:6832/udp"  # Jaeger binary\n      - "5778:5778"      # Config\n      - "16686:16686"    # Web UI\n      - "14268:14268"    # Jaeger collector\n      - "14250:14250"    # gRPC\n      - "9411:9411"      # Zipkin\n    networks:\n      - erp-network\n    restart: unless-stopped\n\n# ============================================================================\n# Networks\n# ============================================================================\n\nnetworks:\n  erp-network:\n    driver: bridge\n    ipam:\n      config:\n        - subnet: 172.20.0.0/16\n\n# ============================================================================\n# Volumes\n# ============================================================================\n\nvolumes:\n  postgres_data:\n    driver: local\n  redis_data:\n    driver: local\n  rabbitmq_data:\n    driver: local\n  prometheus_data:\n    driver: local\n  grafana_data:\n    driver: local\n'})}),"\n",(0,t.jsx)(n.h2,{id:"scripts-de-inicializaci\xf3n",children:"Scripts de Inicializaci\xf3n"}),"\n",(0,t.jsx)(n.h3,{id:"init-scripts01-create-databasessql",children:"init-scripts/01-create-databases.sql"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"-- Crear databases para cada microservicio\nCREATE DATABASE auth_db;\nCREATE DATABASE catalog_db;\nCREATE DATABASE inventory_db;\nCREATE DATABASE order_db;\nCREATE DATABASE audit_db;\n\n-- Grant permissions\nGRANT ALL PRIVILEGES ON DATABASE auth_db TO erp_user;\nGRANT ALL PRIVILEGES ON DATABASE catalog_db TO erp_user;\nGRANT ALL PRIVILEGES ON DATABASE inventory_db TO erp_user;\nGRANT ALL PRIVILEGES ON DATABASE order_db TO erp_user;\nGRANT ALL PRIVILEGES ON DATABASE audit_db TO erp_user;\n"})}),"\n",(0,t.jsx)(n.h3,{id:"init-scripts02-enable-extensionssql",children:"init-scripts/02-enable-extensions.sql"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:'-- Auth DB\n\\c auth_db;\nCREATE EXTENSION IF NOT EXISTS "uuid-ossp";\nCREATE EXTENSION IF NOT EXISTS "pgcrypto";\n\n-- Catalog DB\n\\c catalog_db;\nCREATE EXTENSION IF NOT EXISTS "uuid-ossp";\nCREATE EXTENSION IF NOT EXISTS "pg_trgm";  -- Para b\xfasqueda full-text\n\n-- Inventory DB\n\\c inventory_db;\nCREATE EXTENSION IF NOT EXISTS "uuid-ossp";\n\n-- Order DB\n\\c order_db;\nCREATE EXTENSION IF NOT EXISTS "uuid-ossp";\nCREATE EXTENSION IF NOT EXISTS "pgcrypto";\n\n-- Audit DB\n\\c audit_db;\nCREATE EXTENSION IF NOT EXISTS "uuid-ossp";\n'})}),"\n",(0,t.jsx)(n.h2,{id:"configuraci\xf3n-de-nginx",children:"Configuraci\xf3n de Nginx"}),"\n",(0,t.jsx)(n.h3,{id:"nginxnginxconf",children:"nginx/nginx.conf"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-nginx",children:'events {\n    worker_connections 1024;\n}\n\nhttp {\n    upstream auth_service {\n        least_conn;\n        server auth-service:8001 max_fails=3 fail_timeout=30s;\n    }\n\n    upstream catalog_service {\n        least_conn;\n        server catalog-service:8002 max_fails=3 fail_timeout=30s;\n    }\n\n    upstream inventory_service {\n        least_conn;\n        server inventory-service:8003 max_fails=3 fail_timeout=30s;\n    }\n\n    upstream order_service {\n        least_conn;\n        server order-service:8004 max_fails=3 fail_timeout=30s;\n    }\n\n    upstream audit_service {\n        least_conn;\n        server audit-service:8005 max_fails=3 fail_timeout=30s;\n    }\n\n    # Rate limiting\n    limit_req_zone $binary_remote_addr zone=api_limit:10m rate=100r/s;\n    limit_req_status 429;\n\n    server {\n        listen 80;\n        server_name localhost;\n\n        # Rate limiting\n        limit_req zone=api_limit burst=20 nodelay;\n\n        # Logging\n        access_log /var/log/nginx/access.log;\n        error_log /var/log/nginx/error.log;\n\n        # Auth Service\n        location /api/v1/auth/ {\n            proxy_pass http://auth_service/api/v1/;\n            proxy_set_header Host $host;\n            proxy_set_header X-Real-IP $remote_addr;\n            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n            proxy_set_header X-Forwarded-Proto $scheme;\n\n            # Timeouts\n            proxy_connect_timeout 30s;\n            proxy_send_timeout 30s;\n            proxy_read_timeout 30s;\n        }\n\n        # Catalog Service\n        location /api/v1/catalog/ {\n            proxy_pass http://catalog_service/api/v1/;\n            proxy_set_header Host $host;\n            proxy_set_header X-Real-IP $remote_addr;\n            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n            proxy_set_header X-Forwarded-Proto $scheme;\n        }\n\n        # Inventory Service\n        location /api/v1/inventory/ {\n            proxy_pass http://inventory_service/api/v1/;\n            proxy_set_header Host $host;\n            proxy_set_header X-Real-IP $remote_addr;\n            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n            proxy_set_header X-Forwarded-Proto $scheme;\n        }\n\n        # Order Service\n        location /api/v1/orders/ {\n            proxy_pass http://order_service/api/v1/;\n            proxy_set_header Host $host;\n            proxy_set_header X-Real-IP $remote_addr;\n            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n            proxy_set_header X-Forwarded-Proto $scheme;\n\n            # Longer timeout for order processing\n            proxy_read_timeout 60s;\n        }\n\n        # Audit Service\n        location /api/v1/audit/ {\n            proxy_pass http://audit_service/api/v1/;\n            proxy_set_header Host $host;\n            proxy_set_header X-Real-IP $remote_addr;\n            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n            proxy_set_header X-Forwarded-Proto $scheme;\n        }\n\n        # Health check endpoint\n        location /health {\n            access_log off;\n            return 200 "healthy\\n";\n            add_header Content-Type text/plain;\n        }\n    }\n}\n'})}),"\n",(0,t.jsx)(n.h2,{id:"configuraci\xf3n-de-prometheus",children:"Configuraci\xf3n de Prometheus"}),"\n",(0,t.jsx)(n.h3,{id:"prometheusprometheusyml",children:"prometheus/prometheus.yml"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:"global:\n  scrape_interval: 15s\n  evaluation_interval: 15s\n  external_labels:\n    cluster: 'erp-cluster'\n    environment: 'development'\n\nscrape_configs:\n  - job_name: 'auth-service'\n    static_configs:\n      - targets: ['auth-service:8001']\n    metrics_path: '/metrics'\n\n  - job_name: 'catalog-service'\n    static_configs:\n      - targets: ['catalog-service:8002']\n    metrics_path: '/metrics'\n\n  - job_name: 'inventory-service'\n    static_configs:\n      - targets: ['inventory-service:8003']\n    metrics_path: '/metrics'\n\n  - job_name: 'order-service'\n    static_configs:\n      - targets: ['order-service:8004']\n    metrics_path: '/metrics'\n\n  - job_name: 'audit-service'\n    static_configs:\n      - targets: ['audit-service:8005']\n    metrics_path: '/metrics'\n\n  - job_name: 'postgres'\n    static_configs:\n      - targets: ['postgres-exporter:9187']\n\n  - job_name: 'redis'\n    static_configs:\n      - targets: ['redis-exporter:9121']\n\n  - job_name: 'rabbitmq'\n    static_configs:\n      - targets: ['rabbitmq:15692']\n"})}),"\n",(0,t.jsx)(n.h2,{id:"environment-variables-env",children:"Environment Variables (.env)"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"# PostgreSQL\nPOSTGRES_PASSWORD=change_me_in_production_123\n\n# Redis\nREDIS_PASSWORD=change_me_in_production_456\n\n# RabbitMQ\nRABBITMQ_USER=erp_user\nRABBITMQ_PASSWORD=change_me_in_production_789\n\n# JWT\nJWT_SECRET_KEY=super_secret_jwt_key_change_in_production\n\n# Stripe\nSTRIPE_API_KEY=sk_test_your_stripe_key\nSTRIPE_WEBHOOK_SECRET=whsec_your_webhook_secret\n\n# PayPal\nPAYPAL_CLIENT_ID=your_paypal_client_id\nPAYPAL_CLIENT_SECRET=your_paypal_client_secret\n\n# Grafana\nGRAFANA_USER=admin\nGRAFANA_PASSWORD=admin\n\n# Environment\nENVIRONMENT=development\nLOG_LEVEL=INFO\n"})}),"\n",(0,t.jsx)(n.h2,{id:"comandos-de-deployment",children:"Comandos de Deployment"}),"\n",(0,t.jsx)(n.h3,{id:"iniciar-todos-los-servicios",children:"Iniciar todos los servicios"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"docker-compose up -d\n"})}),"\n",(0,t.jsx)(n.h3,{id:"ver-logs-de-un-servicio-espec\xedfico",children:"Ver logs de un servicio espec\xedfico"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"docker-compose logs -f order-service\n"})}),"\n",(0,t.jsx)(n.h3,{id:"reiniciar-un-servicio",children:"Reiniciar un servicio"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"docker-compose restart catalog-service\n"})}),"\n",(0,t.jsx)(n.h3,{id:"escalar-un-servicio",children:"Escalar un servicio"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"docker-compose up -d --scale order-service=3\n"})}),"\n",(0,t.jsx)(n.h3,{id:"ver-estado-de-servicios",children:"Ver estado de servicios"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"docker-compose ps\n"})}),"\n",(0,t.jsx)(n.h3,{id:"detener-todos-los-servicios",children:"Detener todos los servicios"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"docker-compose down\n"})}),"\n",(0,t.jsx)(n.h3,{id:"detener-y-eliminar-vol\xfamenes",children:"Detener y eliminar vol\xfamenes"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"docker-compose down -v\n"})}),"\n",(0,t.jsx)(n.h2,{id:"health-checks",children:"Health Checks"}),"\n",(0,t.jsx)(n.p,{children:"Verificar que todos los servicios est\xe1n saludables:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"# Auth Service\ncurl http://localhost:8001/health\n\n# Catalog Service\ncurl http://localhost:8002/health\n\n# Inventory Service\ncurl http://localhost:8003/health\n\n# Order Service\ncurl http://localhost:8004/health\n\n# Audit Service\ncurl http://localhost:8005/health\n\n# Nginx\ncurl http://localhost/health\n\n# RabbitMQ Management\ncurl http://localhost:15672\n\n# Prometheus\ncurl http://localhost:9090/-/healthy\n\n# Grafana\ncurl http://localhost:3000/api/health\n"})}),"\n",(0,t.jsx)(n.h2,{id:"acceso-a-uis",children:"Acceso a UIs"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"RabbitMQ Management"}),": ",(0,t.jsx)(n.a,{href:"http://localhost:15672",children:"http://localhost:15672"})," (user: erp_user, pass: ver .env)"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Prometheus"}),": ",(0,t.jsx)(n.a,{href:"http://localhost:9090",children:"http://localhost:9090"})]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Grafana"}),": ",(0,t.jsx)(n.a,{href:"http://localhost:3000",children:"http://localhost:3000"})," (user: admin, pass: admin)"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Jaeger UI"}),": ",(0,t.jsx)(n.a,{href:"http://localhost:16686",children:"http://localhost:16686"})]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"troubleshooting",children:"Troubleshooting"}),"\n",(0,t.jsx)(n.h3,{id:"ver-logs-de-infraestructura",children:"Ver logs de infraestructura"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"docker-compose logs postgres\ndocker-compose logs redis\ndocker-compose logs rabbitmq\n"})}),"\n",(0,t.jsx)(n.h3,{id:"conectar-a-postgresql",children:"Conectar a PostgreSQL"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"docker-compose exec postgres psql -U erp_user -d catalog_db\n"})}),"\n",(0,t.jsx)(n.h3,{id:"conectar-a-redis",children:"Conectar a Redis"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"docker-compose exec redis redis-cli -a redis_secure_password_123\n"})}),"\n",(0,t.jsx)(n.h3,{id:"verificar-conectividad-entre-servicios",children:"Verificar conectividad entre servicios"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"docker-compose exec order-service ping catalog-service\n"})}),"\n",(0,t.jsx)(n.h2,{id:"pr\xf3ximos-pasos",children:"Pr\xf3ximos Pasos"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"./deployment-produccion",children:"Deployment en Producci\xf3n"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"./ci-cd",children:"Configuraci\xf3n de CI/CD"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"./backup-restore",children:"Backup y Restore"})}),"\n"]})]})}function _(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(d,{...e})}):d(e)}}}]);