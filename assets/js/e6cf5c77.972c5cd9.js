"use strict";(globalThis.webpackChunkerp_docs=globalThis.webpackChunkerp_docs||[]).push([[1135],{7436:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>o,contentTitle:()=>d,default:()=>h,frontMatter:()=>c,metadata:()=>s,toc:()=>a});const s=JSON.parse('{"id":"microservicios/audit-service/alcance","title":"Alcance","description":"Definici\xf3n detallada de las responsabilidades del Audit Service.","source":"@site/docs/02-microservicios/audit-service/01-alcance.md","sourceDirName":"02-microservicios/audit-service","slug":"/microservicios/audit-service/alcance","permalink":"/zenlogic/microservicios/audit-service/alcance","draft":false,"unlisted":false,"editUrl":"https://github.com/your-repo/edit/main/docs/02-microservicios/audit-service/01-alcance.md","tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"sidebar_position":2},"sidebar":"docs","previous":{"title":"Overview - Audit Service","permalink":"/zenlogic/microservicios/audit-service/overview"},"next":{"title":"Arquitectura","permalink":"/zenlogic/microservicios/audit-service/arquitectura"}}');var l=i(4848),r=i(8453);const c={sidebar_position:2},d="Alcance",o={},a=[{value:"Funcionalidades Core",id:"funcionalidades-core",level:2},{value:"1. Consumo de Eventos",id:"1-consumo-de-eventos",level:3},{value:"2. Almacenamiento de Logs",id:"2-almacenamiento-de-logs",level:3},{value:"3. API de Consulta",id:"3-api-de-consulta",level:3},{value:"4. Retention Policy",id:"4-retention-policy",level:3},{value:"L\xedmites y Restricciones",id:"l\xedmites-y-restricciones",level:2},{value:"\u2705 Dentro del Alcance",id:"-dentro-del-alcance",level:3},{value:"\u274c Fuera del Alcance",id:"-fuera-del-alcance",level:3},{value:"Casos de Uso Detallados",id:"casos-de-uso-detallados",level:2},{value:"Caso 1: Investigar Cambio de Precio",id:"caso-1-investigar-cambio-de-precio",level:3},{value:"Caso 2: Compliance Report Mensual",id:"caso-2-compliance-report-mensual",level:3},{value:"Caso 3: Debugging de Bug",id:"caso-3-debugging-de-bug",level:3},{value:"Integraciones",id:"integraciones",level:2},{value:"Consumidas",id:"consumidas",level:3},{value:"Expuestas",id:"expuestas",level:3},{value:"M\xe9tricas de Performance",id:"m\xe9tricas-de-performance",level:2},{value:"SLAs",id:"slas",level:3},{value:"Capacidad",id:"capacidad",level:3},{value:"Dependencias",id:"dependencias",level:2},{value:"Cr\xedticas (Servicio no funciona sin ellas)",id:"cr\xedticas-servicio-no-funciona-sin-ellas",level:3},{value:"Opcionales (Degradaci\xf3n graceful)",id:"opcionales-degradaci\xf3n-graceful",level:3},{value:"Pr\xf3ximos Pasos",id:"pr\xf3ximos-pasos",level:2}];function t(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",mermaid:"mermaid",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(n.header,{children:(0,l.jsx)(n.h1,{id:"alcance",children:"Alcance"})}),"\n",(0,l.jsx)(n.p,{children:"Definici\xf3n detallada de las responsabilidades del Audit Service."}),"\n",(0,l.jsx)(n.h2,{id:"funcionalidades-core",children:"Funcionalidades Core"}),"\n",(0,l.jsx)(n.h3,{id:"1-consumo-de-eventos",children:"1. Consumo de Eventos"}),"\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.strong,{children:"Descripci\xf3n"}),": Escuchar y procesar todos los eventos del sistema."]}),"\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.strong,{children:"Eventos Consumidos"}),":"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-yaml",children:"Exchanges:\n  - auth_events (routing key: #)\n  - catalog_events (routing key: #)\n  - inventory_events (routing key: #)\n  - order_events (routing key: #)\n\nTotal: ~50+ tipos de eventos diferentes\n"})}),"\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.strong,{children:"Garant\xedas"}),":"]}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"At-least-once delivery"}),"\n",(0,l.jsx)(n.li,{children:"Procesamiento idempotente"}),"\n",(0,l.jsx)(n.li,{children:"Sin p\xe9rdida de eventos"}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"2-almacenamiento-de-logs",children:"2. Almacenamiento de Logs"}),"\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.strong,{children:"Descripci\xf3n"}),": Persistir eventos en PostgreSQL de forma inmutable."]}),"\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.strong,{children:"Datos Almacenados"}),":"]}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Event type"}),"\n",(0,l.jsx)(n.li,{children:"Timestamp"}),"\n",(0,l.jsx)(n.li,{children:"Service origen"}),"\n",(0,l.jsx)(n.li,{children:"Payload completo"}),"\n",(0,l.jsx)(n.li,{children:"Metadata (user_id, organization_id, IP, etc.)"}),"\n"]}),"\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.strong,{children:"Caracter\xedsticas"}),":"]}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Logs inmutables (no UPDATE, no DELETE)"}),"\n",(0,l.jsx)(n.li,{children:"Particionamiento por mes"}),"\n",(0,l.jsx)(n.li,{children:"\xcdndices optimizados"}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"3-api-de-consulta",children:"3. API de Consulta"}),"\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.strong,{children:"Endpoints"}),":"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:"GET /api/v1/logs\nGET /api/v1/logs/{id}\nGET /api/v1/logs/timeline\nGET /api/v1/logs/stats\n"})}),"\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.strong,{children:"Filtros Soportados"}),":"]}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Por rango de fechas"}),"\n",(0,l.jsx)(n.li,{children:"Por usuario"}),"\n",(0,l.jsx)(n.li,{children:"Por organizaci\xf3n"}),"\n",(0,l.jsx)(n.li,{children:"Por servicio"}),"\n",(0,l.jsx)(n.li,{children:"Por tipo de evento"}),"\n",(0,l.jsx)(n.li,{children:"Por entidad (product_id, user_id, etc.)"}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"4-retention-policy",children:"4. Retention Policy"}),"\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.strong,{children:"Descripci\xf3n"}),": Gesti\xf3n autom\xe1tica del ciclo de vida de logs."]}),"\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.strong,{children:"Pol\xedticas"}),":"]}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Logs activos: 90 d\xedas"}),"\n",(0,l.jsx)(n.li,{children:"Logs archivados: 2 a\xf1os"}),"\n",(0,l.jsx)(n.li,{children:"Despu\xe9s de 2 a\xf1os: Eliminaci\xf3n o S3"}),"\n"]}),"\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.strong,{children:"Automatizaci\xf3n"}),":"]}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Cronjob diario para archivado"}),"\n",(0,l.jsx)(n.li,{children:"Compresi\xf3n de logs antiguos"}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"l\xedmites-y-restricciones",children:"L\xedmites y Restricciones"}),"\n",(0,l.jsx)(n.h3,{id:"-dentro-del-alcance",children:"\u2705 Dentro del Alcance"}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Registro de Eventos"})}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Todos los eventos de negocio"}),"\n",(0,l.jsx)(n.li,{children:"Eventos de autenticaci\xf3n"}),"\n",(0,l.jsx)(n.li,{children:"Eventos de cambios de datos"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Consultas de Auditor\xeda"})}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"B\xfasqueda por m\xfaltiples criterios"}),"\n",(0,l.jsx)(n.li,{children:"Timeline de eventos"}),"\n",(0,l.jsx)(n.li,{children:"Estad\xedsticas agregadas"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Gesti\xf3n de Datos"})}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Retenci\xf3n autom\xe1tica"}),"\n",(0,l.jsx)(n.li,{children:"Archivado"}),"\n",(0,l.jsx)(n.li,{children:"Exportaci\xf3n de logs"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"-fuera-del-alcance",children:"\u274c Fuera del Alcance"}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"No es un Sistema de Logging T\xe9cnico"})}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"No captura logs de aplicaci\xf3n (stdout/stderr)"}),"\n",(0,l.jsx)(n.li,{children:"No reemplaza a Elasticsearch/Kibana"}),"\n",(0,l.jsx)(n.li,{children:"Solo eventos de negocio"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"No es Analytics"})}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"No genera dashboards complejos"}),"\n",(0,l.jsx)(n.li,{children:"No hace predicciones"}),"\n",(0,l.jsx)(n.li,{children:"Solo consultas hist\xf3ricas"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"No es Backup"})}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"No respalda datos de otros servicios"}),"\n",(0,l.jsx)(n.li,{children:"Solo registra eventos"}),"\n",(0,l.jsx)(n.li,{children:"No restaura estado de otros servicios"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"No Valida Negocio"})}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"No valida eventos antes de guardar"}),"\n",(0,l.jsx)(n.li,{children:"Solo registra lo que recibe"}),"\n",(0,l.jsx)(n.li,{children:"No rechaza eventos inv\xe1lidos"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"casos-de-uso-detallados",children:"Casos de Uso Detallados"}),"\n",(0,l.jsx)(n.h3,{id:"caso-1-investigar-cambio-de-precio",children:"Caso 1: Investigar Cambio de Precio"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:'Situaci\xf3n:\n- Admin nota que precio de producto cambi\xf3\n- Necesita saber qui\xe9n y cu\xe1ndo\n\nSoluci\xf3n:\nGET /api/v1/logs?entity_type=product&entity_id={id}&event_type=catalog.product.updated\n\nResultado:\n[\n  {\n    "timestamp": "2025-11-23T10:00:00Z",\n    "user_id": "user-123",\n    "event_type": "catalog.product.updated",\n    "payload": {\n      "changes": {\n        "base_price": {"old": 19.99, "new": 29.99}\n      }\n    }\n  }\n]\n'})}),"\n",(0,l.jsx)(n.h3,{id:"caso-2-compliance-report-mensual",children:"Caso 2: Compliance Report Mensual"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:"Situaci\xf3n:\n- Necesidad regulatoria de reportar todos los accesos\n- Generar CSV de logins del mes\n\nSoluci\xf3n:\nGET /api/v1/logs?event_type=auth.session.created&start_date=2025-11-01&end_date=2025-11-30&format=csv\n\nResultado:\n- CSV con todos los logins del mes\n- Incluye: fecha, usuario, IP, resultado\n"})}),"\n",(0,l.jsx)(n.h3,{id:"caso-3-debugging-de-bug",children:"Caso 3: Debugging de Bug"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:"Situaci\xf3n:\n- Usuario reporta que su rol perdi\xf3 permisos\n- Developer necesita ver secuencia de eventos\n\nSoluci\xf3n:\nGET /api/v1/logs/timeline?user_id={id}&start_date={date}\n\nResultado:\n- Timeline cronol\xf3gico de todos los eventos del usuario\n- Incluye: roles asignados, permisos cambiados, etc.\n"})}),"\n",(0,l.jsx)(n.h2,{id:"integraciones",children:"Integraciones"}),"\n",(0,l.jsx)(n.h3,{id:"consumidas",children:"Consumidas"}),"\n",(0,l.jsx)(n.mermaid,{value:"graph LR\n    RabbitMQ[RabbitMQ] --\x3e|Eventos| AuditService[Audit Service]"}),"\n",(0,l.jsx)(n.h3,{id:"expuestas",children:"Expuestas"}),"\n",(0,l.jsx)(n.mermaid,{value:"graph LR\n    AuditService[Audit Service] --\x3e|REST API| AdminPanel[Admin Panel]\n    AuditService --\x3e|REST API| ReportingTool[Reporting Tool]"}),"\n",(0,l.jsx)(n.h2,{id:"m\xe9tricas-de-performance",children:"M\xe9tricas de Performance"}),"\n",(0,l.jsx)(n.h3,{id:"slas",children:"SLAs"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Latencia de ingesta"}),": < 100ms por evento"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Throughput"}),": 1000 eventos/segundo"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Latencia de query"}),": < 500ms (p95)"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Disponibilidad"}),": 99.5%"]}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"capacidad",children:"Capacidad"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Volumen estimado"}),": 100K eventos/d\xeda"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Retenci\xf3n"}),": 90 d\xedas activo = 9M eventos"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Tama\xf1o DB"}),": ~5GB por 90 d\xedas"]}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"dependencias",children:"Dependencias"}),"\n",(0,l.jsx)(n.h3,{id:"cr\xedticas-servicio-no-funciona-sin-ellas",children:"Cr\xedticas (Servicio no funciona sin ellas)"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"PostgreSQL"}),"\n",(0,l.jsx)(n.li,{children:"RabbitMQ"}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"opcionales-degradaci\xf3n-graceful",children:"Opcionales (Degradaci\xf3n graceful)"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Redis (cache de queries)"}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"pr\xf3ximos-pasos",children:"Pr\xf3ximos Pasos"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"/microservicios/audit-service/arquitectura",children:"Arquitectura"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"/microservicios/audit-service/modelo-datos",children:"Modelo de Datos"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"/microservicios/audit-service/event-consumer",children:"Event Consumer"})}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,l.jsx)(n,{...e,children:(0,l.jsx)(t,{...e})}):t(e)}},8453:(e,n,i)=>{i.d(n,{R:()=>c,x:()=>d});var s=i(6540);const l={},r=s.createContext(l);function c(e){const n=s.useContext(r);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(l):e.components||l:c(e.components),s.createElement(r.Provider,{value:n},e.children)}}}]);