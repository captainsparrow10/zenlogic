"use strict";(globalThis.webpackChunkerp_docs=globalThis.webpackChunkerp_docs||[]).push([[5393],{8453:(e,n,t)=>{t.d(n,{R:()=>o,x:()=>i});var s=t(6540);const a={},r=s.createContext(a);function o(e){const n=s.useContext(r);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:o(e.components),s.createElement(r.Provider,{value:n},e.children)}},9105:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>i,default:()=>l,frontMatter:()=>o,metadata:()=>s,toc:()=>d});const s=JSON.parse('{"id":"guias/testing","title":"Testing","description":"Estrategias y mejores pr\xe1cticas de testing para zenLogic.","source":"@site/docs/05-guias/02-testing.md","sourceDirName":"05-guias","slug":"/guias/testing","permalink":"/zenlogic/guias/testing","draft":false,"unlisted":false,"editUrl":"https://github.com/your-repo/edit/main/docs/05-guias/02-testing.md","tags":[],"version":"current","sidebarPosition":3,"frontMatter":{"sidebar_position":3},"sidebar":"docs","previous":{"title":"Crear un Nuevo Microservicio","permalink":"/zenlogic/guias/crear-microservicio"},"next":{"title":"Deployment","permalink":"/zenlogic/guias/deployment"}}');var a=t(4848),r=t(8453);const o={sidebar_position:3},i="Testing",c={},d=[{value:"Stack de Testing",id:"stack-de-testing",level:2},{value:"Estructura de Tests",id:"estructura-de-tests",level:2},{value:"Configuraci\xf3n (conftest.py)",id:"configuraci\xf3n-conftestpy",level:2},{value:"Tests Unitarios",id:"tests-unitarios",level:2},{value:"Modelos",id:"modelos",level:3},{value:"Schemas",id:"schemas",level:3},{value:"Services",id:"services",level:3},{value:"Tests de Integraci\xf3n",id:"tests-de-integraci\xf3n",level:2},{value:"API Endpoints",id:"api-endpoints",level:3},{value:"Database",id:"database",level:3},{value:"Tests E2E",id:"tests-e2e",level:2},{value:"Factories",id:"factories",level:2},{value:"Coverage",id:"coverage",level:2},{value:"CI/CD Integration",id:"cicd-integration",level:2},{value:"Pr\xf3ximos Pasos",id:"pr\xf3ximos-pasos",level:2}];function p(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,r.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.header,{children:(0,a.jsx)(n.h1,{id:"testing",children:"Testing"})}),"\n",(0,a.jsx)(n.p,{children:"Estrategias y mejores pr\xe1cticas de testing para zenLogic."}),"\n",(0,a.jsx)(n.h2,{id:"stack-de-testing",children:"Stack de Testing"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"pytest==7.4.3           # Framework de testing\npytest-asyncio==0.21.1  # Soporte async\npytest-cov==4.1.0       # Coverage\nhttpx==0.25.2           # HTTP client async\nfaker==20.1.0           # Fake data\nfactory-boy==3.3.0      # Test fixtures\n"})}),"\n",(0,a.jsx)(n.h2,{id:"estructura-de-tests",children:"Estructura de Tests"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:"tests/\n\u251c\u2500\u2500 __init__.py\n\u251c\u2500\u2500 conftest.py          # Fixtures compartidos\n\u251c\u2500\u2500 unit/                # Tests unitarios\n\u2502   \u251c\u2500\u2500 test_models.py\n\u2502   \u251c\u2500\u2500 test_schemas.py\n\u2502   \u2514\u2500\u2500 test_services.py\n\u251c\u2500\u2500 integration/         # Tests de integraci\xf3n\n\u2502   \u251c\u2500\u2500 test_api.py\n\u2502   \u251c\u2500\u2500 test_database.py\n\u2502   \u2514\u2500\u2500 test_events.py\n\u2514\u2500\u2500 e2e/                 # Tests end-to-end\n    \u2514\u2500\u2500 test_flows.py\n"})}),"\n",(0,a.jsx)(n.h2,{id:"configuraci\xf3n-conftestpy",children:"Configuraci\xf3n (conftest.py)"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-python",children:'# tests/conftest.py\nimport pytest\nimport asyncio\nfrom httpx import AsyncClient\nfrom sqlalchemy.ext.asyncio import create_async_engine, AsyncSession\nfrom sqlalchemy.orm import sessionmaker\n\nfrom app.main import app\nfrom app.database import Base, get_db\nfrom app.config import settings\n\n# Test database URL\nTEST_DATABASE_URL = "postgresql+asyncpg://test_user:test_pass@localhost:5432/test_db"\n\n# Test engine\ntest_engine = create_async_engine(TEST_DATABASE_URL, echo=False)\n\n# Test session factory\nTestSessionLocal = sessionmaker(\n    test_engine,\n    class_=AsyncSession,\n    expire_on_commit=False\n)\n\n@pytest.fixture(scope="session")\ndef event_loop():\n    """Event loop para tests async."""\n    loop = asyncio.get_event_loop_policy().new_event_loop()\n    yield loop\n    loop.close()\n\n@pytest.fixture(scope="function")\nasync def db_session():\n    """Sesi\xf3n de DB para tests."""\n\n    # Crear tablas\n    async with test_engine.begin() as conn:\n        await conn.run_sync(Base.metadata.create_all)\n\n    # Sesi\xf3n\n    async with TestSessionLocal() as session:\n        yield session\n\n    # Drop tablas\n    async with test_engine.begin() as conn:\n        await conn.run_sync(Base.metadata.drop_all)\n\n@pytest.fixture\nasync def client(db_session):\n    """HTTP client para tests."""\n\n    # Override dependency\n    async def override_get_db():\n        yield db_session\n\n    app.dependency_overrides[get_db] = override_get_db\n\n    async with AsyncClient(app=app, base_url="http://test") as ac:\n        yield ac\n\n    app.dependency_overrides.clear()\n\n@pytest.fixture\ndef fake_user():\n    """Usuario de prueba."""\n    from faker import Faker\n    fake = Faker()\n\n    return {\n        "email": fake.email(),\n        "password": "Test123!",\n        "full_name": fake.name()\n    }\n'})}),"\n",(0,a.jsx)(n.h2,{id:"tests-unitarios",children:"Tests Unitarios"}),"\n",(0,a.jsx)(n.h3,{id:"modelos",children:"Modelos"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-python",children:'# tests/unit/test_models.py\nimport pytest\nfrom app.models.product import Product\n\n@pytest.mark.asyncio\nasync def test_product_model():\n    """Test modelo Product."""\n\n    product = Product(\n        name="Test Product",\n        sku="TEST-001",\n        base_price=19.99,\n        organization_id="org-uuid"\n    )\n\n    assert product.name == "Test Product"\n    assert product.sku == "TEST-001"\n    assert product.base_price == 19.99\n\ndef test_product_dict():\n    """Test serializaci\xf3n a dict."""\n\n    product = Product(\n        name="Test Product",\n        sku="TEST-001",\n        base_price=19.99\n    )\n\n    product_dict = product.dict()\n\n    assert "name" in product_dict\n    assert product_dict["name"] == "Test Product"\n'})}),"\n",(0,a.jsx)(n.h3,{id:"schemas",children:"Schemas"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-python",children:'# tests/unit/test_schemas.py\nimport pytest\nfrom pydantic import ValidationError\nfrom app.schemas.product import ProductCreate\n\ndef test_product_create_valid():\n    """Test schema v\xe1lido."""\n\n    data = {\n        "name": "Test Product",\n        "sku": "TEST-001",\n        "base_price": 19.99,\n        "organization_id": "org-uuid"\n    }\n\n    product = ProductCreate(**data)\n\n    assert product.name == "Test Product"\n    assert product.base_price == 19.99\n\ndef test_product_create_invalid_price():\n    """Test validaci\xf3n de precio."""\n\n    data = {\n        "name": "Test Product",\n        "sku": "TEST-001",\n        "base_price": -10.0,  # \u274c Precio negativo\n        "organization_id": "org-uuid"\n    }\n\n    with pytest.raises(ValidationError):\n        ProductCreate(**data)\n'})}),"\n",(0,a.jsx)(n.h3,{id:"services",children:"Services"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-python",children:'# tests/unit/test_services.py\nimport pytest\nfrom unittest.mock import Mock, AsyncMock\nfrom app.services.product_service import ProductService\n\n@pytest.mark.asyncio\nasync def test_create_product():\n    """Test crear producto."""\n\n    # Mock repository\n    mock_repo = Mock()\n    mock_repo.create = AsyncMock(return_value={\n        "id": "prod-uuid",\n        "name": "Test Product",\n        "sku": "TEST-001"\n    })\n\n    # Service con mock\n    service = ProductService(repository=mock_repo)\n\n    # Crear\n    product = await service.create({\n        "name": "Test Product",\n        "sku": "TEST-001",\n        "base_price": 19.99\n    })\n\n    # Assertions\n    assert product["name"] == "Test Product"\n    mock_repo.create.assert_called_once()\n'})}),"\n",(0,a.jsx)(n.h2,{id:"tests-de-integraci\xf3n",children:"Tests de Integraci\xf3n"}),"\n",(0,a.jsx)(n.h3,{id:"api-endpoints",children:"API Endpoints"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-python",children:'# tests/integration/test_api.py\nimport pytest\n\n@pytest.mark.asyncio\nasync def test_create_product_endpoint(client, db_session):\n    """Test POST /products."""\n\n    product_data = {\n        "name": "Test Product",\n        "sku": "TEST-001",\n        "base_price": 19.99,\n        "organization_id": "org-uuid"\n    }\n\n    response = await client.post("/api/v1/products", json=product_data)\n\n    assert response.status_code == 201\n    data = response.json()\n    assert data["name"] == "Test Product"\n    assert "id" in data\n\n@pytest.mark.asyncio\nasync def test_get_products_pagination(client, db_session):\n    """Test paginaci\xf3n de productos."""\n\n    # Crear productos\n    for i in range(10):\n        await client.post("/api/v1/products", json={\n            "name": f"Product {i}",\n            "sku": f"PROD-{i:03d}",\n            "base_price": 10.0 + i,\n            "organization_id": "org-uuid"\n        })\n\n    # Listar con paginaci\xf3n\n    response = await client.get("/api/v1/products?limit=5")\n\n    assert response.status_code == 200\n    data = response.json()\n    assert len(data["data"]) == 5\n    assert data["page_info"]["has_next_page"] is True\n'})}),"\n",(0,a.jsx)(n.h3,{id:"database",children:"Database"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-python",children:'# tests/integration/test_database.py\nimport pytest\nfrom sqlalchemy import select\nfrom app.models.product import Product\n\n@pytest.mark.asyncio\nasync def test_database_crud(db_session):\n    """Test CRUD en database."""\n\n    # Create\n    product = Product(\n        name="Test Product",\n        sku="TEST-001",\n        base_price=19.99,\n        organization_id="org-uuid"\n    )\n    db_session.add(product)\n    await db_session.commit()\n\n    # Read\n    result = await db_session.execute(\n        select(Product).where(Product.sku == "TEST-001")\n    )\n    found = result.scalar_one()\n\n    assert found.name == "Test Product"\n\n    # Update\n    found.base_price = 29.99\n    await db_session.commit()\n\n    # Delete\n    await db_session.delete(found)\n    await db_session.commit()\n\n    # Verify deleted\n    result = await db_session.execute(\n        select(Product).where(Product.sku == "TEST-001")\n    )\n    assert result.scalar_one_or_none() is None\n'})}),"\n",(0,a.jsx)(n.h2,{id:"tests-e2e",children:"Tests E2E"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-python",children:'# tests/e2e/test_flows.py\nimport pytest\n\n@pytest.mark.asyncio\nasync def test_complete_product_flow(client):\n    """Test flujo completo de producto."""\n\n    # 1. Crear producto\n    create_response = await client.post("/api/v1/products", json={\n        "name": "E2E Product",\n        "sku": "E2E-001",\n        "base_price": 99.99,\n        "organization_id": "org-uuid"\n    })\n\n    assert create_response.status_code == 201\n    product_id = create_response.json()["id"]\n\n    # 2. Obtener producto\n    get_response = await client.get(f"/api/v1/products/{product_id}")\n\n    assert get_response.status_code == 200\n    assert get_response.json()["sku"] == "E2E-001"\n\n    # 3. Actualizar producto\n    update_response = await client.patch(\n        f"/api/v1/products/{product_id}",\n        json={"base_price": 149.99}\n    )\n\n    assert update_response.status_code == 200\n    assert update_response.json()["base_price"] == 149.99\n\n    # 4. Eliminar producto\n    delete_response = await client.delete(f"/api/v1/products/{product_id}")\n\n    assert delete_response.status_code == 204\n\n    # 5. Verificar eliminado\n    get_deleted = await client.get(f"/api/v1/products/{product_id}")\n    assert get_deleted.status_code == 404\n'})}),"\n",(0,a.jsx)(n.h2,{id:"factories",children:"Factories"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-python",children:'# tests/factories.py\nimport factory\nfrom app.models import Product, Organization\n\nclass OrganizationFactory(factory.Factory):\n    class Meta:\n        model = Organization\n\n    name = factory.Faker("company")\n    is_active = True\n\nclass ProductFactory(factory.Factory):\n    class Meta:\n        model = Product\n\n    name = factory.Faker("word")\n    sku = factory.Sequence(lambda n: f"SKU-{n:05d}")\n    base_price = factory.Faker("pydecimal", left_digits=3, right_digits=2, positive=True)\n    organization = factory.SubFactory(OrganizationFactory)\n\n# Uso en tests\n@pytest.mark.asyncio\nasync def test_with_factory(db_session):\n    product = ProductFactory.build()\n    db_session.add(product)\n    await db_session.commit()\n'})}),"\n",(0,a.jsx)(n.h2,{id:"coverage",children:"Coverage"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"# Ejecutar con coverage\npytest --cov=app --cov-report=html --cov-report=term\n\n# Ver reporte HTML\nopen htmlcov/index.html\n\n# Target: 80%+ coverage\n"})}),"\n",(0,a.jsx)(n.h2,{id:"cicd-integration",children:"CI/CD Integration"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-yaml",children:"# .github/workflows/test.yml\nname: Tests\n\non: [push, pull_request]\n\njobs:\n  test:\n    runs-on: ubuntu-latest\n\n    services:\n      postgres:\n        image: postgres:15\n        env:\n          POSTGRES_USER: test_user\n          POSTGRES_PASSWORD: test_pass\n          POSTGRES_DB: test_db\n        ports:\n          - 5432:5432\n\n      redis:\n        image: redis:7\n        ports:\n          - 6379:6379\n\n    steps:\n      - uses: actions/checkout@v3\n\n      - name: Set up Python\n        uses: actions/setup-python@v4\n        with:\n          python-version: '3.11'\n\n      - name: Install dependencies\n        run: |\n          pip install -r requirements.txt\n\n      - name: Run tests\n        run: |\n          pytest --cov=app --cov-report=xml\n\n      - name: Upload coverage\n        uses: codecov/codecov-action@v3\n"})}),"\n",(0,a.jsx)(n.h2,{id:"pr\xf3ximos-pasos",children:"Pr\xf3ximos Pasos"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.a,{href:"/guias/deployment",children:"Deployment"})}),"\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.a,{href:"/guias/troubleshooting",children:"Troubleshooting"})}),"\n"]})]})}function l(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(p,{...e})}):p(e)}}}]);