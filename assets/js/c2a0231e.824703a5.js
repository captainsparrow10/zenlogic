"use strict";(globalThis.webpackChunkerp_docs=globalThis.webpackChunkerp_docs||[]).push([[9792],{3223:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>o,contentTitle:()=>a,default:()=>u,frontMatter:()=>i,metadata:()=>s,toc:()=>d});const s=JSON.parse('{"id":"microservicios/catalog-service/testing","title":"Testing","description":"Estrategias y ejemplos de testing para Catalog Service.","source":"@site/docs/02-microservicios/catalog-service/15-testing.md","sourceDirName":"02-microservicios/catalog-service","slug":"/microservicios/catalog-service/testing","permalink":"/zenlogic/microservicios/catalog-service/testing","draft":false,"unlisted":false,"editUrl":"https://github.com/your-repo/edit/main/docs/02-microservicios/catalog-service/15-testing.md","tags":[],"version":"current","sidebarPosition":16,"frontMatter":{"sidebar_position":16},"sidebar":"docs","previous":{"title":"Flujos de Negocio","permalink":"/zenlogic/microservicios/catalog-service/flujos-negocio"},"next":{"title":"Errores Comunes","permalink":"/zenlogic/microservicios/catalog-service/errores-comunes"}}');var r=t(4848),c=t(8453);const i={sidebar_position:16},a="Testing",o={},d=[{value:"Estructura de Tests",id:"estructura-de-tests",level:2},{value:"Unit Tests",id:"unit-tests",level:2},{value:"Test de Service",id:"test-de-service",level:3},{value:"Integration Tests",id:"integration-tests",level:2},{value:"Test de API",id:"test-de-api",level:3},{value:"Fixtures",id:"fixtures",level:2},{value:"Coverage",id:"coverage",level:2},{value:"Pr\xf3ximos Pasos",id:"pr\xf3ximos-pasos",level:2}];function p(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,c.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"testing",children:"Testing"})}),"\n",(0,r.jsx)(n.p,{children:"Estrategias y ejemplos de testing para Catalog Service."}),"\n",(0,r.jsx)(n.h2,{id:"estructura-de-tests",children:"Estructura de Tests"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"tests/\n\u251c\u2500\u2500 unit/\n\u2502   \u251c\u2500\u2500 services/\n\u2502   \u2502   \u251c\u2500\u2500 test_product_service.py\n\u2502   \u2502   \u2514\u2500\u2500 test_variant_service.py\n\u2502   \u251c\u2500\u2500 repositories/\n\u2502   \u2502   \u2514\u2500\u2500 test_product_repository.py\n\u2502   \u2514\u2500\u2500 utils/\n\u2502       \u2514\u2500\u2500 test_cursor_pagination.py\n\u251c\u2500\u2500 integration/\n\u2502   \u251c\u2500\u2500 test_product_api.py\n\u2502   \u251c\u2500\u2500 test_variant_api.py\n\u2502   \u2514\u2500\u2500 test_auth_client.py\n\u2514\u2500\u2500 e2e/\n    \u2514\u2500\u2500 test_product_flow.py\n"})}),"\n",(0,r.jsx)(n.h2,{id:"unit-tests",children:"Unit Tests"}),"\n",(0,r.jsx)(n.h3,{id:"test-de-service",children:"Test de Service"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:'import pytest\nfrom unittest.mock import Mock, AsyncMock\n\nfrom app.services.product_service import ProductService\nfrom app.schemas.product import ProductCreate\n\n@pytest.mark.asyncio\nasync def test_create_product_success():\n    """Test de creaci\xf3n exitosa de producto."""\n\n    # Mocks\n    product_repo = Mock()\n    product_repo.check_sku_exists = AsyncMock(return_value=False)\n    product_repo.create = AsyncMock(return_value=Mock(\n        id="product-123",\n        sku="TEST-001",\n        name="Test Product"\n    ))\n\n    event_publisher = Mock()\n    event_publisher.publish = AsyncMock()\n\n    cache = Mock()\n    cache.delete_pattern = AsyncMock()\n\n    # Service\n    service = ProductService(product_repo, event_publisher, cache)\n\n    # Ejecutar\n    product_data = ProductCreate(\n        name="Test Product",\n        sku="TEST-001",\n        base_price=10.99\n    )\n\n    result = await service.create_product(\n        product_data=product_data,\n        org_id="org-123",\n        user_id="user-456"\n    )\n\n    # Assertions\n    assert result.sku == "TEST-001"\n    product_repo.create.assert_called_once()\n    event_publisher.publish.assert_called_once()\n    cache.delete_pattern.assert_called_once()\n\n@pytest.mark.asyncio\nasync def test_create_product_duplicate_sku():\n    """Test de creaci\xf3n con SKU duplicado."""\n\n    product_repo = Mock()\n    product_repo.check_sku_exists = AsyncMock(return_value=True)\n\n    service = ProductService(product_repo, None, None)\n\n    product_data = ProductCreate(\n        name="Test Product",\n        sku="DUPLICATE-001",\n        base_price=10.99\n    )\n\n    with pytest.raises(HTTPException) as exc_info:\n        await service.create_product(\n            product_data=product_data,\n            org_id="org-123",\n            user_id="user-456"\n        )\n\n    assert exc_info.value.status_code == 409\n'})}),"\n",(0,r.jsx)(n.h2,{id:"integration-tests",children:"Integration Tests"}),"\n",(0,r.jsx)(n.h3,{id:"test-de-api",children:"Test de API"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:'import pytest\nfrom httpx import AsyncClient\nfrom app.main import app\n\n@pytest.mark.asyncio\nasync def test_list_products_endpoint():\n    """Test de endpoint de listado de productos."""\n\n    async with AsyncClient(app=app, base_url="http://test") as client:\n        response = await client.get(\n            "/api/v1/products",\n            headers={\n                "Authorization": "Bearer test-token",\n                "X-Tenant-ID": "org-123"\n            }\n        )\n\n    assert response.status_code == 200\n    data = response.json()\n    assert "data" in data\n    assert "pagination" in data\n\n@pytest.mark.asyncio\nasync def test_create_product_endpoint():\n    """Test de creaci\xf3n de producto."""\n\n    async with AsyncClient(app=app, base_url="http://test") as client:\n        response = await client.post(\n            "/api/v1/products",\n            headers={\n                "Authorization": "Bearer test-token",\n                "X-Tenant-ID": "org-123"\n            },\n            json={\n                "name": "Test Product",\n                "sku": "TEST-001",\n                "base_price": 10.99\n            }\n        )\n\n    assert response.status_code == 201\n    data = response.json()\n    assert data["sku"] == "TEST-001"\n'})}),"\n",(0,r.jsx)(n.h2,{id:"fixtures",children:"Fixtures"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:'import pytest\nfrom sqlalchemy.ext.asyncio import create_async_engine, AsyncSession\nfrom app.database import Base\n\n@pytest.fixture\nasync def db_session():\n    """Fixture para sesi\xf3n de BD de test."""\n    engine = create_async_engine("postgresql+asyncpg://test:test@localhost/test_db")\n\n    async with engine.begin() as conn:\n        await conn.run_sync(Base.metadata.create_all)\n\n    async with AsyncSession(engine) as session:\n        yield session\n\n    async with engine.begin() as conn:\n        await conn.run_sync(Base.metadata.drop_all)\n\n    await engine.dispose()\n\n@pytest.fixture\ndef mock_auth_client():\n    """Fixture para Auth Client mockeado."""\n    client = Mock()\n    client.verify_token = AsyncMock(return_value={\n        "user_id": "user-123",\n        "organization_id": "org-456",\n        "is_active": True\n    })\n    client.get_user_locals = AsyncMock(return_value=["local-1", "local-2"])\n    return client\n'})}),"\n",(0,r.jsx)(n.h2,{id:"coverage",children:"Coverage"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# Ejecutar tests con coverage\npytest --cov=app --cov-report=html --cov-report=term\n\n# Objetivo: >80% coverage\n"})}),"\n",(0,r.jsx)(n.h2,{id:"pr\xf3ximos-pasos",children:"Pr\xf3ximos Pasos"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"/microservicios/catalog-service/errores-comunes",children:"Errores Comunes"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"/microservicios/catalog-service/arquitectura",children:"Arquitectura"})}),"\n"]})]})}function u(e={}){const{wrapper:n}={...(0,c.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(p,{...e})}):p(e)}},8453:(e,n,t)=>{t.d(n,{R:()=>i,x:()=>a});var s=t(6540);const r={},c=s.createContext(r);function i(e){const n=s.useContext(c);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:i(e.components),s.createElement(c.Provider,{value:n},e.children)}}}]);