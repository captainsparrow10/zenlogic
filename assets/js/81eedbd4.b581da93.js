"use strict";(globalThis.webpackChunkerp_docs=globalThis.webpackChunkerp_docs||[]).push([[9726],{1824:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>c,contentTitle:()=>a,default:()=>p,frontMatter:()=>o,metadata:()=>r,toc:()=>l});const r=JSON.parse('{"id":"microservicios/auth-service/configuracion","title":"Configuraci\xf3n","description":"Variables de Entorno","source":"@site/docs/02-microservicios/auth-service/04-configuracion.md","sourceDirName":"02-microservicios/auth-service","slug":"/microservicios/auth-service/configuracion","permalink":"/zenlogic/microservicios/auth-service/configuracion","draft":false,"unlisted":false,"editUrl":"https://github.com/your-repo/edit/main/docs/02-microservicios/auth-service/04-configuracion.md","tags":[],"version":"current","sidebarPosition":5,"frontMatter":{"sidebar_position":5},"sidebar":"docs","previous":{"title":"Modelo de Datos","permalink":"/zenlogic/microservicios/auth-service/modelo-datos"},"next":{"title":"Eventos Publicados","permalink":"/zenlogic/microservicios/auth-service/eventos-publicados"}}');var i=s(4848),t=s(8453);const o={sidebar_position:5},a="Configuraci\xf3n",c={},l=[{value:"Variables de Entorno",id:"variables-de-entorno",level:2},{value:"Archivo <code>.env</code>",id:"archivo-env",level:3},{value:"Configuraci\xf3n de Settings",id:"configuraci\xf3n-de-settings",level:2},{value:"Generaci\xf3n de Claves JWT",id:"generaci\xf3n-de-claves-jwt",level:2},{value:"RSA Key Pair",id:"rsa-key-pair",level:3},{value:"Estructura de Directorios",id:"estructura-de-directorios",level:3},{value:"Docker Compose",id:"docker-compose",level:2},{value:"Dockerfile",id:"dockerfile",level:2},{value:"Configuraci\xf3n de Logs",id:"configuraci\xf3n-de-logs",level:2},{value:"Pr\xf3ximos Pasos",id:"pr\xf3ximos-pasos",level:2}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"configuraci\xf3n",children:"Configuraci\xf3n"})}),"\n",(0,i.jsx)(n.h2,{id:"variables-de-entorno",children:"Variables de Entorno"}),"\n",(0,i.jsx)(n.p,{children:"Auth Service se configura mediante variables de entorno."}),"\n",(0,i.jsxs)(n.h3,{id:"archivo-env",children:["Archivo ",(0,i.jsx)(n.code,{children:".env"})]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'# Application\nAPP_NAME=auth-service\nAPP_ENV=development  # development, staging, production\nDEBUG=true\nLOG_LEVEL=INFO\n\n# Server\nHOST=0.0.0.0\nPORT=8001\nGRPC_PORT=50051\n\n# Database\nDATABASE_URL=postgresql+asyncpg://user:password@localhost:5432/auth_db\nDB_POOL_SIZE=20\nDB_MAX_OVERFLOW=10\n\n# Redis\nREDIS_URL=redis://localhost:6379/0\nREDIS_PASSWORD=\nREDIS_DB=0\n\n# RabbitMQ\nRABBITMQ_HOST=localhost\nRABBITMQ_PORT=5672\nRABBITMQ_USER=guest\nRABBITMQ_PASSWORD=guest\nRABBITMQ_VHOST=/\nRABBITMQ_EXCHANGE=auth_events\n\n# JWT\nJWT_ALGORITHM=RS256\nJWT_ACCESS_TOKEN_EXPIRE_MINUTES=15\nJWT_REFRESH_TOKEN_EXPIRE_DAYS=7\n\n# Keys (en producci\xf3n, usar archivos)\nJWT_PRIVATE_KEY_PATH=./keys/private_key.pem\nJWT_PUBLIC_KEY_PATH=./keys/public_key.pem\n\n# Security\nPASSWORD_MIN_LENGTH=8\nPASSWORD_REQUIRE_UPPERCASE=true\nPASSWORD_REQUIRE_NUMBER=true\nPASSWORD_REQUIRE_SPECIAL=false\n\nMAX_LOGIN_ATTEMPTS=5\nLOCKOUT_DURATION_MINUTES=15\n\n# CORS\nCORS_ORIGINS=["http://localhost:3000","https://app.example.com"]\nCORS_ALLOW_CREDENTIALS=true\n\n# Rate Limiting\nRATE_LIMIT_LOGIN=5/minute\nRATE_LIMIT_VERIFY=1000/minute\n'})}),"\n",(0,i.jsx)(n.h2,{id:"configuraci\xf3n-de-settings",children:"Configuraci\xf3n de Settings"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Archivo"}),": ",(0,i.jsx)(n.code,{children:"src/config/settings.py"})]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'from pydantic_settings import BaseSettings\nfrom functools import lru_cache\n\nclass Settings(BaseSettings):\n    # Application\n    APP_NAME: str = "auth-service"\n    APP_ENV: str = "development"\n    DEBUG: bool = False\n    LOG_LEVEL: str = "INFO"\n\n    # Server\n    HOST: str = "0.0.0.0"\n    PORT: int = 8001\n    GRPC_PORT: int = 50051\n\n    # Database\n    DATABASE_URL: str\n    DB_POOL_SIZE: int = 20\n    DB_MAX_OVERFLOW: int = 10\n\n    # Redis\n    REDIS_URL: str\n    REDIS_PASSWORD: str = ""\n    REDIS_DB: int = 0\n\n    # RabbitMQ\n    RABBITMQ_HOST: str = "localhost"\n    RABBITMQ_PORT: int = 5672\n    RABBITMQ_USER: str = "guest"\n    RABBITMQ_PASSWORD: str = "guest"\n    RABBITMQ_VHOST: str = "/"\n    RABBITMQ_EXCHANGE: str = "auth_events"\n\n    # JWT\n    JWT_ALGORITHM: str = "RS256"\n    JWT_ACCESS_TOKEN_EXPIRE_MINUTES: int = 15\n    JWT_REFRESH_TOKEN_EXPIRE_DAYS: int = 7\n    JWT_PRIVATE_KEY_PATH: str = "./keys/private_key.pem"\n    JWT_PUBLIC_KEY_PATH: str = "./keys/public_key.pem"\n\n    # Security\n    PASSWORD_MIN_LENGTH: int = 8\n    PASSWORD_REQUIRE_UPPERCASE: bool = True\n    PASSWORD_REQUIRE_NUMBER: bool = True\n    PASSWORD_REQUIRE_SPECIAL: bool = False\n    MAX_LOGIN_ATTEMPTS: int = 5\n    LOCKOUT_DURATION_MINUTES: int = 15\n\n    # CORS\n    CORS_ORIGINS: list[str] = ["http://localhost:3000"]\n    CORS_ALLOW_CREDENTIALS: bool = True\n\n    # Rate Limiting\n    RATE_LIMIT_LOGIN: str = "5/minute"\n    RATE_LIMIT_VERIFY: str = "1000/minute"\n\n    @property\n    def JWT_PRIVATE_KEY(self) -> str:\n        with open(self.JWT_PRIVATE_KEY_PATH, "r") as f:\n            return f.read()\n\n    @property\n    def JWT_PUBLIC_KEY(self) -> str:\n        with open(self.JWT_PUBLIC_KEY_PATH, "r") as f:\n            return f.read()\n\n    class Config:\n        env_file = ".env"\n        case_sensitive = True\n\n@lru_cache()\ndef get_settings() -> Settings:\n    return Settings()\n\nsettings = get_settings()\n'})}),"\n",(0,i.jsx)(n.h2,{id:"generaci\xf3n-de-claves-jwt",children:"Generaci\xf3n de Claves JWT"}),"\n",(0,i.jsx)(n.h3,{id:"rsa-key-pair",children:"RSA Key Pair"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# Generar clave privada\nopenssl genrsa -out private_key.pem 2048\n\n# Generar clave p\xfablica\nopenssl rsa -in private_key.pem -pubout -out public_key.pem\n"})}),"\n",(0,i.jsx)(n.h3,{id:"estructura-de-directorios",children:"Estructura de Directorios"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"auth-service/\n\u251c\u2500\u2500 keys/\n\u2502   \u251c\u2500\u2500 private_key.pem  # NO versionar (a\xf1adir a .gitignore)\n\u2502   \u2514\u2500\u2500 public_key.pem   # Puede compartirse con otros servicios\n"})}),"\n",(0,i.jsx)(n.h2,{id:"docker-compose",children:"Docker Compose"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Archivo"}),": ",(0,i.jsx)(n.code,{children:"docker-compose.yml"})]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:'version: \'3.8\'\n\nservices:\n  postgres:\n    image: postgres:15-alpine\n    environment:\n      POSTGRES_USER: auth_user\n      POSTGRES_PASSWORD: auth_password\n      POSTGRES_DB: erp_auth\n    ports:\n      - "5432:5432"\n    volumes:\n      - postgres_data:/var/lib/postgresql/data\n\n  redis:\n    image: redis:7-alpine\n    ports:\n      - "6379:6379"\n    command: redis-server --appendonly yes\n\n  rabbitmq:\n    image: rabbitmq:3-management-alpine\n    environment:\n      RABBITMQ_DEFAULT_USER: guest\n      RABBITMQ_DEFAULT_PASS: guest\n    ports:\n      - "5672:5672"   # AMQP\n      - "15672:15672" # Management UI\n    volumes:\n      - rabbitmq_data:/var/lib/rabbitmq\n\n  auth-service:\n    build: .\n    environment:\n      DATABASE_URL: postgresql+asyncpg://auth_user:auth_password@postgres:5432/erp_auth\n      REDIS_URL: redis://redis:6379/0\n      RABBITMQ_HOST: rabbitmq\n    ports:\n      - "8001:8001"   # REST API\n      - "50051:50051" # gRPC\n    depends_on:\n      - postgres\n      - redis\n      - rabbitmq\n    volumes:\n      - ./keys:/app/keys\n\nvolumes:\n  postgres_data:\n  rabbitmq_data:\n'})}),"\n",(0,i.jsx)(n.h2,{id:"dockerfile",children:"Dockerfile"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-dockerfile",children:'FROM python:3.11-slim\n\nWORKDIR /app\n\n# Instalar dependencias del sistema\nRUN apt-get update && apt-get install -y \\\n    gcc \\\n    postgresql-client \\\n    && rm -rf /var/lib/apt/lists/*\n\n# Copiar requirements\nCOPY requirements.txt .\nRUN pip install --no-cache-dir -r requirements.txt\n\n# Copiar c\xf3digo\nCOPY . .\n\n# Crear usuario no-root\nRUN useradd -m -u 1000 appuser && chown -R appuser:appuser /app\nUSER appuser\n\n# Exponer puertos\nEXPOSE 8001 50051\n\n# Health check\nHEALTHCHECK --interval=30s --timeout=3s --start-period=40s \\\n  CMD python -c "import requests; requests.get(\'http://localhost:8001/health\')"\n\n# Comando por defecto\nCMD ["python", "-m", "uvicorn", "src.main:app", "--host", "0.0.0.0", "--port", "8001"]\n'})}),"\n",(0,i.jsx)(n.h2,{id:"configuraci\xf3n-de-logs",children:"Configuraci\xf3n de Logs"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Archivo"}),": ",(0,i.jsx)(n.code,{children:"src/config/logging.py"})]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"import logging\nimport sys\nfrom src.config.settings import settings\n\ndef setup_logging():\n    logging.basicConfig(\n        level=getattr(logging, settings.LOG_LEVEL),\n        format='%(asctime)s - %(name)s - %(levelname)s - %(message)s',\n        handlers=[\n            logging.StreamHandler(sys.stdout),\n            logging.FileHandler('logs/auth-service.log')\n        ]\n    )\n\n    # Configurar loggers espec\xedficos\n    logging.getLogger('sqlalchemy.engine').setLevel(logging.WARNING)\n    logging.getLogger('uvicorn.access').setLevel(logging.INFO)\n"})}),"\n",(0,i.jsx)(n.h2,{id:"pr\xf3ximos-pasos",children:"Pr\xf3ximos Pasos"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"/microservicios/auth-service/eventos-publicados",children:"Eventos Publicados"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"/guias/deployment",children:"Deployment"})}),"\n"]})]})}function p(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>o,x:()=>a});var r=s(6540);const i={},t=r.createContext(i);function o(e){const n=r.useContext(t);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:o(e.components),r.createElement(t.Provider,{value:n},e.children)}}}]);