"use strict";(globalThis.webpackChunkerp_docs=globalThis.webpackChunkerp_docs||[]).push([[8046],{2080:(r,e,n)=>{n.r(e),n.d(e,{assets:()=>a,contentTitle:()=>t,default:()=>l,frontMatter:()=>c,metadata:()=>s,toc:()=>d});const s=JSON.parse('{"id":"microservicios/catalog-service/paginacion-cursor","title":"Paginaci\xf3n con Cursor","description":"Implementaci\xf3n de paginaci\xf3n estilo Shopify usando cursores para escalabilidad.","source":"@site/docs/02-microservicios/catalog-service/12-paginacion-cursor.md","sourceDirName":"02-microservicios/catalog-service","slug":"/microservicios/catalog-service/paginacion-cursor","permalink":"/zenlogic/microservicios/catalog-service/paginacion-cursor","draft":false,"unlisted":false,"editUrl":"https://github.com/your-repo/edit/main/docs/02-microservicios/catalog-service/12-paginacion-cursor.md","tags":[],"version":"current","sidebarPosition":13,"frontMatter":{"sidebar_position":13},"sidebar":"docs","previous":{"title":"Images API","permalink":"/zenlogic/microservicios/catalog-service/api-images"},"next":{"title":"Estrategia de Cache","permalink":"/zenlogic/microservicios/catalog-service/cache-strategy"}}');var o=n(4848),i=n(8453);const c={sidebar_position:13},t="Paginaci\xf3n con Cursor",a={},d=[{value:"Concepto",id:"concepto",level:2},{value:"Estructura de Response",id:"estructura-de-response",level:2},{value:"Implementaci\xf3n",id:"implementaci\xf3n",level:2},{value:"Cursor Encoding",id:"cursor-encoding",level:3},{value:"Repository Query",id:"repository-query",level:3},{value:"Uso en Endpoint",id:"uso-en-endpoint",level:2},{value:"Pr\xf3ximos Pasos",id:"pr\xf3ximos-pasos",level:2}];function u(r){const e={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...r.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(e.header,{children:(0,o.jsx)(e.h1,{id:"paginaci\xf3n-con-cursor",children:"Paginaci\xf3n con Cursor"})}),"\n",(0,o.jsx)(e.p,{children:"Implementaci\xf3n de paginaci\xf3n estilo Shopify usando cursores para escalabilidad."}),"\n",(0,o.jsx)(e.h2,{id:"concepto",children:"Concepto"}),"\n",(0,o.jsx)(e.p,{children:"La paginaci\xf3n basada en cursor usa un puntero al \xfaltimo registro en lugar de n\xfamero de p\xe1gina:"}),"\n",(0,o.jsxs)(e.p,{children:[(0,o.jsx)(e.strong,{children:"Ventajas"}),":"]}),"\n",(0,o.jsxs)(e.ul,{children:["\n",(0,o.jsx)(e.li,{children:"Rendimiento constante O(1) sin importar el offset"}),"\n",(0,o.jsx)(e.li,{children:"No hay resultados duplicados al agregar/eliminar registros"}),"\n",(0,o.jsx)(e.li,{children:"Ideal para APIs p\xfablicas y feeds infinitos"}),"\n"]}),"\n",(0,o.jsxs)(e.p,{children:[(0,o.jsx)(e.strong,{children:"Desventajas"}),":"]}),"\n",(0,o.jsxs)(e.ul,{children:["\n",(0,o.jsx)(e.li,{children:"No se puede saltar a p\xe1gina espec\xedfica"}),"\n",(0,o.jsx)(e.li,{children:"No hay n\xfamero total de p\xe1ginas"}),"\n"]}),"\n",(0,o.jsx)(e.h2,{id:"estructura-de-response",children:"Estructura de Response"}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-json",children:'{\n  "data": [...],\n  "pagination": {\n    "has_next": true,\n    "has_previous": false,\n    "next_cursor": "eyJpZCI6ImFiYy0xMjMiLCJjcmVhdGVkX2F0IjoiMjAyNS0xMS0yMyJ9",\n    "previous_cursor": null,\n    "count": 20\n  }\n}\n'})}),"\n",(0,o.jsx)(e.h2,{id:"implementaci\xf3n",children:"Implementaci\xf3n"}),"\n",(0,o.jsx)(e.h3,{id:"cursor-encoding",children:"Cursor Encoding"}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-python",children:'import base64\nimport json\nfrom typing import Optional\n\ndef encode_cursor(product_id: str, created_at: str) -> str:\n    """Codificar cursor en base64."""\n    cursor_data = {\n        "id": product_id,\n        "created_at": created_at\n    }\n    json_str = json.dumps(cursor_data)\n    return base64.b64encode(json_str.encode()).decode()\n\ndef decode_cursor(cursor: str) -> dict:\n    """Decodificar cursor desde base64."""\n    json_str = base64.b64decode(cursor.encode()).decode()\n    return json.loads(json_str)\n'})}),"\n",(0,o.jsx)(e.h3,{id:"repository-query",children:"Repository Query"}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-python",children:'from sqlalchemy import select, and_\nfrom typing import List, Tuple\n\nclass ProductRepository:\n    async def list_with_cursor(\n        self,\n        organization_id: str,\n        cursor: Optional[str] = None,\n        limit: int = 20,\n        direction: str = "next"\n    ) -> Tuple[List[Product], Optional[str], Optional[str]]:\n        """Listar productos con paginaci\xf3n por cursor."""\n\n        query = select(Product).where(\n            Product.organization_id == organization_id\n        )\n\n        # Aplicar cursor si existe\n        if cursor:\n            cursor_data = decode_cursor(cursor)\n            cursor_id = cursor_data["id"]\n            cursor_created = cursor_data["created_at"]\n\n            if direction == "next":\n                query = query.where(\n                    and_(\n                        Product.created_at >= cursor_created,\n                        Product.id > cursor_id\n                    )\n                )\n            else:  # previous\n                query = query.where(\n                    and_(\n                        Product.created_at <= cursor_created,\n                        Product.id < cursor_id\n                    )\n                ).order_by(Product.created_at.desc(), Product.id.desc())\n\n        # Ordenar y limitar\n        query = query.order_by(Product.created_at.asc(), Product.id.asc())\n        query = query.limit(limit + 1)  # +1 para saber si hay m\xe1s\n\n        # Ejecutar\n        result = await self.db.execute(query)\n        products = list(result.scalars().all())\n\n        # Calcular cursores\n        has_next = len(products) > limit\n        products = products[:limit]  # Remover el registro extra\n\n        next_cursor = None\n        previous_cursor = None\n\n        if has_next and products:\n            last_product = products[-1]\n            next_cursor = encode_cursor(\n                str(last_product.id),\n                last_product.created_at.isoformat()\n            )\n\n        if cursor:  # Si hay cursor, hay p\xe1gina previa\n            first_product = products[0]\n            previous_cursor = encode_cursor(\n                str(first_product.id),\n                first_product.created_at.isoformat()\n            )\n\n        return products, next_cursor, previous_cursor\n'})}),"\n",(0,o.jsx)(e.h2,{id:"uso-en-endpoint",children:"Uso en Endpoint"}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-python",children:'@router.get("/products")\nasync def list_products(\n    cursor: Optional[str] = Query(None),\n    limit: int = Query(20, ge=1, le=100),\n    product_repo: ProductRepository = Depends()\n):\n    products, next_cursor, prev_cursor = await product_repo.list_with_cursor(\n        organization_id=org_id,\n        cursor=cursor,\n        limit=limit\n    )\n\n    return {\n        "data": products,\n        "pagination": {\n            "has_next": next_cursor is not None,\n            "has_previous": prev_cursor is not None,\n            "next_cursor": next_cursor,\n            "previous_cursor": prev_cursor,\n            "count": len(products)\n        }\n    }\n'})}),"\n",(0,o.jsx)(e.h2,{id:"pr\xf3ximos-pasos",children:"Pr\xf3ximos Pasos"}),"\n",(0,o.jsxs)(e.ul,{children:["\n",(0,o.jsx)(e.li,{children:(0,o.jsx)(e.a,{href:"/microservicios/catalog-service/api-products",children:"API Products"})}),"\n",(0,o.jsx)(e.li,{children:(0,o.jsx)(e.a,{href:"/microservicios/catalog-service/cache-strategy",children:"Cache Strategy"})}),"\n"]})]})}function l(r={}){const{wrapper:e}={...(0,i.R)(),...r.components};return e?(0,o.jsx)(e,{...r,children:(0,o.jsx)(u,{...r})}):u(r)}},8453:(r,e,n)=>{n.d(e,{R:()=>c,x:()=>t});var s=n(6540);const o={},i=s.createContext(o);function c(r){const e=s.useContext(i);return s.useMemo(function(){return"function"==typeof r?r(e):{...e,...r}},[e,r])}function t(r){let e;return e=r.disableParentContext?"function"==typeof r.components?r.components(o):r.components||o:c(r.components),s.createElement(i.Provider,{value:e},r.children)}}}]);