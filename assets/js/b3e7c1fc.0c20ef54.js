"use strict";(globalThis.webpackChunkerp_docs=globalThis.webpackChunkerp_docs||[]).push([[3087],{8453:(e,n,i)=>{i.d(n,{R:()=>o,x:()=>r});var a=i(6540);const t={},s=a.createContext(t);function o(e){const n=a.useContext(s);return a.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:o(e.components),a.createElement(s.Provider,{value:n},e.children)}},9478:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>l,contentTitle:()=>r,default:()=>_,frontMatter:()=>o,metadata:()=>a,toc:()=>c});const a=JSON.parse('{"id":"microservicios/catalog-service/configuracion","title":"Configuraci\xf3n","description":"Variables de entorno y configuraci\xf3n del Catalog Service.","source":"@site/docs/02-microservicios/catalog-service/04-configuracion.md","sourceDirName":"02-microservicios/catalog-service","slug":"/microservicios/catalog-service/configuracion","permalink":"/zenlogic/microservicios/catalog-service/configuracion","draft":false,"unlisted":false,"editUrl":"https://github.com/your-repo/edit/main/docs/02-microservicios/catalog-service/04-configuracion.md","tags":[],"version":"current","sidebarPosition":5,"frontMatter":{"sidebar_position":5},"sidebar":"docs","previous":{"title":"Modelo de Datos","permalink":"/zenlogic/microservicios/catalog-service/modelo-datos"},"next":{"title":"Eventos Publicados","permalink":"/zenlogic/microservicios/catalog-service/eventos-publicados"}}');var t=i(4848),s=i(8453);const o={sidebar_position:5},r="Configuraci\xf3n",l={},c=[{value:"Variables de Entorno",id:"variables-de-entorno",level:2},{value:"Base de Datos",id:"base-de-datos",level:3},{value:"Redis Cache",id:"redis-cache",level:3},{value:"RabbitMQ",id:"rabbitmq",level:3},{value:"Auth Service (gRPC)",id:"auth-service-grpc",level:3},{value:"API Server",id:"api-server",level:3},{value:"Logging",id:"logging",level:3},{value:"Seguridad",id:"seguridad",level:3},{value:"Paginaci\xf3n",id:"paginaci\xf3n",level:3},{value:"Archivo de Configuraci\xf3n",id:"archivo-de-configuraci\xf3n",level:2},{value:"<code>config/settings.py</code>",id:"configsettingspy",level:3},{value:"Archivo .env de Ejemplo",id:"archivo-env-de-ejemplo",level:2},{value:"Configuraci\xf3n por Ambiente",id:"configuraci\xf3n-por-ambiente",level:2},{value:"Desarrollo (<code>config/development.py</code>)",id:"desarrollo-configdevelopmentpy",level:3},{value:"Producci\xf3n (<code>config/production.py</code>)",id:"producci\xf3n-configproductionpy",level:3},{value:"Testing (<code>config/testing.py</code>)",id:"testing-configtestingpy",level:3},{value:"Inicializaci\xf3n de Configuraci\xf3n",id:"inicializaci\xf3n-de-configuraci\xf3n",level:2},{value:"<code>app/main.py</code>",id:"appmainpy",level:3},{value:"Health Check con Configuraci\xf3n",id:"health-check-con-configuraci\xf3n",level:2},{value:"Pr\xf3ximos Pasos",id:"pr\xf3ximos-pasos",level:2}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,s.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"configuraci\xf3n",children:"Configuraci\xf3n"})}),"\n",(0,t.jsx)(n.p,{children:"Variables de entorno y configuraci\xf3n del Catalog Service."}),"\n",(0,t.jsx)(n.h2,{id:"variables-de-entorno",children:"Variables de Entorno"}),"\n",(0,t.jsx)(n.h3,{id:"base-de-datos",children:"Base de Datos"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"# PostgreSQL\nDATABASE_HOST=localhost\nDATABASE_PORT=5432\nDATABASE_NAME=catalog_db\nDATABASE_USER=catalog_user\nDATABASE_PASSWORD=secure_password\n\n# Pool de conexiones\nDATABASE_POOL_SIZE=20\nDATABASE_MAX_OVERFLOW=10\nDATABASE_POOL_TIMEOUT=30\nDATABASE_POOL_RECYCLE=3600\n"})}),"\n",(0,t.jsx)(n.h3,{id:"redis-cache",children:"Redis Cache"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"# Redis\nREDIS_HOST=localhost\nREDIS_PORT=6379\nREDIS_DB=1\nREDIS_PASSWORD=\nREDIS_MAX_CONNECTIONS=50\n\n# Cache TTL (segundos)\nCACHE_TTL_DEFAULT=300        # 5 minutos\nCACHE_TTL_PRODUCTS=600       # 10 minutos\nCACHE_TTL_VARIANTS=600       # 10 minutos\nCACHE_TTL_OPTIONS=1800       # 30 minutos (cambian poco)\nCACHE_TTL_LOCALS=3600        # 1 hora\n"})}),"\n",(0,t.jsx)(n.h3,{id:"rabbitmq",children:"RabbitMQ"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"# RabbitMQ Connection\nRABBITMQ_HOST=localhost\nRABBITMQ_PORT=5672\nRABBITMQ_USER=guest\nRABBITMQ_PASSWORD=guest\nRABBITMQ_VHOST=/\n\n# Exchanges\nRABBITMQ_EXCHANGE_CATALOG=catalog_events\nRABBITMQ_EXCHANGE_AUTH=auth_events\n\n# Queues\nRABBITMQ_QUEUE_CATALOG=catalog_service_queue\nRABBITMQ_QUEUE_AUTH_EVENTS=catalog_auth_events_queue\n\n# Prefetch\nRABBITMQ_PREFETCH_COUNT=10\n"})}),"\n",(0,t.jsx)(n.h3,{id:"auth-service-grpc",children:"Auth Service (gRPC)"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"# gRPC Client\nAUTH_GRPC_HOST=localhost\nAUTH_GRPC_PORT=50051\nAUTH_GRPC_TIMEOUT=5          # segundos\nAUTH_GRPC_MAX_RETRIES=3\nAUTH_GRPC_RETRY_DELAY=1      # segundos\n\n# Fallback REST\nAUTH_REST_URL=http://localhost:8001\nAUTH_REST_TIMEOUT=10         # segundos\n\n# Circuit Breaker\nCIRCUIT_BREAKER_FAILURE_THRESHOLD=5\nCIRCUIT_BREAKER_TIMEOUT=60   # segundos\nCIRCUIT_BREAKER_RECOVERY_TIMEOUT=30\n"})}),"\n",(0,t.jsx)(n.h3,{id:"api-server",children:"API Server"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"# FastAPI\nSERVICE_NAME=catalog-service\nSERVICE_VERSION=1.0.0\nAPI_HOST=0.0.0.0\nAPI_PORT=8002\nAPI_WORKERS=4\n\n# CORS\nCORS_ORIGINS=http://localhost:3000,http://localhost:3001\nCORS_ALLOW_CREDENTIALS=true\n\n# Rate Limiting\nRATE_LIMIT_ENABLED=true\nRATE_LIMIT_REQUESTS=100\nRATE_LIMIT_WINDOW=60         # segundos\n"})}),"\n",(0,t.jsx)(n.h3,{id:"logging",children:"Logging"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"# Logging\nLOG_LEVEL=INFO               # DEBUG, INFO, WARNING, ERROR\nLOG_FORMAT=json              # json, text\nLOG_FILE=/var/log/catalog-service/app.log\nLOG_MAX_BYTES=10485760       # 10 MB\nLOG_BACKUP_COUNT=5\n"})}),"\n",(0,t.jsx)(n.h3,{id:"seguridad",children:"Seguridad"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"# JWT (mismas claves que Auth Service)\nJWT_PUBLIC_KEY_PATH=/app/keys/jwt_public.pem\nJWT_ALGORITHM=RS256\n\n# Multi-tenancy\nTENANT_HEADER_NAME=X-Tenant-ID\nENFORCE_TENANT_ISOLATION=true\n"})}),"\n",(0,t.jsx)(n.h3,{id:"paginaci\xf3n",children:"Paginaci\xf3n"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"# Cursor Pagination\nPAGINATION_DEFAULT_LIMIT=20\nPAGINATION_MAX_LIMIT=100\nPAGINATION_MIN_LIMIT=1\n"})}),"\n",(0,t.jsx)(n.h2,{id:"archivo-de-configuraci\xf3n",children:"Archivo de Configuraci\xf3n"}),"\n",(0,t.jsx)(n.h3,{id:"configsettingspy",children:(0,t.jsx)(n.code,{children:"config/settings.py"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:'from pydantic_settings import BaseSettings\nfrom pydantic import Field, validator\nfrom typing import Optional\nimport os\n\nclass Settings(BaseSettings):\n    """Configuraci\xf3n del Catalog Service."""\n\n    # Service\n    service_name: str = "catalog-service"\n    service_version: str = "1.0.0"\n    environment: str = Field(default="development", env="ENVIRONMENT")\n\n    # API\n    api_host: str = Field(default="0.0.0.0", env="API_HOST")\n    api_port: int = Field(default=8002, env="API_PORT")\n    api_workers: int = Field(default=4, env="API_WORKERS")\n\n    # Database\n    database_host: str = Field(..., env="DATABASE_HOST")\n    database_port: int = Field(default=5432, env="DATABASE_PORT")\n    database_name: str = Field(..., env="DATABASE_NAME")\n    database_user: str = Field(..., env="DATABASE_USER")\n    database_password: str = Field(..., env="DATABASE_PASSWORD")\n    database_pool_size: int = Field(default=20, env="DATABASE_POOL_SIZE")\n    database_max_overflow: int = Field(default=10, env="DATABASE_MAX_OVERFLOW")\n\n    # Redis\n    redis_host: str = Field(default="localhost", env="REDIS_HOST")\n    redis_port: int = Field(default=6379, env="REDIS_PORT")\n    redis_db: int = Field(default=1, env="REDIS_DB")\n    redis_password: Optional[str] = Field(default=None, env="REDIS_PASSWORD")\n\n    # Cache TTL\n    cache_ttl_default: int = Field(default=300, env="CACHE_TTL_DEFAULT")\n    cache_ttl_products: int = Field(default=600, env="CACHE_TTL_PRODUCTS")\n    cache_ttl_locals: int = Field(default=3600, env="CACHE_TTL_LOCALS")\n\n    # RabbitMQ\n    rabbitmq_host: str = Field(default="localhost", env="RABBITMQ_HOST")\n    rabbitmq_port: int = Field(default=5672, env="RABBITMQ_PORT")\n    rabbitmq_user: str = Field(default="guest", env="RABBITMQ_USER")\n    rabbitmq_password: str = Field(default="guest", env="RABBITMQ_PASSWORD")\n    rabbitmq_exchange_catalog: str = Field(default="catalog_events")\n    rabbitmq_exchange_auth: str = Field(default="auth_events")\n\n    # Auth Service\n    auth_grpc_host: str = Field(default="localhost", env="AUTH_GRPC_HOST")\n    auth_grpc_port: int = Field(default=50051, env="AUTH_GRPC_PORT")\n    auth_grpc_timeout: int = Field(default=5, env="AUTH_GRPC_TIMEOUT")\n    auth_rest_url: str = Field(default="http://localhost:8001")\n\n    # JWT\n    jwt_public_key_path: str = Field(..., env="JWT_PUBLIC_KEY_PATH")\n    jwt_algorithm: str = Field(default="RS256")\n\n    # Multi-tenancy\n    tenant_header_name: str = Field(default="X-Tenant-ID")\n    enforce_tenant_isolation: bool = Field(default=True)\n\n    # Logging\n    log_level: str = Field(default="INFO", env="LOG_LEVEL")\n    log_format: str = Field(default="json", env="LOG_FORMAT")\n\n    # Pagination\n    pagination_default_limit: int = Field(default=20)\n    pagination_max_limit: int = Field(default=100)\n\n    @property\n    def database_url(self) -> str:\n        """Construye la URL de conexi\xf3n a PostgreSQL."""\n        return (\n            f"postgresql+asyncpg://{self.database_user}:{self.database_password}"\n            f"@{self.database_host}:{self.database_port}/{self.database_name}"\n        )\n\n    @property\n    def redis_url(self) -> str:\n        """Construye la URL de conexi\xf3n a Redis."""\n        password_part = f":{self.redis_password}@" if self.redis_password else ""\n        return f"redis://{password_part}{self.redis_host}:{self.redis_port}/{self.redis_db}"\n\n    @property\n    def rabbitmq_url(self) -> str:\n        """Construye la URL de conexi\xf3n a RabbitMQ."""\n        return (\n            f"amqp://{self.rabbitmq_user}:{self.rabbitmq_password}"\n            f"@{self.rabbitmq_host}:{self.rabbitmq_port}/"\n        )\n\n    @validator("log_level")\n    def validate_log_level(cls, v):\n        allowed = ["DEBUG", "INFO", "WARNING", "ERROR", "CRITICAL"]\n        if v.upper() not in allowed:\n            raise ValueError(f"log_level must be one of {allowed}")\n        return v.upper()\n\n    @validator("pagination_max_limit")\n    def validate_max_limit(cls, v):\n        if v > 1000:\n            raise ValueError("pagination_max_limit cannot exceed 1000")\n        return v\n\n    class Config:\n        env_file = ".env"\n        env_file_encoding = "utf-8"\n        case_sensitive = False\n\n\n# Singleton\nsettings = Settings()\n'})}),"\n",(0,t.jsx)(n.h2,{id:"archivo-env-de-ejemplo",children:"Archivo .env de Ejemplo"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"# .env.example para Catalog Service\n\n# Environment\nENVIRONMENT=development\n\n# API\nAPI_HOST=0.0.0.0\nAPI_PORT=8002\nAPI_WORKERS=4\n\n# Database\nDATABASE_HOST=localhost\nDATABASE_PORT=5432\nDATABASE_NAME=catalog_db\nDATABASE_USER=catalog_user\nDATABASE_PASSWORD=change_me_in_production\nDATABASE_POOL_SIZE=20\nDATABASE_MAX_OVERFLOW=10\n\n# Redis\nREDIS_HOST=localhost\nREDIS_PORT=6379\nREDIS_DB=1\nREDIS_PASSWORD=\n\n# Cache TTL (seconds)\nCACHE_TTL_DEFAULT=300\nCACHE_TTL_PRODUCTS=600\nCACHE_TTL_LOCALS=3600\n\n# RabbitMQ\nRABBITMQ_HOST=localhost\nRABBITMQ_PORT=5672\nRABBITMQ_USER=guest\nRABBITMQ_PASSWORD=guest\n\n# Auth Service\nAUTH_GRPC_HOST=localhost\nAUTH_GRPC_PORT=50051\nAUTH_GRPC_TIMEOUT=5\nAUTH_REST_URL=http://localhost:8001\n\n# JWT\nJWT_PUBLIC_KEY_PATH=/app/keys/jwt_public.pem\nJWT_ALGORITHM=RS256\n\n# Multi-tenancy\nTENANT_HEADER_NAME=X-Tenant-ID\nENFORCE_TENANT_ISOLATION=true\n\n# Logging\nLOG_LEVEL=INFO\nLOG_FORMAT=json\n\n# Pagination\nPAGINATION_DEFAULT_LIMIT=20\nPAGINATION_MAX_LIMIT=100\n"})}),"\n",(0,t.jsx)(n.h2,{id:"configuraci\xf3n-por-ambiente",children:"Configuraci\xf3n por Ambiente"}),"\n",(0,t.jsxs)(n.h3,{id:"desarrollo-configdevelopmentpy",children:["Desarrollo (",(0,t.jsx)(n.code,{children:"config/development.py"}),")"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:'from .settings import Settings\n\nclass DevelopmentSettings(Settings):\n    """Configuraci\xf3n para desarrollo."""\n\n    environment: str = "development"\n    log_level: str = "DEBUG"\n    database_pool_size: int = 5\n    cache_ttl_default: int = 60  # Cache corto para ver cambios r\xe1pido\n\n    class Config:\n        env_file = ".env.development"\n'})}),"\n",(0,t.jsxs)(n.h3,{id:"producci\xf3n-configproductionpy",children:["Producci\xf3n (",(0,t.jsx)(n.code,{children:"config/production.py"}),")"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:'from .settings import Settings\n\nclass ProductionSettings(Settings):\n    """Configuraci\xf3n para producci\xf3n."""\n\n    environment: str = "production"\n    log_level: str = "WARNING"\n    database_pool_size: int = 50\n    database_max_overflow: int = 20\n    api_workers: int = 8\n\n    class Config:\n        env_file = ".env.production"\n'})}),"\n",(0,t.jsxs)(n.h3,{id:"testing-configtestingpy",children:["Testing (",(0,t.jsx)(n.code,{children:"config/testing.py"}),")"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:'from .settings import Settings\n\nclass TestingSettings(Settings):\n    """Configuraci\xf3n para testing."""\n\n    environment: str = "testing"\n    database_name: str = "catalog_db_test"\n    redis_db: int = 15  # DB separada para tests\n    cache_ttl_default: int = 1\n    log_level: str = "ERROR"\n\n    class Config:\n        env_file = ".env.test"\n'})}),"\n",(0,t.jsx)(n.h2,{id:"inicializaci\xf3n-de-configuraci\xf3n",children:"Inicializaci\xf3n de Configuraci\xf3n"}),"\n",(0,t.jsx)(n.h3,{id:"appmainpy",children:(0,t.jsx)(n.code,{children:"app/main.py"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:'from fastapi import FastAPI\nfrom config.settings import settings\nimport logging\n\n# Configurar logging\nlogging.basicConfig(\n    level=settings.log_level,\n    format=\'%(asctime)s - %(name)s - %(levelname)s - %(message)s\'\n)\n\nlogger = logging.getLogger(__name__)\n\ndef create_app() -> FastAPI:\n    """Factory para crear la aplicaci\xf3n FastAPI."""\n\n    app = FastAPI(\n        title=settings.service_name,\n        version=settings.service_version,\n        description="Microservicio de gesti\xf3n de cat\xe1logo de productos",\n    )\n\n    # Log de configuraci\xf3n al iniciar\n    logger.info(f"Iniciando {settings.service_name} v{settings.service_version}")\n    logger.info(f"Ambiente: {settings.environment}")\n    logger.info(f"Database: {settings.database_host}:{settings.database_port}")\n    logger.info(f"Redis: {settings.redis_host}:{settings.redis_port}")\n    logger.info(f"Auth gRPC: {settings.auth_grpc_host}:{settings.auth_grpc_port}")\n\n    return app\n'})}),"\n",(0,t.jsx)(n.h2,{id:"health-check-con-configuraci\xf3n",children:"Health Check con Configuraci\xf3n"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:'from fastapi import APIRouter, status\nfrom config.settings import settings\n\nrouter = APIRouter()\n\n@router.get("/health", status_code=status.HTTP_200_OK)\nasync def health_check():\n    """Health check endpoint."""\n    return {\n        "status": "healthy",\n        "service": settings.service_name,\n        "version": settings.service_version,\n        "environment": settings.environment,\n    }\n\n@router.get("/health/ready", status_code=status.HTTP_200_OK)\nasync def readiness_check():\n    """Readiness check endpoint."""\n    # TODO: Verificar conexi\xf3n a DB, Redis, RabbitMQ\n    return {\n        "status": "ready",\n        "checks": {\n            "database": "ok",\n            "redis": "ok",\n            "rabbitmq": "ok",\n            "auth_service": "ok",\n        }\n    }\n'})}),"\n",(0,t.jsx)(n.h2,{id:"pr\xf3ximos-pasos",children:"Pr\xf3ximos Pasos"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"/microservicios/catalog-service/eventos-publicados",children:"Eventos Publicados"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"/microservicios/catalog-service/eventos-consumidos",children:"Eventos Consumidos"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"/microservicios/catalog-service/arquitectura",children:"Arquitectura"})}),"\n"]})]})}function _(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(d,{...e})}):d(e)}}}]);