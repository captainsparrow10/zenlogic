"use strict";(globalThis.webpackChunkerp_docs=globalThis.webpackChunkerp_docs||[]).push([[2288],{3980:(e,i,n)=>{n.r(i),n.d(i,{assets:()=>t,contentTitle:()=>l,default:()=>h,frontMatter:()=>c,metadata:()=>s,toc:()=>a});const s=JSON.parse('{"id":"microservicios/auth-service/overview","title":"Auth Service - Overview","description":"Introducci\xf3n","source":"@site/docs/02-microservicios/auth-service/00-overview.md","sourceDirName":"02-microservicios/auth-service","slug":"/microservicios/auth-service/overview","permalink":"/zenlogic/microservicios/auth-service/overview","draft":false,"unlisted":false,"editUrl":"https://github.com/your-repo/edit/main/docs/02-microservicios/auth-service/00-overview.md","tags":[],"version":"current","sidebarPosition":1,"frontMatter":{"sidebar_position":1},"sidebar":"docs","previous":{"title":"Patrones de Dise\xf1o","permalink":"/zenlogic/arquitectura/patrones-diseno"},"next":{"title":"Alcance del Auth Service","permalink":"/zenlogic/microservicios/auth-service/alcance"}}');var r=n(4848),d=n(8453);const c={sidebar_position:1},l="Auth Service - Overview",t={},a=[{value:"Introducci\xf3n",id:"introducci\xf3n",level:2},{value:"Responsabilidades Principales",id:"responsabilidades-principales",level:2},{value:"1. Identity Management (Gesti\xf3n de Identidad)",id:"1-identity-management-gesti\xf3n-de-identidad",level:3},{value:"2. Authentication (Autenticaci\xf3n)",id:"2-authentication-autenticaci\xf3n",level:3},{value:"3. Authorization (Autorizaci\xf3n)",id:"3-authorization-autorizaci\xf3n",level:3},{value:"4. Tenant &amp; Organization Management",id:"4-tenant--organization-management",level:3},{value:"5. Token Service",id:"5-token-service",level:3},{value:"6. Audit Logging",id:"6-audit-logging",level:3},{value:"7. Verification API",id:"7-verification-api",level:3},{value:"Diagrama de Componentes",id:"diagrama-de-componentes",level:2},{value:"Stack Tecnol\xf3gico",id:"stack-tecnol\xf3gico",level:2},{value:"Arquitectura General",id:"arquitectura-general",level:2},{value:"Entidades Principales",id:"entidades-principales",level:2},{value:"Users",id:"users",level:3},{value:"Organizations",id:"organizations",level:3},{value:"Locals",id:"locals",level:3},{value:"Modules",id:"modules",level:3},{value:"Permissions",id:"permissions",level:3},{value:"Roles",id:"roles",level:3},{value:"APIs Expuestas",id:"apis-expuestas",level:2},{value:"REST APIs (P\xfablicas)",id:"rest-apis-p\xfablicas",level:3},{value:"gRPC APIs (Internas)",id:"grpc-apis-internas",level:3},{value:"Eventos Publicados",id:"eventos-publicados",level:2},{value:"Consumidores de Eventos",id:"consumidores-de-eventos",level:2},{value:"Flujos Principales",id:"flujos-principales",level:2},{value:"Flujo de Login",id:"flujo-de-login",level:3},{value:"Flujo de Verificaci\xf3n de Token",id:"flujo-de-verificaci\xf3n-de-token",level:3},{value:"Seguridad",id:"seguridad",level:2},{value:"Protecci\xf3n de Contrase\xf1as",id:"protecci\xf3n-de-contrase\xf1as",level:3},{value:"Tokens JWT",id:"tokens-jwt",level:3},{value:"Rate Limiting",id:"rate-limiting",level:3},{value:"Bloqueo por Intentos Fallidos",id:"bloqueo-por-intentos-fallidos",level:3},{value:"M\xe9tricas y Observabilidad",id:"m\xe9tricas-y-observabilidad",level:2},{value:"Logs Estructurados",id:"logs-estructurados",level:3},{value:"Health Checks",id:"health-checks",level:3},{value:"M\xe9tricas (Prometheus)",id:"m\xe9tricas-prometheus",level:3},{value:"Pr\xf3ximos Pasos",id:"pr\xf3ximos-pasos",level:2}];function o(e){const i={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",mermaid:"mermaid",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,d.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(i.header,{children:(0,r.jsx)(i.h1,{id:"auth-service---overview",children:"Auth Service - Overview"})}),"\n",(0,r.jsx)(i.h2,{id:"introducci\xf3n",children:"Introducci\xf3n"}),"\n",(0,r.jsxs)(i.p,{children:["El ",(0,r.jsx)(i.strong,{children:"Auth Service"})," es el microservicio central encargado de toda la ",(0,r.jsx)(i.strong,{children:"identidad, autenticaci\xf3n, autorizaci\xf3n y gobierno de acceso"})," dentro de la plataforma ERP multi-tenant."]}),"\n",(0,r.jsx)(i.admonition,{title:"Cerebro de Seguridad",type:"info",children:(0,r.jsx)(i.p,{children:"Es el cerebro de seguridad del sistema. Controla qui\xe9n puede entrar, qui\xe9n puede hacer qu\xe9, en qu\xe9 organizaci\xf3n, en qu\xe9 sucursal, qu\xe9 m\xf3dulos tiene permitidos y qu\xe9 datos puede tocar."})}),"\n",(0,r.jsx)(i.h2,{id:"responsabilidades-principales",children:"Responsabilidades Principales"}),"\n",(0,r.jsx)(i.h3,{id:"1-identity-management-gesti\xf3n-de-identidad",children:"1. Identity Management (Gesti\xf3n de Identidad)"}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsx)(i.li,{children:"CRUD de usuarios"}),"\n",(0,r.jsx)(i.li,{children:"Asignaci\xf3n de roles"}),"\n",(0,r.jsx)(i.li,{children:"Asignaci\xf3n de sucursales/locales"}),"\n",(0,r.jsx)(i.li,{children:"Manejo de estados (activo, suspendido, revocado)"}),"\n"]}),"\n",(0,r.jsx)(i.h3,{id:"2-authentication-autenticaci\xf3n",children:"2. Authentication (Autenticaci\xf3n)"}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsx)(i.li,{children:"Validaci\xf3n de credenciales"}),"\n",(0,r.jsx)(i.li,{children:"Hashing de contrase\xf1as (bcrypt)"}),"\n",(0,r.jsx)(i.li,{children:"Emisi\xf3n de Access Token (JWT)"}),"\n",(0,r.jsx)(i.li,{children:"Emisi\xf3n de Refresh Token"}),"\n",(0,r.jsx)(i.li,{children:"Revocaci\xf3n de sesiones"}),"\n",(0,r.jsx)(i.li,{children:"Bloqueo por intentos fallidos"}),"\n"]}),"\n",(0,r.jsx)(i.h3,{id:"3-authorization-autorizaci\xf3n",children:"3. Authorization (Autorizaci\xf3n)"}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsx)(i.li,{children:"RBAC (Role-Based Access Control) multinivel"}),"\n",(0,r.jsx)(i.li,{children:"Definici\xf3n de roles por organizaci\xf3n"}),"\n",(0,r.jsx)(i.li,{children:"Asignaci\xf3n de permisos por rol"}),"\n",(0,r.jsx)(i.li,{children:"Validaci\xf3n de permisos en cada endpoint"}),"\n",(0,r.jsxs)(i.li,{children:["Control de acceso por:","\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsx)(i.li,{children:"Organizaci\xf3n"}),"\n",(0,r.jsx)(i.li,{children:"Sucursal/local"}),"\n",(0,r.jsx)(i.li,{children:"M\xf3dulo"}),"\n",(0,r.jsx)(i.li,{children:"Acci\xf3n (permiso espec\xedfico)"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(i.h3,{id:"4-tenant--organization-management",children:"4. Tenant & Organization Management"}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsx)(i.li,{children:"Gesti\xf3n de organizaciones (tenants)"}),"\n",(0,r.jsx)(i.li,{children:"Gesti\xf3n de sucursales/locales"}),"\n",(0,r.jsx)(i.li,{children:"Asignaci\xf3n de m\xf3dulos por organizaci\xf3n"}),"\n",(0,r.jsx)(i.li,{children:"Pol\xedticas basadas en plan (Free, Premium, Enterprise)"}),"\n"]}),"\n",(0,r.jsx)(i.h3,{id:"5-token-service",children:"5. Token Service"}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsx)(i.li,{children:"Generaci\xf3n de JWT (RS256)"}),"\n",(0,r.jsx)(i.li,{children:"Validaci\xf3n de firma y expiraci\xf3n"}),"\n",(0,r.jsx)(i.li,{children:"Rotaci\xf3n de Refresh Tokens"}),"\n",(0,r.jsx)(i.li,{children:"Blacklist / versionado de tokens"}),"\n"]}),"\n",(0,r.jsx)(i.h3,{id:"6-audit-logging",children:"6. Audit Logging"}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsx)(i.li,{children:"Registro de inicios de sesi\xf3n"}),"\n",(0,r.jsx)(i.li,{children:"Cambios de roles"}),"\n",(0,r.jsx)(i.li,{children:"Cambios de permisos"}),"\n",(0,r.jsx)(i.li,{children:"Creaci\xf3n/eliminaci\xf3n de usuarios"}),"\n",(0,r.jsx)(i.li,{children:"Intentos de acceso fallidos"}),"\n"]}),"\n",(0,r.jsx)(i.h3,{id:"7-verification-api",children:"7. Verification API"}),"\n",(0,r.jsxs)(i.p,{children:["Expone ",(0,r.jsx)(i.code,{children:"/auth/verify"}),", que los microservicios usan para saber:"]}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsx)(i.li,{children:"Qui\xe9n est\xe1 haciendo la petici\xf3n"}),"\n",(0,r.jsx)(i.li,{children:"A qu\xe9 organizaci\xf3n pertenece"}),"\n",(0,r.jsx)(i.li,{children:"A qu\xe9 sucursales tiene acceso"}),"\n",(0,r.jsx)(i.li,{children:"Qu\xe9 permisos tiene"}),"\n",(0,r.jsx)(i.li,{children:"Qu\xe9 m\xf3dulos tiene habilitados"}),"\n",(0,r.jsx)(i.li,{children:"Si el usuario est\xe1 activo"}),"\n"]}),"\n",(0,r.jsx)(i.h2,{id:"diagrama-de-componentes",children:"Diagrama de Componentes"}),"\n",(0,r.jsx)(i.mermaid,{value:'flowchart TB\n    subgraph "Auth Service"\n        API[API Layer<br/>FastAPI]\n        Auth[Authentication<br/>Engine]\n        Authz[Authorization<br/>Engine RBAC]\n        Identity[Identity<br/>Management]\n        Token[Token<br/>Service]\n        Events[Event<br/>Publisher]\n    end\n\n    subgraph "External"\n        Client[Clients]\n        Services[Other Services]\n        MQ[RabbitMQ]\n    end\n\n    subgraph "Data"\n        DB[(PostgreSQL)]\n        Redis[(Redis Cache)]\n    end\n\n    Client --\x3e|login| API\n    Services --\x3e|verify token| API\n\n    API --\x3e Auth\n    API --\x3e Authz\n    API --\x3e Identity\n    API --\x3e Token\n\n    Auth --\x3e DB\n    Authz --\x3e DB\n    Identity --\x3e DB\n    Token --\x3e Redis\n\n    API --\x3e Events\n    Events --\x3e MQ'}),"\n",(0,r.jsx)(i.h2,{id:"stack-tecnol\xf3gico",children:"Stack Tecnol\xf3gico"}),"\n",(0,r.jsxs)(i.table,{children:[(0,r.jsx)(i.thead,{children:(0,r.jsxs)(i.tr,{children:[(0,r.jsx)(i.th,{children:"Componente"}),(0,r.jsx)(i.th,{children:"Tecnolog\xeda"})]})}),(0,r.jsxs)(i.tbody,{children:[(0,r.jsxs)(i.tr,{children:[(0,r.jsx)(i.td,{children:(0,r.jsx)(i.strong,{children:"Framework"})}),(0,r.jsx)(i.td,{children:"Python 3.11 + FastAPI"})]}),(0,r.jsxs)(i.tr,{children:[(0,r.jsx)(i.td,{children:(0,r.jsx)(i.strong,{children:"ORM"})}),(0,r.jsx)(i.td,{children:"SQLAlchemy 2.0 (async)"})]}),(0,r.jsxs)(i.tr,{children:[(0,r.jsx)(i.td,{children:(0,r.jsx)(i.strong,{children:"Validaci\xf3n"})}),(0,r.jsx)(i.td,{children:"Pydantic v2"})]}),(0,r.jsxs)(i.tr,{children:[(0,r.jsx)(i.td,{children:(0,r.jsx)(i.strong,{children:"Base de Datos"})}),(0,r.jsx)(i.td,{children:"PostgreSQL 15+"})]}),(0,r.jsxs)(i.tr,{children:[(0,r.jsx)(i.td,{children:(0,r.jsx)(i.strong,{children:"Cache"})}),(0,r.jsx)(i.td,{children:"Redis 7.0"})]}),(0,r.jsxs)(i.tr,{children:[(0,r.jsx)(i.td,{children:(0,r.jsx)(i.strong,{children:"Password Hashing"})}),(0,r.jsx)(i.td,{children:"bcrypt (via passlib)"})]}),(0,r.jsxs)(i.tr,{children:[(0,r.jsx)(i.td,{children:(0,r.jsx)(i.strong,{children:"JWT"})}),(0,r.jsx)(i.td,{children:"python-jose (RS256)"})]}),(0,r.jsxs)(i.tr,{children:[(0,r.jsx)(i.td,{children:(0,r.jsx)(i.strong,{children:"Message Broker"})}),(0,r.jsx)(i.td,{children:"RabbitMQ (pika)"})]}),(0,r.jsxs)(i.tr,{children:[(0,r.jsx)(i.td,{children:(0,r.jsx)(i.strong,{children:"gRPC"})}),(0,r.jsx)(i.td,{children:"grpcio"})]}),(0,r.jsxs)(i.tr,{children:[(0,r.jsx)(i.td,{children:(0,r.jsx)(i.strong,{children:"Testing"})}),(0,r.jsx)(i.td,{children:"Pytest + pytest-asyncio"})]})]})]}),"\n",(0,r.jsx)(i.h2,{id:"arquitectura-general",children:"Arquitectura General"}),"\n",(0,r.jsx)(i.mermaid,{value:'graph TB\n    subgraph "Clients"\n        WebApp[Web Application]\n        MobileApp[Mobile App]\n        OtherServices[Other Microservices]\n    end\n\n    subgraph "Auth Service"\n        REST[REST API]\n        gRPC[gRPC Server]\n        EventPub[Event Publisher]\n        BL[Business Logic]\n        Repo[Repository]\n    end\n\n    subgraph "Infrastructure"\n        PG[(PostgreSQL)]\n        Redis[(Redis)]\n        RMQ[RabbitMQ]\n    end\n\n    WebApp --\x3e|REST| REST\n    MobileApp --\x3e|REST| REST\n    OtherServices --\x3e|gRPC| gRPC\n\n    REST --\x3e BL\n    gRPC --\x3e BL\n    BL --\x3e Repo\n    BL --\x3e EventPub\n\n    Repo --\x3e PG\n    BL --\x3e Redis\n    EventPub --\x3e RMQ'}),"\n",(0,r.jsx)(i.h2,{id:"entidades-principales",children:"Entidades Principales"}),"\n",(0,r.jsx)(i.h3,{id:"users",children:"Users"}),"\n",(0,r.jsx)(i.p,{children:"Usuarios del sistema vinculados a una organizaci\xf3n."}),"\n",(0,r.jsx)(i.h3,{id:"organizations",children:"Organizations"}),"\n",(0,r.jsx)(i.p,{children:"Tenants/organizaciones que usan el ERP."}),"\n",(0,r.jsx)(i.h3,{id:"locals",children:"Locals"}),"\n",(0,r.jsx)(i.p,{children:"Sucursales o ubicaciones f\xedsicas de una organizaci\xf3n."}),"\n",(0,r.jsx)(i.h3,{id:"modules",children:"Modules"}),"\n",(0,r.jsx)(i.p,{children:"Funcionalidades del ERP (catalog, inventory, orders, etc.)."}),"\n",(0,r.jsx)(i.h3,{id:"permissions",children:"Permissions"}),"\n",(0,r.jsxs)(i.p,{children:["Acciones espec\xedficas (",(0,r.jsx)(i.code,{children:"catalog:create"}),", ",(0,r.jsx)(i.code,{children:"inventory:read"}),")."]}),"\n",(0,r.jsx)(i.h3,{id:"roles",children:"Roles"}),"\n",(0,r.jsx)(i.p,{children:"Agrupaciones de permisos definidas por cada organizaci\xf3n."}),"\n",(0,r.jsx)(i.h2,{id:"apis-expuestas",children:"APIs Expuestas"}),"\n",(0,r.jsx)(i.h3,{id:"rest-apis-p\xfablicas",children:"REST APIs (P\xfablicas)"}),"\n",(0,r.jsxs)(i.table,{children:[(0,r.jsx)(i.thead,{children:(0,r.jsxs)(i.tr,{children:[(0,r.jsx)(i.th,{children:"Endpoint"}),(0,r.jsx)(i.th,{children:"M\xe9todo"}),(0,r.jsx)(i.th,{children:"Descripci\xf3n"})]})}),(0,r.jsxs)(i.tbody,{children:[(0,r.jsxs)(i.tr,{children:[(0,r.jsx)(i.td,{children:(0,r.jsx)(i.code,{children:"/auth/login"})}),(0,r.jsx)(i.td,{children:"POST"}),(0,r.jsx)(i.td,{children:"Autenticaci\xf3n con credenciales"})]}),(0,r.jsxs)(i.tr,{children:[(0,r.jsx)(i.td,{children:(0,r.jsx)(i.code,{children:"/auth/refresh"})}),(0,r.jsx)(i.td,{children:"POST"}),(0,r.jsx)(i.td,{children:"Renovar access token"})]}),(0,r.jsxs)(i.tr,{children:[(0,r.jsx)(i.td,{children:(0,r.jsx)(i.code,{children:"/auth/logout"})}),(0,r.jsx)(i.td,{children:"POST"}),(0,r.jsx)(i.td,{children:"Cerrar sesi\xf3n"})]}),(0,r.jsxs)(i.tr,{children:[(0,r.jsx)(i.td,{children:(0,r.jsx)(i.code,{children:"/auth/verify"})}),(0,r.jsx)(i.td,{children:"POST"}),(0,r.jsx)(i.td,{children:"Verificar token (interno)"})]}),(0,r.jsxs)(i.tr,{children:[(0,r.jsx)(i.td,{children:(0,r.jsx)(i.code,{children:"/api/v1/users"})}),(0,r.jsx)(i.td,{children:"GET, POST, PUT, DELETE"}),(0,r.jsx)(i.td,{children:"Gesti\xf3n de usuarios"})]}),(0,r.jsxs)(i.tr,{children:[(0,r.jsx)(i.td,{children:(0,r.jsx)(i.code,{children:"/api/v1/roles"})}),(0,r.jsx)(i.td,{children:"GET, POST, PUT, DELETE"}),(0,r.jsx)(i.td,{children:"Gesti\xf3n de roles"})]}),(0,r.jsxs)(i.tr,{children:[(0,r.jsx)(i.td,{children:(0,r.jsx)(i.code,{children:"/api/v1/permissions"})}),(0,r.jsx)(i.td,{children:"GET, POST, PUT, DELETE"}),(0,r.jsx)(i.td,{children:"Gesti\xf3n de permisos"})]}),(0,r.jsxs)(i.tr,{children:[(0,r.jsx)(i.td,{children:(0,r.jsx)(i.code,{children:"/api/v1/locals"})}),(0,r.jsx)(i.td,{children:"GET, POST, PUT, DELETE"}),(0,r.jsx)(i.td,{children:"Gesti\xf3n de locales"})]}),(0,r.jsxs)(i.tr,{children:[(0,r.jsx)(i.td,{children:(0,r.jsx)(i.code,{children:"/api/v1/organizations"})}),(0,r.jsx)(i.td,{children:"GET, POST, PUT, DELETE"}),(0,r.jsx)(i.td,{children:"Gesti\xf3n de organizaciones"})]})]})]}),"\n",(0,r.jsx)(i.h3,{id:"grpc-apis-internas",children:"gRPC APIs (Internas)"}),"\n",(0,r.jsxs)(i.table,{children:[(0,r.jsx)(i.thead,{children:(0,r.jsxs)(i.tr,{children:[(0,r.jsx)(i.th,{children:"Service"}),(0,r.jsx)(i.th,{children:"Method"}),(0,r.jsx)(i.th,{children:"Descripci\xf3n"})]})}),(0,r.jsx)(i.tbody,{children:(0,r.jsxs)(i.tr,{children:[(0,r.jsx)(i.td,{children:(0,r.jsx)(i.code,{children:"AuthService"})}),(0,r.jsx)(i.td,{children:(0,r.jsx)(i.code,{children:"VerifyToken"})}),(0,r.jsx)(i.td,{children:"Validar token desde otros servicios"})]})})]}),"\n",(0,r.jsx)(i.h2,{id:"eventos-publicados",children:"Eventos Publicados"}),"\n",(0,r.jsx)(i.p,{children:"Auth Service publica eventos para notificar cambios:"}),"\n",(0,r.jsxs)(i.table,{children:[(0,r.jsx)(i.thead,{children:(0,r.jsxs)(i.tr,{children:[(0,r.jsx)(i.th,{children:"Evento"}),(0,r.jsx)(i.th,{children:"Cu\xe1ndo"})]})}),(0,r.jsxs)(i.tbody,{children:[(0,r.jsxs)(i.tr,{children:[(0,r.jsx)(i.td,{children:(0,r.jsx)(i.code,{children:"auth.user.created"})}),(0,r.jsx)(i.td,{children:"Usuario creado"})]}),(0,r.jsxs)(i.tr,{children:[(0,r.jsx)(i.td,{children:(0,r.jsx)(i.code,{children:"auth.user.updated"})}),(0,r.jsx)(i.td,{children:"Usuario actualizado"})]}),(0,r.jsxs)(i.tr,{children:[(0,r.jsx)(i.td,{children:(0,r.jsx)(i.code,{children:"auth.user.deactivated"})}),(0,r.jsx)(i.td,{children:"Usuario desactivado"})]}),(0,r.jsxs)(i.tr,{children:[(0,r.jsx)(i.td,{children:(0,r.jsx)(i.code,{children:"auth.user.deleted"})}),(0,r.jsx)(i.td,{children:"Usuario eliminado"})]}),(0,r.jsxs)(i.tr,{children:[(0,r.jsx)(i.td,{children:(0,r.jsx)(i.code,{children:"auth.user.password_changed"})}),(0,r.jsx)(i.td,{children:"Contrase\xf1a cambiada"})]}),(0,r.jsxs)(i.tr,{children:[(0,r.jsx)(i.td,{children:(0,r.jsx)(i.code,{children:"auth.role.created"})}),(0,r.jsx)(i.td,{children:"Rol creado"})]}),(0,r.jsxs)(i.tr,{children:[(0,r.jsx)(i.td,{children:(0,r.jsx)(i.code,{children:"auth.role.updated"})}),(0,r.jsx)(i.td,{children:"Rol actualizado"})]}),(0,r.jsxs)(i.tr,{children:[(0,r.jsx)(i.td,{children:(0,r.jsx)(i.code,{children:"auth.role.deleted"})}),(0,r.jsx)(i.td,{children:"Rol eliminado"})]}),(0,r.jsxs)(i.tr,{children:[(0,r.jsx)(i.td,{children:(0,r.jsx)(i.code,{children:"auth.role.permissions_changed"})}),(0,r.jsx)(i.td,{children:"Permisos de rol cambiados"})]}),(0,r.jsxs)(i.tr,{children:[(0,r.jsx)(i.td,{children:(0,r.jsx)(i.code,{children:"auth.permission.created"})}),(0,r.jsx)(i.td,{children:"Permiso creado (admin)"})]}),(0,r.jsxs)(i.tr,{children:[(0,r.jsx)(i.td,{children:(0,r.jsx)(i.code,{children:"auth.permission.updated"})}),(0,r.jsx)(i.td,{children:"Permiso actualizado (admin)"})]}),(0,r.jsxs)(i.tr,{children:[(0,r.jsx)(i.td,{children:(0,r.jsx)(i.code,{children:"auth.permission.deleted"})}),(0,r.jsx)(i.td,{children:"Permiso eliminado (admin)"})]}),(0,r.jsxs)(i.tr,{children:[(0,r.jsx)(i.td,{children:(0,r.jsx)(i.code,{children:"auth.organization.created"})}),(0,r.jsx)(i.td,{children:"Organizaci\xf3n creada"})]}),(0,r.jsxs)(i.tr,{children:[(0,r.jsx)(i.td,{children:(0,r.jsx)(i.code,{children:"auth.organization.updated"})}),(0,r.jsx)(i.td,{children:"Organizaci\xf3n actualizada"})]}),(0,r.jsxs)(i.tr,{children:[(0,r.jsx)(i.td,{children:(0,r.jsx)(i.code,{children:"auth.organization.suspended"})}),(0,r.jsx)(i.td,{children:"Organizaci\xf3n suspendida"})]}),(0,r.jsxs)(i.tr,{children:[(0,r.jsx)(i.td,{children:(0,r.jsx)(i.code,{children:"auth.organization.reactivated"})}),(0,r.jsx)(i.td,{children:"Organizaci\xf3n reactivada"})]}),(0,r.jsxs)(i.tr,{children:[(0,r.jsx)(i.td,{children:(0,r.jsx)(i.code,{children:"auth.organization.module_enabled"})}),(0,r.jsx)(i.td,{children:"M\xf3dulo habilitado"})]}),(0,r.jsxs)(i.tr,{children:[(0,r.jsx)(i.td,{children:(0,r.jsx)(i.code,{children:"auth.organization.module_disabled"})}),(0,r.jsx)(i.td,{children:"M\xf3dulo deshabilitado"})]}),(0,r.jsxs)(i.tr,{children:[(0,r.jsx)(i.td,{children:(0,r.jsx)(i.code,{children:"auth.local.created"})}),(0,r.jsx)(i.td,{children:"Local creado"})]}),(0,r.jsxs)(i.tr,{children:[(0,r.jsx)(i.td,{children:(0,r.jsx)(i.code,{children:"auth.local.updated"})}),(0,r.jsx)(i.td,{children:"Local actualizado"})]}),(0,r.jsxs)(i.tr,{children:[(0,r.jsx)(i.td,{children:(0,r.jsx)(i.code,{children:"auth.local.deleted"})}),(0,r.jsx)(i.td,{children:"Local eliminado"})]}),(0,r.jsxs)(i.tr,{children:[(0,r.jsx)(i.td,{children:(0,r.jsx)(i.code,{children:"auth.session.created"})}),(0,r.jsx)(i.td,{children:"Login exitoso"})]}),(0,r.jsxs)(i.tr,{children:[(0,r.jsx)(i.td,{children:(0,r.jsx)(i.code,{children:"auth.session.revoked"})}),(0,r.jsx)(i.td,{children:"Logout"})]}),(0,r.jsxs)(i.tr,{children:[(0,r.jsx)(i.td,{children:(0,r.jsx)(i.code,{children:"auth.token.revoked"})}),(0,r.jsx)(i.td,{children:"Token revocado manualmente"})]})]})]}),"\n",(0,r.jsx)(i.admonition,{title:"Event-Driven",type:"tip",children:(0,r.jsx)(i.p,{children:"Estos eventos permiten que otros servicios reaccionen a cambios en Auth Service, manteniendo consistencia eventual del sistema."})}),"\n",(0,r.jsx)(i.h2,{id:"consumidores-de-eventos",children:"Consumidores de Eventos"}),"\n",(0,r.jsxs)(i.p,{children:[(0,r.jsx)(i.strong,{children:"Servicios que consumen eventos de Auth"}),":"]}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.strong,{children:"Catalog Service"}),": Invalida cache cuando cambian permisos"]}),"\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.strong,{children:"Inventory Service"}),": Valida locales activos"]}),"\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.strong,{children:"Order Service"}),": Bloquea \xf3rdenes de usuarios inactivos"]}),"\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.strong,{children:"Audit Service"}),": Registra todos los eventos de auth"]}),"\n"]}),"\n",(0,r.jsx)(i.h2,{id:"flujos-principales",children:"Flujos Principales"}),"\n",(0,r.jsx)(i.h3,{id:"flujo-de-login",children:"Flujo de Login"}),"\n",(0,r.jsx)(i.mermaid,{value:'sequenceDiagram\n    participant User\n    participant Auth\n    participant DB\n    participant Redis\n    participant RabbitMQ\n\n    User->>Auth: POST /auth/login<br/>{email, password}\n    Auth->>DB: Buscar usuario por email\n    DB--\x3e>Auth: Usuario encontrado\n    Auth->>Auth: Verificar password (bcrypt)\n    Auth->>DB: Obtener roles, permisos, locales\n    Auth->>Redis: Guardar sesi\xf3n\n    Auth->>Auth: Generar Access + Refresh tokens\n    Auth->>RabbitMQ: Publicar "auth.session.created"\n    Auth--\x3e>User: {access_token, refresh_token, user}'}),"\n",(0,r.jsx)(i.h3,{id:"flujo-de-verificaci\xf3n-de-token",children:"Flujo de Verificaci\xf3n de Token"}),"\n",(0,r.jsx)(i.mermaid,{value:"sequenceDiagram\n    participant Catalog\n    participant Auth\n    participant Redis\n\n    Catalog->>Auth: VerifyToken(token) [gRPC]\n    Auth->>Auth: Validar firma JWT\n    Auth->>Redis: Buscar en cache\n    alt Cache hit\n        Redis--\x3e>Auth: Datos del usuario\n    else Cache miss\n        Auth->>DB: Consultar usuario\n        DB--\x3e>Auth: Datos completos\n        Auth->>Redis: Cachear resultado\n    end\n    Auth--\x3e>Catalog: {user_id, org_id, permissions, locals}\n    Catalog->>Catalog: Autorizar operaci\xf3n"}),"\n",(0,r.jsx)(i.h2,{id:"seguridad",children:"Seguridad"}),"\n",(0,r.jsx)(i.h3,{id:"protecci\xf3n-de-contrase\xf1as",children:"Protecci\xf3n de Contrase\xf1as"}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{className:"language-python",children:'from passlib.context import CryptContext\n\npwd_context = CryptContext(\n    schemes=["bcrypt"],\n    deprecated="auto"\n)\n\n# Al crear usuario\nhashed = pwd_context.hash(password)\n\n# Al validar\nis_valid = pwd_context.verify(password, hashed)\n'})}),"\n",(0,r.jsx)(i.h3,{id:"tokens-jwt",children:"Tokens JWT"}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{className:"language-json",children:'{\n  "header": {\n    "alg": "RS256",\n    "typ": "JWT"\n  },\n  "payload": {\n    "user_id": "user_001",\n    "organization_id": "org_123",\n    "permissions": ["catalog:read", "catalog:create"],\n    "locals": ["local_01"],\n    "exp": 1705851600,\n    "iat": 1705850700\n  }\n}\n'})}),"\n",(0,r.jsxs)(i.p,{children:[(0,r.jsx)(i.strong,{children:"Access Token"}),": 15 minutos\n",(0,r.jsx)(i.strong,{children:"Refresh Token"}),": 7 d\xedas"]}),"\n",(0,r.jsx)(i.h3,{id:"rate-limiting",children:"Rate Limiting"}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{children:"/auth/login: 5 requests/minuto por IP\n/auth/verify: 1000 requests/minuto por servicio\n"})}),"\n",(0,r.jsx)(i.h3,{id:"bloqueo-por-intentos-fallidos",children:"Bloqueo por Intentos Fallidos"}),"\n",(0,r.jsx)(i.p,{children:"Despu\xe9s de 5 intentos fallidos \u2192 usuario bloqueado por 15 minutos."}),"\n",(0,r.jsx)(i.h2,{id:"m\xe9tricas-y-observabilidad",children:"M\xe9tricas y Observabilidad"}),"\n",(0,r.jsx)(i.h3,{id:"logs-estructurados",children:"Logs Estructurados"}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{className:"language-json",children:'{\n  "timestamp": "2025-11-15T10:30:00Z",\n  "level": "INFO",\n  "service": "auth-service",\n  "event": "user_login_success",\n  "user_id": "user_001",\n  "organization_id": "org_123",\n  "correlation_id": "req_9912ABCD"\n}\n'})}),"\n",(0,r.jsx)(i.h3,{id:"health-checks",children:"Health Checks"}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.code,{children:"/health"}),": Estado general del servicio"]}),"\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.code,{children:"/ready"}),": \xbfListo para recibir requests?"]}),"\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.code,{children:"/live"}),": \xbfEl servicio est\xe1 vivo?"]}),"\n"]}),"\n",(0,r.jsx)(i.h3,{id:"m\xe9tricas-prometheus",children:"M\xe9tricas (Prometheus)"}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsx)(i.li,{children:"Logins exitosos/fallidos por minuto"}),"\n",(0,r.jsx)(i.li,{children:"Tokens generados por minuto"}),"\n",(0,r.jsx)(i.li,{children:"Latencia de verificaci\xf3n de tokens"}),"\n",(0,r.jsx)(i.li,{children:"Usuarios bloqueados"}),"\n",(0,r.jsx)(i.li,{children:"Cache hit/miss ratio"}),"\n"]}),"\n",(0,r.jsx)(i.h2,{id:"pr\xf3ximos-pasos",children:"Pr\xf3ximos Pasos"}),"\n",(0,r.jsx)(i.p,{children:"Explora la documentaci\xf3n detallada de Auth Service:"}),"\n",(0,r.jsxs)(i.ol,{children:["\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.a,{href:"/microservicios/auth-service/alcance",children:"Alcance"})," - Qu\xe9 hace y qu\xe9 NO hace"]}),"\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.a,{href:"/microservicios/auth-service/arquitectura",children:"Arquitectura"})," - Dise\xf1o interno"]}),"\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.a,{href:"/microservicios/auth-service/modelo-datos",children:"Modelo de Datos"})," - Entidades y relaciones"]}),"\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.a,{href:"/microservicios/auth-service/eventos-publicados",children:"Eventos Publicados"})," - Event-Driven"]}),"\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.a,{href:"/microservicios/auth-service/grpc-server",children:"gRPC Server"})," - API interna"]}),"\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.a,{href:"/microservicios/auth-service/api-auth",children:"API Auth"})," - Login, refresh, logout"]}),"\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.a,{href:"/microservicios/auth-service/api-users",children:"API Users"})," - Gesti\xf3n de usuarios"]}),"\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.a,{href:"/microservicios/auth-service/flujos-negocio",children:"Flujos de Negocio"})," - Diagramas de flujo"]}),"\n"]})]})}function h(e={}){const{wrapper:i}={...(0,d.R)(),...e.components};return i?(0,r.jsx)(i,{...e,children:(0,r.jsx)(o,{...e})}):o(e)}},8453:(e,i,n)=>{n.d(i,{R:()=>c,x:()=>l});var s=n(6540);const r={},d=s.createContext(r);function c(e){const i=s.useContext(d);return s.useMemo(function(){return"function"==typeof e?e(i):{...i,...e}},[i,e])}function l(e){let i;return i=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:c(e.components),s.createElement(d.Provider,{value:i},e.children)}}}]);