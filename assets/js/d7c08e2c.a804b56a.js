"use strict";(globalThis.webpackChunkerp_docs=globalThis.webpackChunkerp_docs||[]).push([[1269],{5853:(n,e,a)=>{a.r(e),a.d(e,{assets:()=>c,contentTitle:()=>d,default:()=>_,frontMatter:()=>o,metadata:()=>i,toc:()=>s});const i=JSON.parse('{"id":"microservicios/catalog-service/modelo-datos","title":"Modelo de Datos","description":"Modelo de datos completo del Catalog Service con todas las entidades y relaciones.","source":"@site/docs/02-microservicios/catalog-service/03-modelo-datos.md","sourceDirName":"02-microservicios/catalog-service","slug":"/microservicios/catalog-service/modelo-datos","permalink":"/zenlogic/microservicios/catalog-service/modelo-datos","draft":false,"unlisted":false,"editUrl":"https://github.com/your-repo/edit/main/docs/02-microservicios/catalog-service/03-modelo-datos.md","tags":[],"version":"current","sidebarPosition":4,"frontMatter":{"sidebar_position":4},"sidebar":"docs","previous":{"title":"Arquitectura Interna","permalink":"/zenlogic/microservicios/catalog-service/arquitectura"},"next":{"title":"Configuraci\xf3n","permalink":"/zenlogic/microservicios/catalog-service/configuracion"}}');var t=a(4848),r=a(8453);const o={sidebar_position:4},d="Modelo de Datos",c={},s=[{value:"Diagrama de Entidad-Relaci\xf3n Completo",id:"diagrama-de-entidad-relaci\xf3n-completo",level:2},{value:"Tablas Principales",id:"tablas-principales",level:2},{value:"Products",id:"products",level:3},{value:"Brands",id:"brands",level:3},{value:"Product_Images",id:"product_images",level:3},{value:"Tags",id:"tags",level:3},{value:"Product_Tags",id:"product_tags",level:3},{value:"Collections",id:"collections",level:3},{value:"Product_Collections",id:"product_collections",level:3},{value:"Product_Variants",id:"product_variants",level:3},{value:"Variant_Images",id:"variant_images",level:3},{value:"Price_Tiers",id:"price_tiers",level:3},{value:"Price_Tier_Rules",id:"price_tier_rules",level:3},{value:"Ejemplo de Datos Completo",id:"ejemplo-de-datos-completo",level:2},{value:"Producto: Camiseta Deportiva",id:"producto-camiseta-deportiva",level:3},{value:"Queries Comunes",id:"queries-comunes",level:2},{value:"Obtener Producto Completo",id:"obtener-producto-completo",level:3},{value:"Buscar Productos con Filtros",id:"buscar-productos-con-filtros",level:3},{value:"Obtener Variantes con Price Tiers",id:"obtener-variantes-con-price-tiers",level:3},{value:"SQLAlchemy Models",id:"sqlalchemy-models",level:2},{value:"Product Model",id:"product-model",level:3},{value:"Brand Model",id:"brand-model",level:3},{value:"ProductVariant Model",id:"productvariant-model",level:3},{value:"Collection Model",id:"collection-model",level:3},{value:"PriceTier Model",id:"pricetier-model",level:3},{value:"Pr\xf3ximos Pasos",id:"pr\xf3ximos-pasos",level:2}];function l(n){const e={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",mermaid:"mermaid",p:"p",pre:"pre",ul:"ul",...(0,r.R)(),...n.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(e.header,{children:(0,t.jsx)(e.h1,{id:"modelo-de-datos",children:"Modelo de Datos"})}),"\n",(0,t.jsx)(e.p,{children:"Modelo de datos completo del Catalog Service con todas las entidades y relaciones."}),"\n",(0,t.jsx)(e.h2,{id:"diagrama-de-entidad-relaci\xf3n-completo",children:"Diagrama de Entidad-Relaci\xf3n Completo"}),"\n",(0,t.jsx)(e.mermaid,{value:'erDiagram\n    PRODUCT ||--o{ PRODUCT_VARIANT : "tiene"\n    PRODUCT ||--o{ PRODUCT_IMAGE : "tiene im\xe1genes"\n    PRODUCT ||--o{ PRODUCT_TAG : "tagged"\n    PRODUCT ||--o{ PRODUCT_COLLECTION : "categorizado"\n    PRODUCT ||--|{ BRAND : "pertenece a"\n\n    BRAND ||--o{ PRODUCT : "tiene productos"\n\n    PRODUCT_VARIANT ||--o{ VARIANT_IMAGE : "tiene im\xe1genes"\n    PRODUCT_VARIANT ||--o{ PRICE_TIER_RULE : "usa"\n\n    TAG ||--o{ PRODUCT_TAG : "asignado"\n\n    COLLECTION ||--o{ PRODUCT_COLLECTION : "incluye productos"\n    COLLECTION ||--o{ COLLECTION : "parent of"\n\n    PRICE_TIER ||--o{ PRICE_TIER_RULE : "tiene reglas"\n    PRICE_TIER_RULE }o--|| PRODUCT_VARIANT : "aplica a"\n\n    PRODUCT {\n        varchar id PK\n        varchar organization_id FK\n        varchar local_id\n        varchar title\n        varchar sku UK\n        varchar barcode\n        text description\n        varchar status\n        varchar product_type\n        varchar unit_of_measure\n        int alert_stock\n        varchar brand_id FK\n        timestamp created_date\n        timestamp updated_date\n    }\n\n    BRAND {\n        varchar id PK\n        varchar organization_id FK\n        varchar name\n        varchar slug UK\n        text description\n        varchar status\n        timestamp created_date\n        timestamp updated_date\n    }\n\n    PRODUCT_IMAGE {\n        varchar id PK\n        varchar product_id FK\n        varchar url\n        varchar alt\n        int position\n        timestamp created_date\n    }\n\n    TAG {\n        varchar id PK\n        varchar organization_id FK\n        varchar name UK\n        timestamp created_date\n    }\n\n    PRODUCT_TAG {\n        varchar product_id PK,FK\n        varchar tag_id PK,FK\n    }\n\n    COLLECTION {\n        varchar id PK\n        varchar organization_id FK\n        varchar name\n        varchar slug UK\n        text description\n        varchar status\n        varchar image\n        varchar parent_id FK\n        timestamp created_date\n        timestamp updated_date\n    }\n\n    PRODUCT_COLLECTION {\n        varchar product_id PK,FK\n        varchar collection_id PK,FK\n    }\n\n    PRODUCT_VARIANT {\n        varchar id PK\n        varchar product_id FK\n        varchar sku UK\n        varchar barcode UK\n        decimal sale_price\n        decimal cost_price\n        decimal tax\n        decimal weight\n        decimal dim_length\n        decimal dim_width\n        decimal dim_height\n        varchar lot_number\n        int stock_total\n        int stock_available\n        int stock_reserved\n        varchar warehouse_id\n        varchar vendor\n        boolean track_inventory\n        int default_min_stock\n        int default_max_stock\n        timestamp created_date\n        timestamp updated_date\n    }\n\n    VARIANT_IMAGE {\n        varchar id PK\n        varchar variant_id FK\n        varchar url\n        varchar alt\n        int position\n        timestamp created_date\n    }\n\n    PRICE_TIER {\n        varchar id PK\n        varchar name\n        text description\n        varchar organization_id FK\n        timestamp created_date\n        timestamp updated_date\n    }\n\n    PRICE_TIER_RULE {\n        varchar id PK\n        varchar price_tier_id FK\n        varchar variant_id FK\n        int min_qty\n        decimal price\n    }'}),"\n",(0,t.jsx)(e.h2,{id:"tablas-principales",children:"Tablas Principales"}),"\n",(0,t.jsx)(e.h3,{id:"products",children:"Products"}),"\n",(0,t.jsx)(e.p,{children:"Tabla principal de productos. Representa un producto gen\xe9rico con toda su informaci\xf3n."}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-sql",children:"CREATE TABLE products (\n    id VARCHAR(50) PRIMARY KEY,\n    organization_id VARCHAR(50) NOT NULL,\n    local_id VARCHAR(50),  -- ID de local/tienda f\xedsica\n    title VARCHAR(255) NOT NULL,\n    sku VARCHAR(100) NOT NULL,\n    barcode VARCHAR(100),\n    description TEXT,\n    status VARCHAR(20) DEFAULT 'activa',  -- 'activa', 'inactiva'\n    product_type VARCHAR(100),  -- 'ropa-deporte', 'electronica', etc.\n    unit_of_measure VARCHAR(50) DEFAULT 'unidad',\n    alert_stock INT DEFAULT 0,\n    brand_id VARCHAR(50),\n    created_date TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n    updated_date TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n\n    CONSTRAINT fk_products_organization\n        FOREIGN KEY (organization_id)\n        REFERENCES organizations(id)\n        ON DELETE CASCADE,\n\n    CONSTRAINT fk_products_brand\n        FOREIGN KEY (brand_id)\n        REFERENCES brands(id)\n        ON DELETE SET NULL,\n\n    CONSTRAINT uk_product_org_sku\n        UNIQUE (organization_id, sku)\n);\n\nCREATE INDEX idx_products_org ON products(organization_id);\nCREATE INDEX idx_products_status ON products(status);\nCREATE INDEX idx_products_brand ON products(brand_id);\nCREATE INDEX idx_products_sku ON products(sku);\nCREATE INDEX idx_products_title ON products USING gin(to_tsvector('spanish', title));\nCREATE INDEX idx_products_product_type ON products(product_type);\n"})}),"\n",(0,t.jsx)(e.h3,{id:"brands",children:"Brands"}),"\n",(0,t.jsx)(e.p,{children:"Marcas comerciales de productos."}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-sql",children:"CREATE TABLE brands (\n    id VARCHAR(50) PRIMARY KEY,\n    organization_id VARCHAR(50) NOT NULL,\n    name VARCHAR(255) NOT NULL,\n    slug VARCHAR(255) NOT NULL,\n    description TEXT,\n    status VARCHAR(20) DEFAULT 'active',  -- 'active', 'inactive'\n    created_date TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n    updated_date TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n\n    CONSTRAINT fk_brands_organization\n        FOREIGN KEY (organization_id)\n        REFERENCES organizations(id)\n        ON DELETE CASCADE,\n\n    CONSTRAINT uk_brand_org_slug\n        UNIQUE (organization_id, slug)\n);\n\nCREATE INDEX idx_brands_org ON brands(organization_id);\nCREATE INDEX idx_brands_status ON brands(status);\nCREATE INDEX idx_brands_name ON brands USING gin(to_tsvector('spanish', name));\n"})}),"\n",(0,t.jsx)(e.h3,{id:"product_images",children:"Product_Images"}),"\n",(0,t.jsx)(e.p,{children:"Im\xe1genes asociadas a productos."}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-sql",children:"CREATE TABLE product_images (\n    id VARCHAR(50) PRIMARY KEY,\n    product_id VARCHAR(50) NOT NULL,\n    url VARCHAR(500) NOT NULL,\n    alt VARCHAR(255),\n    position INT DEFAULT 0,\n    created_date TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n\n    CONSTRAINT fk_product_images_product\n        FOREIGN KEY (product_id)\n        REFERENCES products(id)\n        ON DELETE CASCADE\n);\n\nCREATE INDEX idx_product_images_product ON product_images(product_id);\nCREATE INDEX idx_product_images_position ON product_images(product_id, position);\n"})}),"\n",(0,t.jsx)(e.h3,{id:"tags",children:"Tags"}),"\n",(0,t.jsx)(e.p,{children:"Etiquetas para clasificaci\xf3n flexible de productos."}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-sql",children:"CREATE TABLE tags (\n    id VARCHAR(50) PRIMARY KEY,\n    organization_id VARCHAR(50) NOT NULL,\n    name VARCHAR(100) NOT NULL,\n    created_date TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n\n    CONSTRAINT fk_tags_organization\n        FOREIGN KEY (organization_id)\n        REFERENCES organizations(id)\n        ON DELETE CASCADE,\n\n    CONSTRAINT uk_tag_org_name\n        UNIQUE (organization_id, name)\n);\n\nCREATE INDEX idx_tags_org ON tags(organization_id);\nCREATE INDEX idx_tags_name ON tags(name);\n"})}),"\n",(0,t.jsx)(e.h3,{id:"product_tags",children:"Product_Tags"}),"\n",(0,t.jsx)(e.p,{children:"Relaci\xf3n Many-to-Many entre productos y tags."}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-sql",children:"CREATE TABLE product_tags (\n    product_id VARCHAR(50) NOT NULL,\n    tag_id VARCHAR(50) NOT NULL,\n\n    PRIMARY KEY (product_id, tag_id),\n\n    CONSTRAINT fk_product_tags_product\n        FOREIGN KEY (product_id)\n        REFERENCES products(id)\n        ON DELETE CASCADE,\n\n    CONSTRAINT fk_product_tags_tag\n        FOREIGN KEY (tag_id)\n        REFERENCES tags(id)\n        ON DELETE CASCADE\n);\n\nCREATE INDEX idx_product_tags_tag ON product_tags(tag_id);\n"})}),"\n",(0,t.jsx)(e.h3,{id:"collections",children:"Collections"}),"\n",(0,t.jsx)(e.p,{children:"Colecciones/categor\xedas para agrupar productos."}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-sql",children:"CREATE TABLE collections (\n    id VARCHAR(50) PRIMARY KEY,\n    organization_id VARCHAR(50) NOT NULL,\n    name VARCHAR(255) NOT NULL,\n    slug VARCHAR(255) NOT NULL,\n    description TEXT,\n    status VARCHAR(20) DEFAULT 'activa',  -- 'activa', 'inactiva'\n    image VARCHAR(500),\n    parent_id VARCHAR(50),  -- Para jerarqu\xeda de categor\xedas\n    created_date TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n    updated_date TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n\n    CONSTRAINT fk_collections_organization\n        FOREIGN KEY (organization_id)\n        REFERENCES organizations(id)\n        ON DELETE CASCADE,\n\n    CONSTRAINT fk_collections_parent\n        FOREIGN KEY (parent_id)\n        REFERENCES collections(id)\n        ON DELETE SET NULL,\n\n    CONSTRAINT uk_collection_org_slug\n        UNIQUE (organization_id, slug)\n);\n\nCREATE INDEX idx_collections_org ON collections(organization_id);\nCREATE INDEX idx_collections_status ON collections(status);\nCREATE INDEX idx_collections_parent ON collections(parent_id);\nCREATE INDEX idx_collections_name ON collections USING gin(to_tsvector('spanish', name));\n"})}),"\n",(0,t.jsx)(e.h3,{id:"product_collections",children:"Product_Collections"}),"\n",(0,t.jsx)(e.p,{children:"Relaci\xf3n Many-to-Many entre productos y colecciones."}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-sql",children:"CREATE TABLE product_collections (\n    product_id VARCHAR(50) NOT NULL,\n    collection_id VARCHAR(50) NOT NULL,\n\n    PRIMARY KEY (product_id, collection_id),\n\n    CONSTRAINT fk_product_collections_product\n        FOREIGN KEY (product_id)\n        REFERENCES products(id)\n        ON DELETE CASCADE,\n\n    CONSTRAINT fk_product_collections_collection\n        FOREIGN KEY (collection_id)\n        REFERENCES collections(id)\n        ON DELETE CASCADE\n);\n\nCREATE INDEX idx_product_collections_collection ON product_collections(collection_id);\n"})}),"\n",(0,t.jsx)(e.h3,{id:"product_variants",children:"Product_Variants"}),"\n",(0,t.jsx)(e.p,{children:"Variantes de productos con precios, inventario y atributos espec\xedficos."}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-sql",children:"CREATE TABLE product_variants (\n    id VARCHAR(50) PRIMARY KEY,\n    product_id VARCHAR(50) NOT NULL,\n    sku VARCHAR(100) NOT NULL,\n    barcode VARCHAR(100) UNIQUE,  -- C\xf3digo de barras \xfanico de variante\n    sale_price DECIMAL(10, 2) NOT NULL,\n    cost_price DECIMAL(10, 2),\n    tax DECIMAL(5, 2) DEFAULT 0,  -- Porcentaje de impuesto\n    weight DECIMAL(10, 2),  -- En kg\n    dim_length DECIMAL(10, 2),  -- En cm\n    dim_width DECIMAL(10, 2),\n    dim_height DECIMAL(10, 2),\n    lot_number VARCHAR(100),\n    stock_total INT DEFAULT 0,\n    stock_available INT DEFAULT 0,\n    stock_reserved INT DEFAULT 0,\n    warehouse_id VARCHAR(50) NOT NULL,  -- Foreign key l\xf3gica a Auth Service\n    vendor VARCHAR(255),  -- Proveedor\n    track_inventory BOOLEAN DEFAULT TRUE,  -- Si se debe rastrear inventario para esta variante\n    default_min_stock INT DEFAULT 20,  -- Stock m\xednimo recomendado\n    default_max_stock INT DEFAULT 1000,  -- Stock m\xe1ximo recomendado\n    created_date TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n    updated_date TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n\n    CONSTRAINT fk_variants_product\n        FOREIGN KEY (product_id)\n        REFERENCES products(id)\n        ON DELETE CASCADE,\n\n    CONSTRAINT uk_variant_sku\n        UNIQUE (sku),\n\n    CONSTRAINT chk_variant_stock\n        CHECK (stock_available >= 0 AND stock_reserved >= 0 AND stock_total = stock_available + stock_reserved),\n\n    CONSTRAINT chk_variant_stock_levels\n        CHECK (default_min_stock >= 0 AND default_max_stock >= default_min_stock)\n);\n\nCREATE INDEX idx_variants_product ON product_variants(product_id);\nCREATE INDEX idx_variants_sku ON product_variants(sku);\nCREATE INDEX idx_variants_barcode ON product_variants(barcode);\nCREATE INDEX idx_variants_warehouse ON product_variants(warehouse_id);\nCREATE INDEX idx_variants_lot_number ON product_variants(lot_number);\nCREATE INDEX idx_variants_sale_price ON product_variants(sale_price);\nCREATE INDEX idx_variants_track_inventory ON product_variants(track_inventory);\n"})}),"\n",(0,t.jsx)(e.h3,{id:"variant_images",children:"Variant_Images"}),"\n",(0,t.jsx)(e.p,{children:"Im\xe1genes espec\xedficas de variantes."}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-sql",children:"CREATE TABLE variant_images (\n    id VARCHAR(50) PRIMARY KEY,\n    variant_id VARCHAR(50) NOT NULL,\n    url VARCHAR(500) NOT NULL,\n    alt VARCHAR(255),\n    position INT DEFAULT 0,\n    created_date TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n\n    CONSTRAINT fk_variant_images_variant\n        FOREIGN KEY (variant_id)\n        REFERENCES product_variants(id)\n        ON DELETE CASCADE\n);\n\nCREATE INDEX idx_variant_images_variant ON variant_images(variant_id);\nCREATE INDEX idx_variant_images_position ON variant_images(variant_id, position);\n"})}),"\n",(0,t.jsx)(e.h3,{id:"price_tiers",children:"Price_Tiers"}),"\n",(0,t.jsx)(e.p,{children:"Definici\xf3n de grupos de precios por volumen."}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-sql",children:"CREATE TABLE price_tiers (\n    id VARCHAR(50) PRIMARY KEY,\n    organization_id VARCHAR(50) NOT NULL,\n    name VARCHAR(255) NOT NULL,\n    description TEXT,\n    created_date TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n    updated_date TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n\n    CONSTRAINT fk_price_tiers_organization\n        FOREIGN KEY (organization_id)\n        REFERENCES organizations(id)\n        ON DELETE CASCADE,\n\n    CONSTRAINT uk_price_tier_org_name\n        UNIQUE (organization_id, name)\n);\n\nCREATE INDEX idx_price_tiers_org ON price_tiers(organization_id);\n"})}),"\n",(0,t.jsx)(e.h3,{id:"price_tier_rules",children:"Price_Tier_Rules"}),"\n",(0,t.jsx)(e.p,{children:"Reglas espec\xedficas de precios por volumen para variantes."}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-sql",children:"CREATE TABLE price_tier_rules (\n    id VARCHAR(50) PRIMARY KEY,\n    price_tier_id VARCHAR(50) NOT NULL,\n    variant_id VARCHAR(50) NOT NULL,\n    min_qty INT NOT NULL,\n    price DECIMAL(10, 2) NOT NULL,\n\n    CONSTRAINT fk_price_tier_rules_tier\n        FOREIGN KEY (price_tier_id)\n        REFERENCES price_tiers(id)\n        ON DELETE CASCADE,\n\n    CONSTRAINT fk_price_tier_rules_variant\n        FOREIGN KEY (variant_id)\n        REFERENCES product_variants(id)\n        ON DELETE CASCADE,\n\n    CONSTRAINT uk_price_tier_rule\n        UNIQUE (price_tier_id, variant_id, min_qty),\n\n    CONSTRAINT chk_price_tier_min_qty\n        CHECK (min_qty > 0)\n);\n\nCREATE INDEX idx_price_tier_rules_tier ON price_tier_rules(price_tier_id);\nCREATE INDEX idx_price_tier_rules_variant ON price_tier_rules(variant_id);\nCREATE INDEX idx_price_tier_rules_min_qty ON price_tier_rules(min_qty);\n"})}),"\n",(0,t.jsx)(e.h2,{id:"ejemplo-de-datos-completo",children:"Ejemplo de Datos Completo"}),"\n",(0,t.jsx)(e.h3,{id:"producto-camiseta-deportiva",children:"Producto: Camiseta Deportiva"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-sql",children:"-- Brand\nINSERT INTO brands (id, organization_id, name, slug, description, status)\nVALUES ('brand_01', 'org_123', 'SportBrand', 'sportbrand', 'Marca deportiva premium', 'active');\n\n-- Tags\nINSERT INTO tags (id, organization_id, name)\nVALUES\n    ('tag_deporte', 'org_123', 'Deporte'),\n    ('tag_hombre', 'org_123', 'Hombre'),\n    ('tag_premium', 'org_123', 'Premium');\n\n-- Collections\nINSERT INTO collections (id, organization_id, name, slug, description, status, parent_id)\nVALUES\n    ('col_100', 'org_123', 'Ropa Deportiva', 'ropa-deportiva', 'Colecci\xf3n general de ropa deportiva', 'activa', NULL),\n    ('col_300', 'org_123', 'Accesorios', 'accesorios', 'Accesorios deportivos', 'activa', NULL);\n\n-- Producto\nINSERT INTO products (id, organization_id, title, sku, barcode, description, status, product_type, unit_of_measure, alert_stock, brand_id)\nVALUES ('prod_2002', 'org_123', 'Camiseta Deportiva Hombre', 'TSH-MEN-2002', '9876543210987', 'Camiseta deportiva de manga corta', 'activa', 'ropa-deporte', 'unidad', 50, 'brand_01');\n\n-- Im\xe1genes del producto\nINSERT INTO product_images (id, product_id, url, alt, position)\nVALUES\n    ('img_2002A', 'prod_2002', 'https://cdn.example.com/products/tsh-men-2002-front.jpg', 'Frontal', 1),\n    ('img_2002B', 'prod_2002', 'https://cdn.example.com/products/tsh-men-2002-back.jpg', 'Trasera', 2);\n\n-- Tags del producto\nINSERT INTO product_tags (product_id, tag_id)\nVALUES\n    ('prod_2002', 'tag_deporte'),\n    ('prod_2002', 'tag_hombre');\n\n-- Collections del producto\nINSERT INTO product_collections (product_id, collection_id)\nVALUES\n    ('prod_2002', 'col_100');\n\n-- Variante: Azul M\nINSERT INTO product_variants (id, product_id, sku, sale_price, cost_price, tax, weight, dim_length, dim_width, dim_height, lot_number, stock_total, stock_available, stock_reserved, warehouse_id, vendor)\nVALUES ('var_2002_blue_m', 'prod_2002', 'TSH-MEN-2002-BLUE-M', 24.99, 12.50, 12.00, 0.25, 40, 30, 2, 'L2025B', 200, 180, 20, 'wh_02', 'Proveedor Ropa S.A.');\n\n-- Imagen de variante\nINSERT INTO variant_images (id, variant_id, url, alt, position)\nVALUES ('img_2002A1', 'var_2002_blue_m', 'https://cdn.example.com/products/tsh-men-2002-blue-m.jpg', 'Azul M', 1);\n\n-- Price Tier\nINSERT INTO price_tiers (id, organization_id, name, description)\nVALUES ('tier_A', 'org_123', 'Mayorista A', 'Precios preferenciales para compras por volumen');\n\n-- Price Tier Rules\nINSERT INTO price_tier_rules (id, price_tier_id, variant_id, min_qty, price)\nVALUES\n    ('rule_001', 'tier_A', 'var_2002_blue_m', 1, 24.99),\n    ('rule_002', 'tier_A', 'var_2002_blue_m', 10, 22.99),\n    ('rule_003', 'tier_A', 'var_2002_blue_m', 50, 20.99);\n"})}),"\n",(0,t.jsx)(e.h2,{id:"queries-comunes",children:"Queries Comunes"}),"\n",(0,t.jsx)(e.h3,{id:"obtener-producto-completo",children:"Obtener Producto Completo"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-sql",children:"SELECT\n    p.id,\n    p.title,\n    p.sku,\n    p.barcode,\n    p.description,\n    p.status,\n    p.product_type,\n    p.unit_of_measure,\n    p.alert_stock,\n    jsonb_build_object(\n        'id', b.id,\n        'name', b.name,\n        'slug', b.slug\n    ) AS brand,\n    (\n        SELECT jsonb_agg(\n            jsonb_build_object(\n                'id', pi.id,\n                'url', pi.url,\n                'alt', pi.alt,\n                'position', pi.position\n            ) ORDER BY pi.position\n        )\n        FROM product_images pi\n        WHERE pi.product_id = p.id\n    ) AS images,\n    (\n        SELECT jsonb_agg(\n            jsonb_build_object(\n                'id', t.id,\n                'name', t.name\n            )\n        )\n        FROM product_tags pt\n        JOIN tags t ON pt.tag_id = t.id\n        WHERE pt.product_id = p.id\n    ) AS tags,\n    (\n        SELECT jsonb_agg(\n            jsonb_build_object(\n                'id', c.id,\n                'name', c.name,\n                'slug', c.slug\n            )\n        )\n        FROM product_collections pc\n        JOIN collections c ON pc.collection_id = c.id\n        WHERE pc.product_id = p.id\n    ) AS collections,\n    (\n        SELECT jsonb_agg(\n            jsonb_build_object(\n                'id', v.id,\n                'sku', v.sku,\n                'sale_price', v.sale_price,\n                'cost_price', v.cost_price,\n                'tax', v.tax,\n                'weight', v.weight,\n                'dimensions', jsonb_build_object(\n                    'length', v.dim_length,\n                    'width', v.dim_width,\n                    'height', v.dim_height\n                ),\n                'stock', jsonb_build_object(\n                    'total', v.stock_total,\n                    'available', v.stock_available,\n                    'reserved', v.stock_reserved\n                ),\n                'warehouse_id', v.warehouse_id\n            )\n        )\n        FROM product_variants v\n        WHERE v.product_id = p.id\n    ) AS variants\nFROM products p\nLEFT JOIN brands b ON p.brand_id = b.id\nWHERE p.id = $1 AND p.organization_id = $2;\n"})}),"\n",(0,t.jsx)(e.h3,{id:"buscar-productos-con-filtros",children:"Buscar Productos con Filtros"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-sql",children:"SELECT\n    p.id,\n    p.title,\n    p.sku,\n    p.status,\n    b.name AS brand_name\nFROM products p\nLEFT JOIN brands b ON p.brand_id = b.id\nLEFT JOIN product_collections pc ON p.id = pc.product_id\nLEFT JOIN product_tags pt ON p.id = pt.product_id\nWHERE p.organization_id = $1\n    AND ($2::VARCHAR IS NULL OR p.status = $2)  -- filtro por status\n    AND ($3::VARCHAR IS NULL OR b.id = $3)      -- filtro por brand\n    AND ($4::VARCHAR IS NULL OR pc.collection_id = $4)  -- filtro por collection\n    AND ($5::VARCHAR IS NULL OR pt.tag_id = $5)  -- filtro por tag\nGROUP BY p.id, p.title, p.sku, p.status, b.name\nORDER BY p.updated_date DESC;\n"})}),"\n",(0,t.jsx)(e.h3,{id:"obtener-variantes-con-price-tiers",children:"Obtener Variantes con Price Tiers"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-sql",children:"SELECT\n    v.*,\n    (\n        SELECT jsonb_agg(\n            jsonb_build_object(\n                'tier_id', pt.id,\n                'tier_name', pt.name,\n                'min_qty', ptr.min_qty,\n                'price', ptr.price\n            ) ORDER BY ptr.min_qty\n        )\n        FROM price_tier_rules ptr\n        JOIN price_tiers pt ON ptr.price_tier_id = pt.id\n        WHERE ptr.variant_id = v.id\n    ) AS price_tiers\nFROM product_variants v\nWHERE v.product_id = $1;\n"})}),"\n",(0,t.jsx)(e.h2,{id:"sqlalchemy-models",children:"SQLAlchemy Models"}),"\n",(0,t.jsx)(e.h3,{id:"product-model",children:"Product Model"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-python",children:'from sqlalchemy import Column, String, Text, Integer, DateTime, ForeignKey\nfrom sqlalchemy.orm import relationship\nfrom datetime import datetime\n\nclass Product(Base):\n    __tablename__ = "products"\n\n    id = Column(String(50), primary_key=True)\n    organization_id = Column(String(50), nullable=False)\n    local_id = Column(String(50))\n    title = Column(String(255), nullable=False)\n    sku = Column(String(100), nullable=False)\n    barcode = Column(String(100))\n    description = Column(Text)\n    status = Column(String(20), default="activa")\n    product_type = Column(String(100))\n    unit_of_measure = Column(String(50), default="unidad")\n    alert_stock = Column(Integer, default=0)\n    brand_id = Column(String(50), ForeignKey("brands.id"))\n    created_date = Column(DateTime, default=datetime.utcnow)\n    updated_date = Column(DateTime, default=datetime.utcnow, onupdate=datetime.utcnow)\n\n    # Relationships\n    brand = relationship("Brand", back_populates="products")\n    images = relationship("ProductImage", back_populates="product", cascade="all, delete-orphan")\n    variants = relationship("ProductVariant", back_populates="product", cascade="all, delete-orphan")\n    tags = relationship("Tag", secondary="product_tags", back_populates="products")\n    collections = relationship("Collection", secondary="product_collections", back_populates="products")\n'})}),"\n",(0,t.jsx)(e.h3,{id:"brand-model",children:"Brand Model"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-python",children:'class Brand(Base):\n    __tablename__ = "brands"\n\n    id = Column(String(50), primary_key=True)\n    organization_id = Column(String(50), nullable=False)\n    name = Column(String(255), nullable=False)\n    slug = Column(String(255), nullable=False)\n    description = Column(Text)\n    status = Column(String(20), default="active")\n    created_date = Column(DateTime, default=datetime.utcnow)\n    updated_date = Column(DateTime, default=datetime.utcnow, onupdate=datetime.utcnow)\n\n    # Relationships\n    products = relationship("Product", back_populates="brand")\n'})}),"\n",(0,t.jsx)(e.h3,{id:"productvariant-model",children:"ProductVariant Model"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-python",children:'from sqlalchemy import Numeric, Boolean\n\nclass ProductVariant(Base):\n    __tablename__ = "product_variants"\n\n    id = Column(String(50), primary_key=True)\n    product_id = Column(String(50), ForeignKey("products.id"), nullable=False)\n    sku = Column(String(100), unique=True, nullable=False)\n    barcode = Column(String(100), unique=True)\n    sale_price = Column(Numeric(10, 2), nullable=False)\n    cost_price = Column(Numeric(10, 2))\n    tax = Column(Numeric(5, 2), default=0)\n    weight = Column(Numeric(10, 2))\n    dim_length = Column(Numeric(10, 2))\n    dim_width = Column(Numeric(10, 2))\n    dim_height = Column(Numeric(10, 2))\n    lot_number = Column(String(100))\n    stock_total = Column(Integer, default=0)\n    stock_available = Column(Integer, default=0)\n    stock_reserved = Column(Integer, default=0)\n    warehouse_id = Column(String(50), nullable=False)\n    vendor = Column(String(255))\n    track_inventory = Column(Boolean, default=True)\n    default_min_stock = Column(Integer, default=20)\n    default_max_stock = Column(Integer, default=1000)\n    created_date = Column(DateTime, default=datetime.utcnow)\n    updated_date = Column(DateTime, default=datetime.utcnow, onupdate=datetime.utcnow)\n\n    # Relationships\n    product = relationship("Product", back_populates="variants")\n    images = relationship("VariantImage", back_populates="variant", cascade="all, delete-orphan")\n    price_tier_rules = relationship("PriceTierRule", back_populates="variant")\n'})}),"\n",(0,t.jsx)(e.h3,{id:"collection-model",children:"Collection Model"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-python",children:'class Collection(Base):\n    __tablename__ = "collections"\n\n    id = Column(String(50), primary_key=True)\n    organization_id = Column(String(50), nullable=False)\n    name = Column(String(255), nullable=False)\n    slug = Column(String(255), nullable=False)\n    description = Column(Text)\n    status = Column(String(20), default="activa")\n    image = Column(String(500))\n    parent_id = Column(String(50), ForeignKey("collections.id"))\n    created_date = Column(DateTime, default=datetime.utcnow)\n    updated_date = Column(DateTime, default=datetime.utcnow, onupdate=datetime.utcnow)\n\n    # Relationships\n    parent = relationship("Collection", remote_side=[id], backref="children")\n    products = relationship("Product", secondary="product_collections", back_populates="collections")\n'})}),"\n",(0,t.jsx)(e.h3,{id:"pricetier-model",children:"PriceTier Model"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-python",children:'class PriceTier(Base):\n    __tablename__ = "price_tiers"\n\n    id = Column(String(50), primary_key=True)\n    organization_id = Column(String(50), nullable=False)\n    name = Column(String(255), nullable=False)\n    description = Column(Text)\n    created_date = Column(DateTime, default=datetime.utcnow)\n    updated_date = Column(DateTime, default=datetime.utcnow, onupdate=datetime.utcnow)\n\n    # Relationships\n    rules = relationship("PriceTierRule", back_populates="price_tier", cascade="all, delete-orphan")\n'})}),"\n",(0,t.jsx)(e.h2,{id:"pr\xf3ximos-pasos",children:"Pr\xf3ximos Pasos"}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsx)(e.li,{children:(0,t.jsx)(e.a,{href:"eventos-publicados",children:"Eventos Publicados"})}),"\n",(0,t.jsx)(e.li,{children:(0,t.jsx)(e.a,{href:"api-products",children:"API Products"})}),"\n",(0,t.jsx)(e.li,{children:(0,t.jsx)(e.a,{href:"api-brands",children:"API Brands"})}),"\n",(0,t.jsx)(e.li,{children:(0,t.jsx)(e.a,{href:"api-collections",children:"API Collections"})}),"\n"]})]})}function _(n={}){const{wrapper:e}={...(0,r.R)(),...n.components};return e?(0,t.jsx)(e,{...n,children:(0,t.jsx)(l,{...n})}):l(n)}},8453:(n,e,a)=>{a.d(e,{R:()=>o,x:()=>d});var i=a(6540);const t={},r=i.createContext(t);function o(n){const e=i.useContext(r);return i.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function d(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(t):n.components||t:o(n.components),i.createElement(r.Provider,{value:e},n.children)}}}]);