"use strict";(globalThis.webpackChunkerp_docs=globalThis.webpackChunkerp_docs||[]).push([[745],{8189:(n,e,i)=>{i.r(e),i.d(e,{assets:()=>l,contentTitle:()=>a,default:()=>_,frontMatter:()=>t,metadata:()=>r,toc:()=>c});const r=JSON.parse('{"id":"microservicios/inventory-service/configuracion","title":"Configuraci\xf3n - Inventory Service","description":"Configuraci\xf3n completa de variables de entorno, puertos, y dependencias del Inventory Service.","source":"@site/docs/02-microservicios/inventory-service/04-configuracion.md","sourceDirName":"02-microservicios/inventory-service","slug":"/microservicios/inventory-service/configuracion","permalink":"/zenlogic/microservicios/inventory-service/configuracion","draft":false,"unlisted":false,"editUrl":"https://github.com/your-repo/edit/main/docs/02-microservicios/inventory-service/04-configuracion.md","tags":[],"version":"current","sidebarPosition":4,"frontMatter":{"sidebar_position":4}}');var s=i(4848),o=i(8453);const t={sidebar_position:4},a="Configuraci\xf3n - Inventory Service",l={},c=[{value:"Variables de Entorno",id:"variables-de-entorno",level:2},{value:"Base de Datos",id:"base-de-datos",level:3},{value:"Puertos",id:"puertos",level:3},{value:"Redis Cache",id:"redis-cache",level:3},{value:"RabbitMQ",id:"rabbitmq",level:3},{value:"gRPC Clients",id:"grpc-clients",level:3},{value:"L\xf3gica de Negocio",id:"l\xf3gica-de-negocio",level:3},{value:"Logging",id:"logging",level:3},{value:"Seguridad",id:"seguridad",level:3},{value:"Docker Compose - Inventory Service",id:"docker-compose---inventory-service",level:2},{value:"Archivo .env de Ejemplo",id:"archivo-env-de-ejemplo",level:2},{value:"Configuraci\xf3n por Ambiente",id:"configuraci\xf3n-por-ambiente",level:2},{value:"Development",id:"development",level:3},{value:"Staging",id:"staging",level:3},{value:"Production",id:"production",level:3},{value:"Validaci\xf3n de Configuraci\xf3n",id:"validaci\xf3n-de-configuraci\xf3n",level:2},{value:"Pr\xf3ximos Pasos",id:"pr\xf3ximos-pasos",level:2}];function d(n){const e={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,o.R)(),...n.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(e.header,{children:(0,s.jsx)(e.h1,{id:"configuraci\xf3n---inventory-service",children:"Configuraci\xf3n - Inventory Service"})}),"\n",(0,s.jsx)(e.p,{children:"Configuraci\xf3n completa de variables de entorno, puertos, y dependencias del Inventory Service."}),"\n",(0,s.jsx)(e.h2,{id:"variables-de-entorno",children:"Variables de Entorno"}),"\n",(0,s.jsx)(e.h3,{id:"base-de-datos",children:"Base de Datos"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-bash",children:"# PostgreSQL Configuration\nDATABASE_URL=postgresql://user:password@localhost:5432/inventory_db\nDATABASE_POOL_SIZE=20\nDATABASE_MAX_OVERFLOW=40\nDATABASE_ECHO=false  # Set to true for SQL debugging\n"})}),"\n",(0,s.jsx)(e.h3,{id:"puertos",children:"Puertos"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-bash",children:"# HTTP REST API\nHTTP_PORT=8003\nHTTP_HOST=0.0.0.0\n\n# gRPC Server\nGRPC_PORT=50053\nGRPC_HOST=0.0.0.0\n\n# Health Check\nHEALTH_CHECK_PATH=/health\nMETRICS_PATH=/metrics\n"})}),"\n",(0,s.jsx)(e.h3,{id:"redis-cache",children:"Redis Cache"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-bash",children:"# Redis Configuration\nREDIS_URL=redis://localhost:6379/3\nREDIS_PASSWORD=\nREDIS_MAX_CONNECTIONS=50\n\n# Cache TTL Settings\nCACHE_TTL_STOCK=300            # Stock cache: 5 minutos\nCACHE_TTL_AVAILABILITY=60      # Availability check: 1 minuto\nCACHE_TTL_WAREHOUSE=3600       # Warehouse info: 1 hora\n"})}),"\n",(0,s.jsx)(e.h3,{id:"rabbitmq",children:"RabbitMQ"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-bash",children:"# RabbitMQ Connection\nRABBITMQ_URL=amqp://guest:guest@localhost:5672/\nRABBITMQ_HEARTBEAT=60\nRABBITMQ_CONNECTION_TIMEOUT=30\n\n# Exchange Configuration\nRABBITMQ_EXCHANGE_INVENTORY=inventory_events\nRABBITMQ_EXCHANGE_TYPE=topic\n\n# Queue Configuration\nRABBITMQ_QUEUE_CATALOG_CONSUMER=inventory_catalog_consumer\nRABBITMQ_QUEUE_ORDER_CONSUMER=inventory_order_consumer\n\n# Consumer Settings\nRABBITMQ_PREFETCH_COUNT=10\nRABBITMQ_AUTO_ACK=false\n"})}),"\n",(0,s.jsx)(e.h3,{id:"grpc-clients",children:"gRPC Clients"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-bash",children:"# Catalog Service gRPC\nCATALOG_GRPC_HOST=localhost\nCATALOG_GRPC_PORT=50052\nCATALOG_GRPC_TIMEOUT=5000  # milliseconds\n\n# Auth Service gRPC\nAUTH_GRPC_HOST=localhost\nAUTH_GRPC_PORT=50050\nAUTH_GRPC_TIMEOUT=3000  # milliseconds\n"})}),"\n",(0,s.jsx)(e.h3,{id:"l\xf3gica-de-negocio",children:"L\xf3gica de Negocio"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-bash",children:"# Stock Management\nDEFAULT_MIN_STOCK=20\nDEFAULT_MAX_STOCK=1000\nDEFAULT_REORDER_POINT=30\nLOW_STOCK_THRESHOLD=25\nCRITICAL_STOCK_THRESHOLD=10\n\n# Reservations\nRESERVATION_TTL_MINUTES=15\nRESERVATION_CLEANUP_INTERVAL_MINUTES=5\nMAX_RESERVATION_RETRY_ATTEMPTS=3\n\n# Movements\nMOVEMENT_BATCH_SIZE=100\nMOVEMENT_RETENTION_DAYS=730  # 2 a\xf1os\n\n# Alerts\nENABLE_LOW_STOCK_ALERTS=true\nENABLE_CRITICAL_STOCK_ALERTS=true\nALERT_NOTIFICATION_DELAY_SECONDS=300  # 5 minutos entre alertas\n"})}),"\n",(0,s.jsx)(e.h3,{id:"logging",children:"Logging"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-bash",children:"# Log Configuration\nLOG_LEVEL=INFO  # DEBUG, INFO, WARNING, ERROR, CRITICAL\nLOG_FORMAT=json\nLOG_FILE_PATH=/var/log/inventory-service/app.log\nLOG_MAX_BYTES=10485760  # 10MB\nLOG_BACKUP_COUNT=5\n"})}),"\n",(0,s.jsx)(e.h3,{id:"seguridad",children:"Seguridad"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-bash",children:"# Multi-tenancy\nENFORCE_ORGANIZATION_ISOLATION=true\n\n# API Rate Limiting\nRATE_LIMIT_ENABLED=true\nRATE_LIMIT_PER_MINUTE=100\nRATE_LIMIT_PER_HOUR=5000\n"})}),"\n",(0,s.jsx)(e.h2,{id:"docker-compose---inventory-service",children:"Docker Compose - Inventory Service"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-yaml",children:'version: \'3.8\'\n\nservices:\n  inventory-service:\n    build:\n      context: ./inventory-service\n      dockerfile: Dockerfile\n    container_name: erp-inventory-service\n    ports:\n      - "8003:8003"   # HTTP REST API\n      - "50053:50053" # gRPC Server\n    environment:\n      # Database\n      DATABASE_URL: postgresql://postgres:postgres@inventory-db:5432/inventory_db\n      DATABASE_POOL_SIZE: 20\n      DATABASE_MAX_OVERFLOW: 40\n\n      # Redis\n      REDIS_URL: redis://redis:6379/3\n      REDIS_MAX_CONNECTIONS: 50\n\n      # RabbitMQ\n      RABBITMQ_URL: amqp://guest:guest@rabbitmq:5672/\n      RABBITMQ_EXCHANGE_INVENTORY: inventory_events\n      RABBITMQ_PREFETCH_COUNT: 10\n\n      # gRPC Clients\n      CATALOG_GRPC_HOST: catalog-service\n      CATALOG_GRPC_PORT: 50052\n      AUTH_GRPC_HOST: auth-service\n      AUTH_GRPC_PORT: 50050\n\n      # Business Logic\n      RESERVATION_TTL_MINUTES: 15\n      DEFAULT_MIN_STOCK: 20\n      DEFAULT_REORDER_POINT: 30\n\n      # Logging\n      LOG_LEVEL: INFO\n      LOG_FORMAT: json\n    depends_on:\n      - inventory-db\n      - redis\n      - rabbitmq\n      - catalog-service\n      - auth-service\n    networks:\n      - erp-network\n    restart: unless-stopped\n    healthcheck:\n      test: ["CMD", "curl", "-f", "http://localhost:8003/health"]\n      interval: 30s\n      timeout: 10s\n      retries: 3\n\n  inventory-db:\n    image: postgres:15-alpine\n    container_name: erp-inventory-db\n    environment:\n      POSTGRES_DB: inventory_db\n      POSTGRES_USER: postgres\n      POSTGRES_PASSWORD: postgres\n    ports:\n      - "5435:5432"  # Puerto externo diferente para no conflictuar\n    volumes:\n      - inventory-db-data:/var/lib/postgresql/data\n      - ./inventory-service/init.sql:/docker-entrypoint-initdb.d/init.sql\n    networks:\n      - erp-network\n    restart: unless-stopped\n\nvolumes:\n  inventory-db-data:\n    driver: local\n\nnetworks:\n  erp-network:\n    external: true\n'})}),"\n",(0,s.jsx)(e.h2,{id:"archivo-env-de-ejemplo",children:"Archivo .env de Ejemplo"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-bash",children:"# .env.inventory-service\n\n# Database\nDATABASE_URL=postgresql://postgres:postgres@localhost:5432/inventory_db\nDATABASE_POOL_SIZE=20\n\n# Ports\nHTTP_PORT=8003\nGRPC_PORT=50053\n\n# Redis\nREDIS_URL=redis://localhost:6379/3\n\n# RabbitMQ\nRABBITMQ_URL=amqp://guest:guest@localhost:5672/\nRABBITMQ_EXCHANGE_INVENTORY=inventory_events\nRABBITMQ_PREFETCH_COUNT=10\n\n# gRPC Clients\nCATALOG_GRPC_HOST=localhost\nCATALOG_GRPC_PORT=50052\nAUTH_GRPC_HOST=localhost\nAUTH_GRPC_PORT=50050\n\n# Business Rules\nRESERVATION_TTL_MINUTES=15\nDEFAULT_MIN_STOCK=20\nDEFAULT_REORDER_POINT=30\nLOW_STOCK_THRESHOLD=25\n\n# Logging\nLOG_LEVEL=INFO\nLOG_FORMAT=json\n"})}),"\n",(0,s.jsx)(e.h2,{id:"configuraci\xf3n-por-ambiente",children:"Configuraci\xf3n por Ambiente"}),"\n",(0,s.jsx)(e.h3,{id:"development",children:"Development"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-bash",children:"DATABASE_URL=postgresql://dev:dev@localhost:5432/inventory_db_dev\nLOG_LEVEL=DEBUG\nDATABASE_ECHO=true\nRATE_LIMIT_ENABLED=false\n"})}),"\n",(0,s.jsx)(e.h3,{id:"staging",children:"Staging"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-bash",children:"DATABASE_URL=postgresql://staging_user:staging_pass@staging-db:5432/inventory_db_staging\nLOG_LEVEL=INFO\nRATE_LIMIT_ENABLED=true\nENABLE_LOW_STOCK_ALERTS=true\n"})}),"\n",(0,s.jsx)(e.h3,{id:"production",children:"Production"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-bash",children:"DATABASE_URL=postgresql://prod_user:secure_password@prod-db:5432/inventory_db\nLOG_LEVEL=WARNING\nDATABASE_ECHO=false\nRATE_LIMIT_ENABLED=true\nENABLE_LOW_STOCK_ALERTS=true\nENABLE_CRITICAL_STOCK_ALERTS=true\n"})}),"\n",(0,s.jsx)(e.h2,{id:"validaci\xf3n-de-configuraci\xf3n",children:"Validaci\xf3n de Configuraci\xf3n"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-python",children:"from pydantic import BaseSettings, Field, validator\n\nclass Settings(BaseSettings):\n    \"\"\"Inventory Service Configuration.\"\"\"\n\n    # Database\n    database_url: str = Field(..., env='DATABASE_URL')\n    database_pool_size: int = Field(20, env='DATABASE_POOL_SIZE')\n\n    # Ports\n    http_port: int = Field(8003, env='HTTP_PORT')\n    grpc_port: int = Field(50053, env='GRPC_PORT')\n\n    # Redis\n    redis_url: str = Field(..., env='REDIS_URL')\n    cache_ttl_stock: int = Field(300, env='CACHE_TTL_STOCK')\n\n    # RabbitMQ\n    rabbitmq_url: str = Field(..., env='RABBITMQ_URL')\n    rabbitmq_exchange_inventory: str = Field('inventory_events', env='RABBITMQ_EXCHANGE_INVENTORY')\n    rabbitmq_prefetch_count: int = Field(10, env='RABBITMQ_PREFETCH_COUNT')\n\n    # gRPC Clients\n    catalog_grpc_host: str = Field('localhost', env='CATALOG_GRPC_HOST')\n    catalog_grpc_port: int = Field(50052, env='CATALOG_GRPC_PORT')\n    auth_grpc_host: str = Field('localhost', env='AUTH_GRPC_HOST')\n    auth_grpc_port: int = Field(50050, env='AUTH_GRPC_PORT')\n\n    # Business Logic\n    reservation_ttl_minutes: int = Field(15, env='RESERVATION_TTL_MINUTES')\n    default_min_stock: int = Field(20, env='DEFAULT_MIN_STOCK')\n    default_reorder_point: int = Field(30, env='DEFAULT_REORDER_POINT')\n\n    # Logging\n    log_level: str = Field('INFO', env='LOG_LEVEL')\n    log_format: str = Field('json', env='LOG_FORMAT')\n\n    @validator('http_port')\n    def validate_http_port(cls, v):\n        if v != 8003:\n            raise ValueError('HTTP port must be 8003 for Inventory Service')\n        return v\n\n    @validator('grpc_port')\n    def validate_grpc_port(cls, v):\n        if v != 50053:\n            raise ValueError('gRPC port must be 50053 for Inventory Service')\n        return v\n\n    @validator('reservation_ttl_minutes')\n    def validate_reservation_ttl(cls, v):\n        if v < 5 or v > 60:\n            raise ValueError('Reservation TTL must be between 5 and 60 minutes')\n        return v\n\n    class Config:\n        env_file = '.env'\n        case_sensitive = False\n\n# Usage\nsettings = Settings()\n"})}),"\n",(0,s.jsx)(e.h2,{id:"pr\xf3ximos-pasos",children:"Pr\xf3ximos Pasos"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:(0,s.jsx)(e.a,{href:"./modelo-datos",children:"Modelo de Datos"})}),"\n",(0,s.jsx)(e.li,{children:(0,s.jsx)(e.a,{href:"./eventos-publicados",children:"Eventos Publicados"})}),"\n",(0,s.jsx)(e.li,{children:(0,s.jsx)(e.a,{href:"./eventos-consumidos",children:"Eventos Consumidos"})}),"\n",(0,s.jsx)(e.li,{children:(0,s.jsx)(e.a,{href:"./grpc-server",children:"gRPC Server"})}),"\n"]})]})}function _(n={}){const{wrapper:e}={...(0,o.R)(),...n.components};return e?(0,s.jsx)(e,{...n,children:(0,s.jsx)(d,{...n})}):d(n)}},8453:(n,e,i)=>{i.d(e,{R:()=>t,x:()=>a});var r=i(6540);const s={},o=r.createContext(s);function t(n){const e=r.useContext(o);return r.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function a(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(s):n.components||s:t(n.components),r.createElement(o.Provider,{value:e},n.children)}}}]);