"use strict";(globalThis.webpackChunkerp_docs=globalThis.webpackChunkerp_docs||[]).push([[5492],{8453:(e,n,r)=>{r.d(n,{R:()=>t,x:()=>c});var i=r(6540);const s={},a=i.createContext(s);function t(e){const n=i.useContext(a);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:t(e.components),i.createElement(a.Provider,{value:n},e.children)}},8483:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>l,contentTitle:()=>c,default:()=>h,frontMatter:()=>t,metadata:()=>i,toc:()=>o});const i=JSON.parse('{"id":"arquitectura/comunicacion-microservicios","title":"Comunicaci\xf3n entre Microservicios","description":"Introducci\xf3n","source":"@site/docs/01-arquitectura/03-comunicacion-microservicios.md","sourceDirName":"01-arquitectura","slug":"/arquitectura/comunicacion-microservicios","permalink":"/zenlogic/arquitectura/comunicacion-microservicios","draft":false,"unlisted":false,"editUrl":"https://github.com/your-repo/edit/main/docs/01-arquitectura/03-comunicacion-microservicios.md","tags":[],"version":"current","sidebarPosition":4,"frontMatter":{"sidebar_position":4},"sidebar":"docs","previous":{"title":"Arquitectura Event-Driven","permalink":"/zenlogic/arquitectura/arquitectura-event-driven"},"next":{"title":"Multi-tenancy","permalink":"/zenlogic/arquitectura/multi-tenancy"}}');var s=r(4848),a=r(8453);const t={sidebar_position:4},c="Comunicaci\xf3n entre Microservicios",l={},o=[{value:"Introducci\xf3n",id:"introducci\xf3n",level:2},{value:"Diagrama General",id:"diagrama-general",level:2},{value:"REST APIs",id:"rest-apis",level:2},{value:"Uso",id:"uso",level:3},{value:"Caracter\xedsticas",id:"caracter\xedsticas",level:3},{value:"Ejemplo REST",id:"ejemplo-rest",level:3},{value:"gRPC",id:"grpc",level:2},{value:"Uso",id:"uso-1",level:3},{value:"Proto File Ejemplo",id:"proto-file-ejemplo",level:3},{value:"Flujo gRPC",id:"flujo-grpc",level:3},{value:"Servicios gRPC Expuestos",id:"servicios-grpc-expuestos",level:3},{value:"Comunicaci\xf3n As\xedncrona (Eventos)",id:"comunicaci\xf3n-as\xedncrona-eventos",level:2},{value:"Uso",id:"uso-2",level:3},{value:"Ejemplo",id:"ejemplo",level:3},{value:"Comparaci\xf3n REST vs gRPC",id:"comparaci\xf3n-rest-vs-grpc",level:2},{value:"Circuit Breaker",id:"circuit-breaker",level:2},{value:"Estados del Circuit Breaker",id:"estados-del-circuit-breaker",level:3},{value:"Timeouts y Retry",id:"timeouts-y-retry",level:2},{value:"Timeouts Configurados",id:"timeouts-configurados",level:3},{value:"Estrategia de Retry",id:"estrategia-de-retry",level:3},{value:"Fallback Strategies",id:"fallback-strategies",level:2},{value:"gRPC a REST",id:"grpc-a-rest",level:3},{value:"Trazabilidad (Correlation ID)",id:"trazabilidad-correlation-id",level:2},{value:"Pr\xf3ximos Pasos",id:"pr\xf3ximos-pasos",level:2}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",mermaid:"mermaid",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,a.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"comunicaci\xf3n-entre-microservicios",children:"Comunicaci\xf3n entre Microservicios"})}),"\n",(0,s.jsx)(n.h2,{id:"introducci\xf3n",children:"Introducci\xf3n"}),"\n",(0,s.jsxs)(n.p,{children:["El sistema utiliza ",(0,s.jsx)(n.strong,{children:"comunicaci\xf3n h\xedbrida"})," combinando:"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"REST"})," para APIs p\xfablicas (frontend \u2194 backend)"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"gRPC"})," para comunicaci\xf3n interna (backend \u2194 backend)"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Eventos"})," para comunicaci\xf3n as\xedncrona"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"diagrama-general",children:"Diagrama General"}),"\n",(0,s.jsx)(n.mermaid,{value:'graph TB\n    subgraph "Frontend"\n        Web[Web App]\n        Mobile[Mobile App]\n    end\n\n    subgraph "API Gateway"\n        Gateway[Gateway]\n    end\n\n    subgraph "Microservicios"\n        Auth[Auth Service<br/>REST + gRPC]\n        Catalog[Catalog Service<br/>REST]\n        Inventory[Inventory Service<br/>REST]\n    end\n\n    subgraph "Message Broker"\n        MQ[RabbitMQ]\n    end\n\n    Web --\x3e|REST| Gateway\n    Mobile --\x3e|REST| Gateway\n\n    Gateway --\x3e|REST| Auth\n    Gateway --\x3e|REST| Catalog\n\n    Catalog --\x3e|gRPC| Auth\n    Inventory --\x3e|gRPC| Auth\n\n    Auth --\x3e|eventos| MQ\n    Catalog --\x3e|eventos| MQ\n\n    MQ --\x3e|consume| Catalog\n    MQ --\x3e|consume| Inventory'}),"\n",(0,s.jsx)(n.h2,{id:"rest-apis",children:"REST APIs"}),"\n",(0,s.jsx)(n.h3,{id:"uso",children:"Uso"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Para"}),": Comunicaci\xf3n externa (frontend \u2194 microservicios)"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Ventajas"}),":"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\u2705 Est\xe1ndar universal"}),"\n",(0,s.jsx)(n.li,{children:"\u2705 F\xe1cil de consumir desde navegadores"}),"\n",(0,s.jsx)(n.li,{children:"\u2705 Documentaci\xf3n con OpenAPI/Swagger"}),"\n",(0,s.jsx)(n.li,{children:"\u2705 Debugging simple (HTTP readable)"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"caracter\xedsticas",children:"Caracter\xedsticas"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Protocolo"}),": HTTP/1.1"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Formato"}),": JSON"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Autenticaci\xf3n"}),": JWT en header ",(0,s.jsx)(n.code,{children:"Authorization: Bearer <token>"})]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Versionado"}),": ",(0,s.jsx)(n.code,{children:"/api/v1/..."})]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"ejemplo-rest",children:"Ejemplo REST"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-http",children:'POST /api/v1/products HTTP/1.1\nHost: catalog-service\nAuthorization: Bearer eyJhbGc...\nContent-Type: application/json\n\n{\n  "title": "Producto Nuevo",\n  "sku": "PROD-001"\n}\n'})}),"\n",(0,s.jsx)(n.h2,{id:"grpc",children:"gRPC"}),"\n",(0,s.jsx)(n.h3,{id:"uso-1",children:"Uso"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Para"}),": Comunicaci\xf3n interna (microservicio \u2194 microservicio)"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Ventajas"}),":"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\u2705 Alto rendimiento (binario, HTTP/2)"}),"\n",(0,s.jsx)(n.li,{children:"\u2705 Tipado fuerte (proto files)"}),"\n",(0,s.jsx)(n.li,{children:"\u2705 Streaming bidireccional"}),"\n",(0,s.jsx)(n.li,{children:"\u2705 Menor latencia que REST"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"proto-file-ejemplo",children:"Proto File Ejemplo"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-protobuf",children:'syntax = "proto3";\n\npackage auth;\n\nservice AuthService {\n  rpc VerifyToken (VerifyTokenRequest) returns (VerifyTokenResponse);\n}\n\nmessage VerifyTokenRequest {\n  string access_token = 1;\n}\n\nmessage VerifyTokenResponse {\n  string user_id = 1;\n  string organization_id = 2;\n  repeated string permissions = 3;\n  repeated string locals = 4;\n  bool active = 5;\n}\n'})}),"\n",(0,s.jsx)(n.h3,{id:"flujo-grpc",children:"Flujo gRPC"}),"\n",(0,s.jsx)(n.mermaid,{value:"sequenceDiagram\n    participant Catalog\n    participant Auth\n\n    Catalog->>Auth: VerifyToken(token) [gRPC]\n    Auth->>Auth: Validar y decodificar\n    Auth--\x3e>Catalog: {user_id, permissions, ...}\n    Catalog->>Catalog: Autorizar operaci\xf3n"}),"\n",(0,s.jsx)(n.h3,{id:"servicios-grpc-expuestos",children:"Servicios gRPC Expuestos"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Servicio"}),(0,s.jsx)(n.th,{children:"M\xe9todo gRPC"}),(0,s.jsx)(n.th,{children:"Uso"})]})}),(0,s.jsx)(n.tbody,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Auth Service"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"VerifyToken"})}),(0,s.jsx)(n.td,{children:"Validar tokens desde otros servicios"})]})})]}),"\n",(0,s.jsx)(n.h2,{id:"comunicaci\xf3n-as\xedncrona-eventos",children:"Comunicaci\xf3n As\xedncrona (Eventos)"}),"\n",(0,s.jsx)(n.h3,{id:"uso-2",children:"Uso"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Para"}),": Notificaciones, invalidaci\xf3n de cache, auditor\xeda"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Ventajas"}),":"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\u2705 Desacoplamiento temporal"}),"\n",(0,s.jsx)(n.li,{children:"\u2705 No bloquea el flujo principal"}),"\n",(0,s.jsx)(n.li,{children:"\u2705 Permite m\xfaltiples consumers"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"ejemplo",children:"Ejemplo"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:'# Auth Service (Producer)\nawait event_publisher.publish(\n    event_type="auth.user.deactivated",\n    payload={"user_id": "user_002"},\n    organization_id="org_123"\n)\n\n# Catalog Service (Consumer)\n@event_consumer.on("auth.user.deactivated")\nasync def handle_user_deactivated(event):\n    await cache.invalidate(f"user:{event[\'user_id\']}")\n'})}),"\n",(0,s.jsx)(n.h2,{id:"comparaci\xf3n-rest-vs-grpc",children:"Comparaci\xf3n REST vs gRPC"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Aspecto"}),(0,s.jsx)(n.th,{children:"REST"}),(0,s.jsx)(n.th,{children:"gRPC"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"Protocolo"})}),(0,s.jsx)(n.td,{children:"HTTP/1.1"}),(0,s.jsx)(n.td,{children:"HTTP/2"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"Formato"})}),(0,s.jsx)(n.td,{children:"JSON (texto)"}),(0,s.jsx)(n.td,{children:"Protobuf (binario)"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"Performance"})}),(0,s.jsx)(n.td,{children:"Medio"}),(0,s.jsx)(n.td,{children:"Alto"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"Legibilidad"})}),(0,s.jsx)(n.td,{children:"Alta"}),(0,s.jsx)(n.td,{children:"Baja (binario)"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"Tooling"})}),(0,s.jsx)(n.td,{children:"Curl, Postman"}),(0,s.jsx)(n.td,{children:"grpcurl, BloomRPC"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"Uso en proyecto"})}),(0,s.jsx)(n.td,{children:"Frontend \u2192 Backend"}),(0,s.jsx)(n.td,{children:"Backend \u2194 Backend"})]})]})]}),"\n",(0,s.jsx)(n.h2,{id:"circuit-breaker",children:"Circuit Breaker"}),"\n",(0,s.jsx)(n.p,{children:"Para prevenir cascading failures cuando un servicio falla:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"from pybreaker import CircuitBreaker\n\nauth_breaker = CircuitBreaker(\n    fail_max=5,          # Abrir despu\xe9s de 5 fallos\n    timeout_duration=60  # Intentar de nuevo en 60s\n)\n\n@auth_breaker\nasync def verify_token_grpc(token):\n    return await auth_grpc_client.VerifyToken(token)\n"})}),"\n",(0,s.jsx)(n.h3,{id:"estados-del-circuit-breaker",children:"Estados del Circuit Breaker"}),"\n",(0,s.jsx)(n.mermaid,{value:"stateDiagram-v2\n    [*] --\x3e Closed\n    Closed --\x3e Open: 5 errores consecutivos\n    Open --\x3e HalfOpen: Timeout (60s)\n    HalfOpen --\x3e Closed: Request exitoso\n    HalfOpen --\x3e Open: Request falla"}),"\n",(0,s.jsx)(n.h2,{id:"timeouts-y-retry",children:"Timeouts y Retry"}),"\n",(0,s.jsx)(n.h3,{id:"timeouts-configurados",children:"Timeouts Configurados"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Tipo de llamada"}),(0,s.jsx)(n.th,{children:"Timeout"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"gRPC"}),(0,s.jsx)(n.td,{children:"2-3 segundos"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"REST interno"}),(0,s.jsx)(n.td,{children:"3-5 segundos"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"REST externo"}),(0,s.jsx)(n.td,{children:"10 segundos"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Eventos"}),(0,s.jsx)(n.td,{children:"No aplica (as\xedncrono)"})]})]})]}),"\n",(0,s.jsx)(n.h3,{id:"estrategia-de-retry",children:"Estrategia de Retry"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"@retry(\n    stop=stop_after_attempt(3),\n    wait=wait_exponential(multiplier=1, min=1, max=10)\n)\nasync def call_external_service():\n    # Llamada a servicio externo\n    pass\n"})}),"\n",(0,s.jsx)(n.h2,{id:"fallback-strategies",children:"Fallback Strategies"}),"\n",(0,s.jsx)(n.h3,{id:"grpc-a-rest",children:"gRPC a REST"}),"\n",(0,s.jsx)(n.p,{children:"Si gRPC falla, hacer fallback a REST:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"async def verify_token(token):\n    try:\n        # Intentar gRPC primero\n        return await auth_grpc_client.verify(token)\n    except grpc.RpcError:\n        # Fallback a REST\n        return await auth_rest_client.verify(token)\n"})}),"\n",(0,s.jsx)(n.h2,{id:"trazabilidad-correlation-id",children:"Trazabilidad (Correlation ID)"}),"\n",(0,s.jsxs)(n.p,{children:["Cada request lleva un ",(0,s.jsx)(n.code,{children:"correlation_id"})," para rastrear:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"Request ID: req_9912ABCD\n\nAuth Service: req_9912ABCD - Verificando token\nCatalog Service: req_9912ABCD - Creando producto\nRabbitMQ: req_9912ABCD - Publicando evento\nAudit Service: req_9912ABCD - Registrando auditor\xeda\n"})}),"\n",(0,s.jsx)(n.h2,{id:"pr\xf3ximos-pasos",children:"Pr\xf3ximos Pasos"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"/microservicios/auth-service/grpc-server",children:"Auth Service - gRPC Server"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"/microservicios/catalog-service/auth-client-grpc",children:"Catalog Service - gRPC Client"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"/decisiones-arquitectura/adr-004-comunicacion-hibrida",children:"ADR-004: Comunicaci\xf3n H\xedbrida"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"/integraciones/02-grpc-proto-files",children:"Integraciones - gRPC Proto Files"})}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}}}]);