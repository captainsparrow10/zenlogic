"use strict";(globalThis.webpackChunkerp_docs=globalThis.webpackChunkerp_docs||[]).push([[2185],{7405:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>c,contentTitle:()=>t,default:()=>u,frontMatter:()=>o,metadata:()=>r,toc:()=>l});const r=JSON.parse('{"id":"microservicios/auth-service/api-auth","title":"API - Autenticaci\xf3n","description":"Endpoints para login, refresh y logout.","source":"@site/docs/02-microservicios/auth-service/07-api-auth.md","sourceDirName":"02-microservicios/auth-service","slug":"/microservicios/auth-service/api-auth","permalink":"/zenlogic/microservicios/auth-service/api-auth","draft":false,"unlisted":false,"editUrl":"https://github.com/your-repo/edit/main/docs/02-microservicios/auth-service/07-api-auth.md","tags":[],"version":"current","sidebarPosition":8,"frontMatter":{"sidebar_position":8},"sidebar":"docs","previous":{"title":"gRPC Server","permalink":"/zenlogic/microservicios/auth-service/grpc-server"},"next":{"title":"API - Users","permalink":"/zenlogic/microservicios/auth-service/api-users"}}');var i=s(4848),a=s(8453);const o={sidebar_position:8},t="API - Autenticaci\xf3n",c={},l=[{value:"Base URL",id:"base-url",level:2},{value:"POST /auth/login",id:"post-authlogin",level:2},{value:"Request",id:"request",level:3},{value:"Response 200 OK",id:"response-200-ok",level:3},{value:"Response 401 Unauthorized",id:"response-401-unauthorized",level:3},{value:"Response 423 Locked",id:"response-423-locked",level:3},{value:"POST /auth/refresh",id:"post-authrefresh",level:2},{value:"Request",id:"request-1",level:3},{value:"Response 200 OK",id:"response-200-ok-1",level:3},{value:"Response 401 Unauthorized",id:"response-401-unauthorized-1",level:3},{value:"POST /auth/logout",id:"post-authlogout",level:2},{value:"Request",id:"request-2",level:3},{value:"Response 200 OK",id:"response-200-ok-2",level:3},{value:"POST /auth/verify",id:"post-authverify",level:2},{value:"Request",id:"request-3",level:3},{value:"Response 200 OK",id:"response-200-ok-3",level:3},{value:"POST /auth/change-password",id:"post-authchange-password",level:2},{value:"Request",id:"request-4",level:3},{value:"Response 200 OK",id:"response-200-ok-4",level:3},{value:"Response 400 Bad Request",id:"response-400-bad-request",level:3},{value:"Implementaci\xf3n",id:"implementaci\xf3n",level:2},{value:"Pr\xf3ximos Pasos",id:"pr\xf3ximos-pasos",level:2}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,a.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"api---autenticaci\xf3n",children:"API - Autenticaci\xf3n"})}),"\n",(0,i.jsx)(n.p,{children:"Endpoints para login, refresh y logout."}),"\n",(0,i.jsx)(n.h2,{id:"base-url",children:"Base URL"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"POST /auth/*\n"})}),"\n",(0,i.jsx)(n.h2,{id:"post-authlogin",children:"POST /auth/login"}),"\n",(0,i.jsx)(n.p,{children:"Autenticar usuario con credenciales."}),"\n",(0,i.jsx)(n.h3,{id:"request",children:"Request"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-http",children:'POST /auth/login\nContent-Type: application/json\n\n{\n  "email": "admin@empresa.com",\n  "password": "SecurePassword123"\n}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"response-200-ok",children:"Response 200 OK"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n  "access_token": "eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9...",\n  "refresh_token": "eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9...",\n  "token_type": "bearer",\n  "expires_in": 900,\n  "user": {\n    "id": "user_001",\n    "email": "admin@empresa.com",\n    "first_name": "Admin",\n    "last_name": "Sistema",\n    "organization_id": "org_123",\n    "permissions": ["catalog:read", "catalog:create"],\n    "locals": ["local_01", "local_02"]\n  }\n}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"response-401-unauthorized",children:"Response 401 Unauthorized"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n  "detail": {\n    "code": "INVALID_CREDENTIALS",\n    "message": "Email o contrase\xf1a incorrectos"\n  }\n}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"response-423-locked",children:"Response 423 Locked"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n  "detail": {\n    "code": "USER_LOCKED",\n    "message": "Usuario bloqueado por m\xfaltiples intentos fallidos",\n    "locked_until": "2025-11-23T11:45:00Z"\n  }\n}\n'})}),"\n",(0,i.jsx)(n.h2,{id:"post-authrefresh",children:"POST /auth/refresh"}),"\n",(0,i.jsx)(n.p,{children:"Renovar Access Token usando Refresh Token."}),"\n",(0,i.jsx)(n.h3,{id:"request-1",children:"Request"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-http",children:'POST /auth/refresh\nContent-Type: application/json\n\n{\n  "refresh_token": "eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9..."\n}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"response-200-ok-1",children:"Response 200 OK"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n  "access_token": "eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9...",\n  "token_type": "bearer",\n  "expires_in": 900\n}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"response-401-unauthorized-1",children:"Response 401 Unauthorized"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n  "detail": {\n    "code": "INVALID_REFRESH_TOKEN",\n    "message": "Refresh token inv\xe1lido o expirado"\n  }\n}\n'})}),"\n",(0,i.jsx)(n.h2,{id:"post-authlogout",children:"POST /auth/logout"}),"\n",(0,i.jsx)(n.p,{children:"Cerrar sesi\xf3n y revocar tokens."}),"\n",(0,i.jsx)(n.h3,{id:"request-2",children:"Request"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-http",children:'POST /auth/logout\nAuthorization: Bearer eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9...\nContent-Type: application/json\n\n{\n  "refresh_token": "eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9..."\n}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"response-200-ok-2",children:"Response 200 OK"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n  "message": "Sesi\xf3n cerrada exitosamente"\n}\n'})}),"\n",(0,i.jsx)(n.h2,{id:"post-authverify",children:"POST /auth/verify"}),"\n",(0,i.jsx)(n.p,{children:"Verificar token (uso interno entre microservicios)."}),"\n",(0,i.jsx)(n.h3,{id:"request-3",children:"Request"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-http",children:'POST /auth/verify\nContent-Type: application/json\n\n{\n  "token": "eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9..."\n}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"response-200-ok-3",children:"Response 200 OK"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n  "user_id": "user_001",\n  "organization_id": "org_123",\n  "email": "admin@empresa.com",\n  "permissions": ["catalog:read", "catalog:create"],\n  "locals": ["local_01"],\n  "active": true\n}\n'})}),"\n",(0,i.jsx)(n.h2,{id:"post-authchange-password",children:"POST /auth/change-password"}),"\n",(0,i.jsx)(n.p,{children:"Cambiar contrase\xf1a de usuario actual."}),"\n",(0,i.jsx)(n.h3,{id:"request-4",children:"Request"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-http",children:'POST /auth/change-password\nAuthorization: Bearer eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9...\nContent-Type: application/json\n\n{\n  "current_password": "OldPassword123",\n  "new_password": "NewSecurePassword456"\n}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"response-200-ok-4",children:"Response 200 OK"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n  "message": "Contrase\xf1a actualizada exitosamente"\n}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"response-400-bad-request",children:"Response 400 Bad Request"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n  "detail": {\n    "code": "WEAK_PASSWORD",\n    "message": "La contrase\xf1a no cumple los requisitos m\xednimos",\n    "requirements": {\n      "min_length": 8,\n      "require_uppercase": true,\n      "require_number": true\n    }\n  }\n}\n'})}),"\n",(0,i.jsx)(n.h2,{id:"implementaci\xf3n",children:"Implementaci\xf3n"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'from fastapi import APIRouter, Depends, HTTPException\nfrom src.schemas.auth import LoginRequest, TokenResponse\nfrom src.services.auth_service import AuthService\n\nrouter = APIRouter(prefix="/auth", tags=["Authentication"])\n\n@router.post("/login", response_model=TokenResponse)\nasync def login(\n    credentials: LoginRequest,\n    auth_service: AuthService = Depends()\n):\n    try:\n        result = await auth_service.login(\n            credentials.email,\n            credentials.password\n        )\n        return result\n    except InvalidCredentialsError:\n        raise HTTPException(401, "Credenciales inv\xe1lidas")\n    except UserLockedError as e:\n        raise HTTPException(423, str(e))\n\n@router.post("/refresh")\nasync def refresh(\n    refresh_data: RefreshRequest,\n    auth_service: AuthService = Depends()\n):\n    try:\n        new_access_token = await auth_service.refresh_token(\n            refresh_data.refresh_token\n        )\n        return {\n            "access_token": new_access_token,\n            "token_type": "bearer",\n            "expires_in": 900\n        }\n    except InvalidTokenError:\n        raise HTTPException(401, "Refresh token inv\xe1lido")\n\n@router.post("/logout")\nasync def logout(\n    logout_data: LogoutRequest,\n    user = Depends(get_current_user),\n    auth_service: AuthService = Depends()\n):\n    await auth_service.logout(\n        user.id,\n        logout_data.refresh_token\n    )\n    return {"message": "Sesi\xf3n cerrada"}\n'})}),"\n",(0,i.jsx)(n.h2,{id:"pr\xf3ximos-pasos",children:"Pr\xf3ximos Pasos"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"/microservicios/auth-service/api-users",children:"API Users"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"/microservicios/auth-service/api-roles",children:"API Roles"})}),"\n"]})]})}function u(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>o,x:()=>t});var r=s(6540);const i={},a=r.createContext(i);function o(e){const n=r.useContext(a);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function t(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:o(e.components),r.createElement(a.Provider,{value:n},e.children)}}}]);