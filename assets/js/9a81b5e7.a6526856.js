"use strict";(globalThis.webpackChunkerp_docs=globalThis.webpackChunkerp_docs||[]).push([[1095],{7297:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>a,contentTitle:()=>c,default:()=>h,frontMatter:()=>l,metadata:()=>r,toc:()=>t});const r=JSON.parse('{"id":"microservicios/order-service/overview","title":"Order Service - Overview","description":"Servicio de gesti\xf3n de \xf3rdenes de venta con soporte completo para carrito, checkout, pagos, fulfillment, env\xedos y devoluciones.","source":"@site/docs/02-microservicios/order-service/01-overview.md","sourceDirName":"02-microservicios/order-service","slug":"/microservicios/order-service/overview","permalink":"/zenlogic/microservicios/order-service/overview","draft":false,"unlisted":false,"editUrl":"https://github.com/your-repo/edit/main/docs/02-microservicios/order-service/01-overview.md","tags":[],"version":"current","sidebarPosition":1,"frontMatter":{"sidebar_position":1},"sidebar":"docs","previous":{"title":"Flujos de Negocio","permalink":"/zenlogic/microservicios/inventory-service/flujos-negocio"},"next":{"title":"Modelo de Datos","permalink":"/zenlogic/microservicios/order-service/modelo-datos"}}');var s=i(4848),d=i(8453);const l={sidebar_position:1},c="Order Service - Overview",a={},t=[{value:"Descripci\xf3n",id:"descripci\xf3n",level:2},{value:"Responsabilidades Principales",id:"responsabilidades-principales",level:3},{value:"Caracter\xedsticas Principales",id:"caracter\xedsticas-principales",level:2},{value:"M\xe1quina de Estados de Orden",id:"m\xe1quina-de-estados-de-orden",level:3},{value:"Estados de Orden",id:"estados-de-orden",level:3},{value:"Tipos de Orden",id:"tipos-de-orden",level:3},{value:"Arquitectura T\xe9cnica",id:"arquitectura-t\xe9cnica",level:2},{value:"Stack Tecnol\xf3gico",id:"stack-tecnol\xf3gico",level:3},{value:"Puertos",id:"puertos",level:3},{value:"Variables de Entorno",id:"variables-de-entorno",level:3},{value:"Integraciones",id:"integraciones",level:2},{value:"Con Inventory Service",id:"con-inventory-service",level:3},{value:"Con Catalog Service",id:"con-catalog-service",level:3},{value:"Con Payment Gateway",id:"con-payment-gateway",level:3},{value:"Modelo de Datos Resumen",id:"modelo-de-datos-resumen",level:2},{value:"Entidades Principales",id:"entidades-principales",level:3},{value:"Relaciones Clave",id:"relaciones-clave",level:3},{value:"Eventos Publicados",id:"eventos-publicados",level:2},{value:"Order Events",id:"order-events",level:3},{value:"Payment Events",id:"payment-events",level:3},{value:"Shipment Events",id:"shipment-events",level:3},{value:"Return Events",id:"return-events",level:3},{value:"Cart Events",id:"cart-events",level:3},{value:"Eventos Consumidos",id:"eventos-consumidos",level:2},{value:"Casos de Uso Principales",id:"casos-de-uso-principales",level:2},{value:"1. Crear Orden desde Carrito",id:"1-crear-orden-desde-carrito",level:3},{value:"2. Procesar Pago",id:"2-procesar-pago",level:3},{value:"3. Consultar Estado de Orden",id:"3-consultar-estado-de-orden",level:3},{value:"4. Solicitar Devoluci\xf3n",id:"4-solicitar-devoluci\xf3n",level:3},{value:"Seguridad y Permisos",id:"seguridad-y-permisos",level:2},{value:"Roles y Permisos",id:"roles-y-permisos",level:3},{value:"Validaciones de Seguridad",id:"validaciones-de-seguridad",level:3},{value:"M\xe9tricas y Monitoring",id:"m\xe9tricas-y-monitoring",level:2},{value:"KPIs Principales",id:"kpis-principales",level:3},{value:"Health Checks",id:"health-checks",level:3},{value:"Pr\xf3ximos Pasos",id:"pr\xf3ximos-pasos",level:2}];function o(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",mermaid:"mermaid",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,d.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"order-service---overview",children:"Order Service - Overview"})}),"\n",(0,s.jsx)(n.p,{children:"Servicio de gesti\xf3n de \xf3rdenes de venta con soporte completo para carrito, checkout, pagos, fulfillment, env\xedos y devoluciones."}),"\n",(0,s.jsx)(n.h2,{id:"descripci\xf3n",children:"Descripci\xf3n"}),"\n",(0,s.jsxs)(n.p,{children:["El ",(0,s.jsx)(n.strong,{children:"Order Service"})," es el microservicio central para gestionar todo el ciclo de vida de las \xf3rdenes de venta en el sistema ERP. Maneja desde la creaci\xf3n del carrito de compras hasta la entrega final, incluyendo procesamiento de pagos, fulfillment, env\xedos, facturaci\xf3n y devoluciones."]}),"\n",(0,s.jsx)(n.h3,{id:"responsabilidades-principales",children:"Responsabilidades Principales"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Gesti\xf3n de Carrito"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Agregar/remover productos del carrito"}),"\n",(0,s.jsx)(n.li,{children:"Aplicar descuentos y cupones"}),"\n",(0,s.jsx)(n.li,{children:"Calcular totales con impuestos"}),"\n",(0,s.jsx)(n.li,{children:"Persistencia de carrito (guest y usuarios autenticados)"}),"\n",(0,s.jsx)(n.li,{children:"Carrito abandonado con recuperaci\xf3n"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Procesamiento de \xd3rdenes"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Creaci\xf3n de \xf3rdenes desde carrito"}),"\n",(0,s.jsx)(n.li,{children:"Validaci\xf3n de disponibilidad de stock (v\xeda Inventory Service)"}),"\n",(0,s.jsx)(n.li,{children:"Reserva temporal de productos"}),"\n",(0,s.jsx)(n.li,{children:"C\xe1lculo de costos de env\xedo"}),"\n",(0,s.jsx)(n.li,{children:"Aplicaci\xf3n de reglas de negocio (m\xednimos, m\xe1ximos, restricciones)"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Gesti\xf3n de Pagos"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Integraci\xf3n con m\xfaltiples payment gateways (Stripe, PayPal, MercadoPago)"}),"\n",(0,s.jsx)(n.li,{children:"Procesamiento de pagos online"}),"\n",(0,s.jsx)(n.li,{children:"Pagos en tienda (cash, tarjeta local)"}),"\n",(0,s.jsx)(n.li,{children:"Reembolsos y cancelaciones"}),"\n",(0,s.jsx)(n.li,{children:"Detecci\xf3n de fraude b\xe1sica"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Fulfillment y Picking"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Asignaci\xf3n de \xf3rdenes a bodegas"}),"\n",(0,s.jsx)(n.li,{children:"Generaci\xf3n de picking lists"}),"\n",(0,s.jsx)(n.li,{children:"Validaci\xf3n de packing"}),"\n",(0,s.jsx)(n.li,{children:"Confirmaci\xf3n de despacho"}),"\n",(0,s.jsx)(n.li,{children:"Integraci\xf3n con sistemas de warehouse"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Gesti\xf3n de Env\xedos"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Creaci\xf3n de env\xedos y tracking"}),"\n",(0,s.jsx)(n.li,{children:"Integraci\xf3n con carriers (FedEx, UPS, DHL, local)"}),"\n",(0,s.jsx)(n.li,{children:"Notificaciones de estado de env\xedo"}),"\n",(0,s.jsx)(n.li,{children:"Confirmaci\xf3n de entrega"}),"\n",(0,s.jsx)(n.li,{children:"Gesti\xf3n de env\xedos fallidos"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Devoluciones y RMA"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Solicitudes de devoluci\xf3n"}),"\n",(0,s.jsx)(n.li,{children:"Generaci\xf3n de RMA (Return Merchandise Authorization)"}),"\n",(0,s.jsx)(n.li,{children:"Aprobaci\xf3n/rechazo de devoluciones"}),"\n",(0,s.jsx)(n.li,{children:"Reingreso a inventario"}),"\n",(0,s.jsx)(n.li,{children:"Procesamiento de reembolsos"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Facturaci\xf3n"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Generaci\xf3n de facturas electr\xf3nicas"}),"\n",(0,s.jsx)(n.li,{children:"Cumplimiento normativo (SII, SUNAT, SAT, etc.)"}),"\n",(0,s.jsx)(n.li,{children:"Notas de cr\xe9dito y d\xe9bito"}),"\n",(0,s.jsx)(n.li,{children:"Documentos tributarios"}),"\n",(0,s.jsx)(n.li,{children:"Integraci\xf3n con sistemas contables"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"caracter\xedsticas-principales",children:"Caracter\xedsticas Principales"}),"\n",(0,s.jsx)(n.h3,{id:"m\xe1quina-de-estados-de-orden",children:"M\xe1quina de Estados de Orden"}),"\n",(0,s.jsx)(n.mermaid,{value:"stateDiagram-v2\n    [*] --\x3e cart: Agregar productos\n    cart --\x3e pending: Checkout\n    pending --\x3e payment_pending: Crear orden\n    payment_pending --\x3e payment_failed: Pago fallido\n    payment_pending --\x3e confirmed: Pago exitoso\n    payment_failed --\x3e cancelled: Timeout/Cancel\n    confirmed --\x3e processing: Asignar fulfillment\n    processing --\x3e ready_to_ship: Picking completo\n    ready_to_ship --\x3e shipped: Enviar\n    shipped --\x3e delivered: Confirmar entrega\n    delivered --\x3e [*]\n\n    confirmed --\x3e cancelled: Cancelar (antes env\xedo)\n    processing --\x3e cancelled: Cancelar (antes picking)\n    delivered --\x3e return_requested: Solicitar devoluci\xf3n\n    return_requested --\x3e returned: Devuelto\n    returned --\x3e refunded: Reembolsado"}),"\n",(0,s.jsx)(n.h3,{id:"estados-de-orden",children:"Estados de Orden"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Estado"}),(0,s.jsx)(n.th,{children:"Descripci\xf3n"}),(0,s.jsx)(n.th,{children:"Acciones Permitidas"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"cart"})}),(0,s.jsx)(n.td,{children:"Productos en carrito"}),(0,s.jsx)(n.td,{children:"Agregar, remover, checkout"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"pending"})}),(0,s.jsx)(n.td,{children:"Orden creada, esperando pago"}),(0,s.jsx)(n.td,{children:"Pagar, cancelar"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"payment_pending"})}),(0,s.jsx)(n.td,{children:"Procesando pago"}),(0,s.jsx)(n.td,{children:"Esperar resultado"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"payment_failed"})}),(0,s.jsx)(n.td,{children:"Pago rechazado"}),(0,s.jsx)(n.td,{children:"Reintentar, cancelar"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"confirmed"})}),(0,s.jsx)(n.td,{children:"Pago confirmado"}),(0,s.jsx)(n.td,{children:"Asignar fulfillment, cancelar"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"processing"})}),(0,s.jsx)(n.td,{children:"En proceso de picking"}),(0,s.jsx)(n.td,{children:"Cancelar (con aprobaci\xf3n)"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"ready_to_ship"})}),(0,s.jsx)(n.td,{children:"Lista para env\xedo"}),(0,s.jsx)(n.td,{children:"Enviar"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"shipped"})}),(0,s.jsx)(n.td,{children:"Enviada"}),(0,s.jsx)(n.td,{children:"Actualizar tracking"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"delivered"})}),(0,s.jsx)(n.td,{children:"Entregada"}),(0,s.jsx)(n.td,{children:"Solicitar devoluci\xf3n"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"cancelled"})}),(0,s.jsx)(n.td,{children:"Cancelada"}),(0,s.jsx)(n.td,{children:"-"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"return_requested"})}),(0,s.jsx)(n.td,{children:"Devoluci\xf3n solicitada"}),(0,s.jsx)(n.td,{children:"Aprobar/rechazar"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"returned"})}),(0,s.jsx)(n.td,{children:"Productos devueltos"}),(0,s.jsx)(n.td,{children:"Procesar reembolso"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"refunded"})}),(0,s.jsx)(n.td,{children:"Reembolso completado"}),(0,s.jsx)(n.td,{children:"-"})]})]})]}),"\n",(0,s.jsx)(n.h3,{id:"tipos-de-orden",children:"Tipos de Orden"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Online"})," - Compra desde e-commerce"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"POS"})," - Venta en tienda f\xedsica"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Phone"})," - Venta telef\xf3nica"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"B2B"})," - Orden corporativa"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Subscription"})," - Suscripci\xf3n recurrente"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"arquitectura-t\xe9cnica",children:"Arquitectura T\xe9cnica"}),"\n",(0,s.jsx)(n.h3,{id:"stack-tecnol\xf3gico",children:"Stack Tecnol\xf3gico"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Componente"}),(0,s.jsx)(n.th,{children:"Tecnolog\xeda"}),(0,s.jsx)(n.th,{children:"Versi\xf3n"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"Runtime"})}),(0,s.jsx)(n.td,{children:"Python"}),(0,s.jsx)(n.td,{children:"3.11+"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"Framework"})}),(0,s.jsx)(n.td,{children:"FastAPI"}),(0,s.jsx)(n.td,{children:"0.104+"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"ORM"})}),(0,s.jsx)(n.td,{children:"SQLAlchemy"}),(0,s.jsx)(n.td,{children:"2.0+"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"Validaci\xf3n"})}),(0,s.jsx)(n.td,{children:"Pydantic"}),(0,s.jsx)(n.td,{children:"2.0+"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"Base de Datos"})}),(0,s.jsx)(n.td,{children:"PostgreSQL"}),(0,s.jsx)(n.td,{children:"15+"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"Cache"})}),(0,s.jsx)(n.td,{children:"Redis"}),(0,s.jsx)(n.td,{children:"7.2+"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"Message Broker"})}),(0,s.jsx)(n.td,{children:"RabbitMQ"}),(0,s.jsx)(n.td,{children:"3.12+"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"gRPC"})}),(0,s.jsx)(n.td,{children:"grpcio"}),(0,s.jsx)(n.td,{children:"1.59+"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"Payment Gateway"})}),(0,s.jsx)(n.td,{children:"Stripe SDK"}),(0,s.jsx)(n.td,{children:"7.0+"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"Task Queue"})}),(0,s.jsx)(n.td,{children:"Celery"}),(0,s.jsx)(n.td,{children:"5.3+"})]})]})]}),"\n",(0,s.jsx)(n.h3,{id:"puertos",children:"Puertos"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"HTTP REST API"}),": ",(0,s.jsx)(n.code,{children:"8004"})]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"gRPC"}),": ",(0,s.jsx)(n.code,{children:"50054"})]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Health Check"}),": ",(0,s.jsx)(n.code,{children:"8004/health"})]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Metrics"}),": ",(0,s.jsx)(n.code,{children:"8004/metrics"})]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"variables-de-entorno",children:"Variables de Entorno"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# Database\nDATABASE_URL=postgresql://user:pass@localhost:5432/order_db\nDATABASE_POOL_SIZE=20\nDATABASE_MAX_OVERFLOW=40\n\n# Redis Cache\nREDIS_URL=redis://localhost:6379/3\nCACHE_TTL_CART=3600           # Cart cache: 1 hora\nCACHE_TTL_ORDER=300           # Order cache: 5 minutos\n\n# RabbitMQ\nRABBITMQ_URL=amqp://guest:guest@localhost:5672/\nRABBITMQ_EXCHANGE=order_events\nRABBITMQ_QUEUE_ORDERS=order_updates\nRABBITMQ_QUEUE_PAYMENTS=payment_updates\n\n# gRPC Clients\nINVENTORY_GRPC_HOST=localhost\nINVENTORY_GRPC_PORT=50053\nCATALOG_GRPC_HOST=localhost\nCATALOG_GRPC_PORT=50051\n\n# Payment Gateways\nSTRIPE_API_KEY=sk_test_...\nSTRIPE_WEBHOOK_SECRET=whsec_...\nPAYPAL_CLIENT_ID=...\nPAYPAL_CLIENT_SECRET=...\nMERCADOPAGO_ACCESS_TOKEN=...\n\n# Shipping Carriers\nFEDEX_API_KEY=...\nUPS_API_KEY=...\nDHL_API_KEY=...\n\n# Business Logic\nORDER_RESERVATION_TTL_MINUTES=15\nCART_EXPIRY_DAYS=30\nMAX_ITEMS_PER_ORDER=100\nMIN_ORDER_AMOUNT=10.00\nFREE_SHIPPING_THRESHOLD=50.00\nPAYMENT_RETRY_ATTEMPTS=3\nABANDONED_CART_HOURS=24\n"})}),"\n",(0,s.jsx)(n.h2,{id:"integraciones",children:"Integraciones"}),"\n",(0,s.jsx)(n.h3,{id:"con-inventory-service",children:"Con Inventory Service"}),"\n",(0,s.jsx)(n.mermaid,{value:"sequenceDiagram\n    participant OS as Order Service\n    participant IS as Inventory Service\n    participant RMQ as RabbitMQ\n\n    OS->>IS: gRPC: CheckAvailability\n    IS--\x3e>OS: Available: true\n\n    OS->>IS: gRPC: ReserveStock(ttl=15min)\n    IS--\x3e>OS: Reservation ID\n\n    Note over OS: Customer pays\n\n    OS->>RMQ: Publish order.confirmed\n    RMQ->>IS: Consume event\n    IS->>IS: Confirm reservation\n\n    Note over OS: Order shipped\n\n    OS->>RMQ: Publish order.shipped\n    RMQ->>IS: Consume event\n    IS->>IS: Deduct stock"}),"\n",(0,s.jsx)(n.h3,{id:"con-catalog-service",children:"Con Catalog Service"}),"\n",(0,s.jsx)(n.mermaid,{value:"sequenceDiagram\n    participant OS as Order Service\n    participant CS as Catalog Service\n    participant RMQ as RabbitMQ\n\n    OS->>CS: gRPC: GetProductDetails\n    CS--\x3e>OS: Product info + pricing\n\n    OS->>CS: gRPC: ValidateVariant\n    CS--\x3e>OS: Valid + Active\n\n    CS->>RMQ: Publish product.price_updated\n    RMQ->>OS: Consume event\n    OS->>OS: Invalidate cart cache"}),"\n",(0,s.jsx)(n.h3,{id:"con-payment-gateway",children:"Con Payment Gateway"}),"\n",(0,s.jsx)(n.mermaid,{value:"sequenceDiagram\n    participant C as Customer\n    participant OS as Order Service\n    participant PG as Payment Gateway\n    participant RMQ as RabbitMQ\n\n    C->>OS: POST /orders/{id}/pay\n    OS->>PG: Create payment intent\n    PG--\x3e>OS: client_secret\n\n    OS--\x3e>C: client_secret\n    C->>PG: Complete payment (frontend)\n\n    PG->>OS: Webhook: payment.succeeded\n    OS->>OS: Update order status\n    OS->>RMQ: Publish order.payment_confirmed"}),"\n",(0,s.jsx)(n.h2,{id:"modelo-de-datos-resumen",children:"Modelo de Datos Resumen"}),"\n",(0,s.jsx)(n.h3,{id:"entidades-principales",children:"Entidades Principales"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Order"})," - Orden principal"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"OrderItem"})," - L\xedneas de orden"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Cart"})," - Carrito de compras"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"CartItem"})," - Productos en carrito"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Payment"})," - Transacciones de pago"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Shipment"})," - Env\xedos y tracking"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Return"})," - Devoluciones y RMA"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Invoice"})," - Facturas electr\xf3nicas"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"FulfillmentTask"})," - Tareas de picking/packing"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"relaciones-clave",children:"Relaciones Clave"}),"\n",(0,s.jsx)(n.mermaid,{value:"erDiagram\n    ORDER ||--o{ ORDER_ITEM : contains\n    ORDER ||--o{ PAYMENT : has\n    ORDER ||--o{ SHIPMENT : has\n    ORDER ||--o{ RETURN : has\n    ORDER ||--|| INVOICE : generates\n    ORDER ||--o{ FULFILLMENT_TASK : requires\n    CART ||--o{ CART_ITEM : contains\n    SHIPMENT ||--o{ TRACKING_EVENT : has\n    RETURN ||--o{ RETURN_ITEM : contains"}),"\n",(0,s.jsx)(n.h2,{id:"eventos-publicados",children:"Eventos Publicados"}),"\n",(0,s.jsx)(n.h3,{id:"order-events",children:"Order Events"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"order.created"})," - Orden creada"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"order.confirmed"})," - Pago confirmado"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"order.cancelled"})," - Orden cancelada"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"order.processing"})," - En fulfillment"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"order.shipped"})," - Enviada"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"order.delivered"})," - Entregada"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"order.refunded"})," - Reembolsada"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"payment-events",children:"Payment Events"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"payment.pending"})," - Pago pendiente"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"payment.succeeded"})," - Pago exitoso"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"payment.failed"})," - Pago fallido"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"payment.refunded"})," - Reembolso procesado"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"shipment-events",children:"Shipment Events"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"shipment.created"})," - Env\xedo creado"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"shipment.dispatched"})," - Despachado"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"shipment.in_transit"})," - En tr\xe1nsito"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"shipment.delivered"})," - Entregado"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"shipment.failed"})," - Entrega fallida"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"return-events",children:"Return Events"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"return.requested"})," - Devoluci\xf3n solicitada"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"return.approved"})," - Devoluci\xf3n aprobada"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"return.received"})," - Producto recibido"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"return.refunded"})," - Reembolso completado"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"cart-events",children:"Cart Events"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"cart.abandoned"})," - Carrito abandonado"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"cart.recovered"})," - Carrito recuperado"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"eventos-consumidos",children:"Eventos Consumidos"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"inventory.stock.updated"})," - Actualizar disponibilidad"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"inventory.stock.depleted"})," - Producto agotado"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"catalog.product.updated"})," - Actualizar info producto"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"catalog.variant.updated"})," - Actualizar precios y detalles de variantes"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"payment.webhook.*"})," - Webhooks de payment gateway"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"casos-de-uso-principales",children:"Casos de Uso Principales"}),"\n",(0,s.jsx)(n.h3,{id:"1-crear-orden-desde-carrito",children:"1. Crear Orden desde Carrito"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-http",children:'POST /api/v1/orders/from-cart\n{\n  "cart_id": "cart_123",\n  "shipping_address_id": "addr_456",\n  "billing_address_id": "addr_456",\n  "shipping_method": "standard",\n  "payment_method": "stripe"\n}\n'})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Respuesta:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'{\n  "status": "success",\n  "data": {\n    "order_id": "order_789",\n    "order_number": "ORD-2025-0001",\n    "status": "pending",\n    "total": 125.50,\n    "items_count": 3,\n    "reservation_expires_at": "2025-11-23T15:15:00Z",\n    "payment_required": true\n  }\n}\n'})}),"\n",(0,s.jsx)(n.h3,{id:"2-procesar-pago",children:"2. Procesar Pago"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-http",children:'POST /api/v1/orders/{orderId}/payments\n{\n  "payment_method": "stripe",\n  "payment_method_id": "pm_xxx",\n  "amount": 125.50,\n  "currency": "USD"\n}\n'})}),"\n",(0,s.jsx)(n.h3,{id:"3-consultar-estado-de-orden",children:"3. Consultar Estado de Orden"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-http",children:"GET /api/v1/orders/{orderId}\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Respuesta:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'{\n  "status": "success",\n  "data": {\n    "order_id": "order_789",\n    "order_number": "ORD-2025-0001",\n    "status": "shipped",\n    "customer": {\n      "customer_id": "cust_456",\n      "name": "Juan P\xe9rez",\n      "email": "juan@example.com"\n    },\n    "items": [\n      {\n        "variant_id": "var_123",\n        "sku": "PROD-001-RED-M",\n        "product_name": "Camiseta Roja M",\n        "quantity": 2,\n        "unit_price": 25.00,\n        "subtotal": 50.00\n      }\n    ],\n    "totals": {\n      "subtotal": 100.00,\n      "shipping": 15.00,\n      "tax": 10.50,\n      "discount": 0.00,\n      "total": 125.50\n    },\n    "payment": {\n      "status": "paid",\n      "method": "stripe",\n      "paid_at": "2025-11-23T15:05:00Z"\n    },\n    "shipment": {\n      "carrier": "FedEx",\n      "tracking_number": "123456789",\n      "status": "in_transit",\n      "estimated_delivery": "2025-11-25"\n    },\n    "timeline": [\n      {\n        "status": "created",\n        "timestamp": "2025-11-23T15:00:00Z"\n      },\n      {\n        "status": "confirmed",\n        "timestamp": "2025-11-23T15:05:00Z"\n      },\n      {\n        "status": "shipped",\n        "timestamp": "2025-11-24T10:00:00Z"\n      }\n    ]\n  }\n}\n'})}),"\n",(0,s.jsx)(n.h3,{id:"4-solicitar-devoluci\xf3n",children:"4. Solicitar Devoluci\xf3n"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-http",children:'POST /api/v1/orders/{orderId}/returns\n{\n  "reason": "wrong_size",\n  "items": [\n    {\n      "order_item_id": "item_123",\n      "quantity": 1,\n      "reason_detail": "Talla muy peque\xf1a"\n    }\n  ],\n  "refund_method": "original_payment"\n}\n'})}),"\n",(0,s.jsx)(n.h2,{id:"seguridad-y-permisos",children:"Seguridad y Permisos"}),"\n",(0,s.jsx)(n.h3,{id:"roles-y-permisos",children:"Roles y Permisos"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Rol"}),(0,s.jsx)(n.th,{children:"Orders"}),(0,s.jsx)(n.th,{children:"Payments"}),(0,s.jsx)(n.th,{children:"Fulfillment"}),(0,s.jsx)(n.th,{children:"Returns"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"order.customer"})}),(0,s.jsx)(n.td,{children:"Own only"}),(0,s.jsx)(n.td,{children:"Own only"}),(0,s.jsx)(n.td,{children:"View"}),(0,s.jsx)(n.td,{children:"Create"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"order.operator"})}),(0,s.jsx)(n.td,{children:"Read, Update"}),(0,s.jsx)(n.td,{children:"Read"}),(0,s.jsx)(n.td,{children:"All"}),(0,s.jsx)(n.td,{children:"Approve"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"order.manager"})}),(0,s.jsx)(n.td,{children:"All"}),(0,s.jsx)(n.td,{children:"All"}),(0,s.jsx)(n.td,{children:"All"}),(0,s.jsx)(n.td,{children:"All"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"order.admin"})}),(0,s.jsx)(n.td,{children:"All"}),(0,s.jsx)(n.td,{children:"All"}),(0,s.jsx)(n.td,{children:"All"}),(0,s.jsx)(n.td,{children:"All"})]})]})]}),"\n",(0,s.jsx)(n.h3,{id:"validaciones-de-seguridad",children:"Validaciones de Seguridad"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Multi-tenancy por ",(0,s.jsx)(n.code,{children:"organization_id"})]}),"\n",(0,s.jsx)(n.li,{children:"Clientes solo ven sus propias \xf3rdenes"}),"\n",(0,s.jsx)(n.li,{children:"Validaci\xf3n de ownership en pagos"}),"\n",(0,s.jsx)(n.li,{children:"Cifrado de informaci\xf3n de pago (PCI DSS)"}),"\n",(0,s.jsx)(n.li,{children:"Rate limiting en APIs p\xfablicas"}),"\n",(0,s.jsx)(n.li,{children:"Validaci\xf3n de webhooks con firmas"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"m\xe9tricas-y-monitoring",children:"M\xe9tricas y Monitoring"}),"\n",(0,s.jsx)(n.h3,{id:"kpis-principales",children:"KPIs Principales"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Conversion Rate"})," - Tasa de conversi\xf3n de carritos a \xf3rdenes"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Average Order Value (AOV)"})," - Valor promedio de orden"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Cart Abandonment Rate"})," - Tasa de abandono de carrito"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Order Fulfillment Time"})," - Tiempo desde orden a env\xedo"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Payment Success Rate"})," - Tasa de \xe9xito de pagos"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Return Rate"})," - Tasa de devoluciones"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"health-checks",children:"Health Checks"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# Basic health\nGET /health\n\n# Detailed readiness\nGET /health/ready\n\n# Database connectivity\nGET /health/db\n\n# External services\nGET /health/integrations\n"})}),"\n",(0,s.jsx)(n.h2,{id:"pr\xf3ximos-pasos",children:"Pr\xf3ximos Pasos"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"./arquitectura",children:"Arquitectura"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"./modelo-datos",children:"Modelo de Datos"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"./api-orders",children:"API: Orders"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"./api-cart",children:"API: Cart"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"./api-payments",children:"API: Payments"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"./state-machine",children:"State Machine"})}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,d.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(o,{...e})}):o(e)}},8453:(e,n,i)=>{i.d(n,{R:()=>l,x:()=>c});var r=i(6540);const s={},d=r.createContext(s);function l(e){const n=r.useContext(d);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:l(e.components),r.createElement(d.Provider,{value:n},e.children)}}}]);