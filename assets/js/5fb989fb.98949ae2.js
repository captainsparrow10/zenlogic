"use strict";(globalThis.webpackChunkerp_docs=globalThis.webpackChunkerp_docs||[]).push([[7120],{1615:(e,n,a)=>{a.r(n),a.d(n,{assets:()=>t,contentTitle:()=>o,default:()=>p,frontMatter:()=>l,metadata:()=>i,toc:()=>c});const i=JSON.parse('{"id":"guias/setup-local","title":"Setup Local de Desarrollo","description":"Gu\xeda completa para configurar el entorno de desarrollo local de zenLogic.","source":"@site/docs/05-guias/00-setup-local.md","sourceDirName":"05-guias","slug":"/guias/setup-local","permalink":"/zenlogic/guias/setup-local","draft":false,"unlisted":false,"editUrl":"https://github.com/your-repo/edit/main/docs/05-guias/00-setup-local.md","tags":[],"version":"current","sidebarPosition":1,"frontMatter":{"sidebar_position":1},"sidebar":"docs","previous":{"title":"PostgreSQL - Base de Datos","permalink":"/zenlogic/integraciones/postgresql"},"next":{"title":"Crear un Nuevo Microservicio","permalink":"/zenlogic/guias/crear-microservicio"}}');var r=a(4848),s=a(8453);const l={sidebar_position:1},o="Setup Local de Desarrollo",t={},c=[{value:"Prerequisitos",id:"prerequisitos",level:2},{value:"Software Requerido",id:"software-requerido",level:3},{value:"Instalaci\xf3n de Herramientas",id:"instalaci\xf3n-de-herramientas",level:3},{value:"Clonar Repositorio",id:"clonar-repositorio",level:2},{value:"Configuraci\xf3n de Infraestructura",id:"configuraci\xf3n-de-infraestructura",level:2},{value:"1. Docker Compose",id:"1-docker-compose",level:3},{value:"2. Inicializar Bases de Datos",id:"2-inicializar-bases-de-datos",level:3},{value:"3. Levantar Infraestructura",id:"3-levantar-infraestructura",level:3},{value:"Configuraci\xf3n de Auth Service",id:"configuraci\xf3n-de-auth-service",level:2},{value:"1. Crear Virtual Environment",id:"1-crear-virtual-environment",level:3},{value:"2. Instalar Dependencias",id:"2-instalar-dependencias",level:3},{value:"3. Configurar Variables de Entorno",id:"3-configurar-variables-de-entorno",level:3},{value:"4. Generar Claves RSA (para JWT)",id:"4-generar-claves-rsa-para-jwt",level:3},{value:"5. Ejecutar Migraciones",id:"5-ejecutar-migraciones",level:3},{value:"6. Seed de Datos Iniciales",id:"6-seed-de-datos-iniciales",level:3},{value:"7. Iniciar Servidor",id:"7-iniciar-servidor",level:3},{value:"Configuraci\xf3n de Catalog Service",id:"configuraci\xf3n-de-catalog-service",level:2},{value:"Configuraci\xf3n de Audit Service",id:"configuraci\xf3n-de-audit-service",level:2},{value:"Verificaci\xf3n",id:"verificaci\xf3n",level:2},{value:"Health Checks",id:"health-checks",level:3},{value:"API Docs",id:"api-docs",level:3},{value:"RabbitMQ Management",id:"rabbitmq-management",level:3},{value:"Testing",id:"testing",level:2},{value:"Troubleshooting",id:"troubleshooting",level:2},{value:"Error: Connection refused (PostgreSQL)",id:"error-connection-refused-postgresql",level:3},{value:"Error: ModuleNotFoundError",id:"error-modulenotfounderror",level:3},{value:"Error: Alembic migration failed",id:"error-alembic-migration-failed",level:3},{value:"Scripts \xdatiles",id:"scripts-\xfatiles",level:2},{value:"Start All Services",id:"start-all-services",level:3},{value:"Stop All",id:"stop-all",level:3},{value:"Pr\xf3ximos Pasos",id:"pr\xf3ximos-pasos",level:2}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,s.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"setup-local-de-desarrollo",children:"Setup Local de Desarrollo"})}),"\n",(0,r.jsx)(n.p,{children:"Gu\xeda completa para configurar el entorno de desarrollo local de zenLogic."}),"\n",(0,r.jsx)(n.h2,{id:"prerequisitos",children:"Prerequisitos"}),"\n",(0,r.jsx)(n.h3,{id:"software-requerido",children:"Software Requerido"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# Versiones m\xednimas\nPython: 3.11+\nNode.js: 18+\nDocker: 20.10+\nDocker Compose: 2.0+\nGit: 2.30+\n"})}),"\n",(0,r.jsx)(n.h3,{id:"instalaci\xf3n-de-herramientas",children:"Instalaci\xf3n de Herramientas"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# macOS (con Homebrew)\nbrew install python@3.11\nbrew install node\nbrew install docker\nbrew install git\n\n# Ubuntu/Debian\nsudo apt update\nsudo apt install python3.11 python3.11-venv\nsudo apt install nodejs npm\nsudo apt install docker.io docker-compose\nsudo apt install git\n\n# Verificar instalaciones\npython3.11 --version\nnode --version\ndocker --version\ngit --version\n"})}),"\n",(0,r.jsx)(n.h2,{id:"clonar-repositorio",children:"Clonar Repositorio"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# Clonar proyecto\ngit clone https://github.com/tu-org/zenlogic-erp.git\ncd zenlogic-erp\n\n# Estructura del proyecto\nzenlogic-erp/\n\u251c\u2500\u2500 services/\n\u2502   \u251c\u2500\u2500 auth-service/\n\u2502   \u251c\u2500\u2500 catalog-service/\n\u2502   \u2514\u2500\u2500 audit-service/\n\u251c\u2500\u2500 docker-compose.yml\n\u251c\u2500\u2500 .env.example\n\u2514\u2500\u2500 README.md\n"})}),"\n",(0,r.jsx)(n.h2,{id:"configuraci\xf3n-de-infraestructura",children:"Configuraci\xf3n de Infraestructura"}),"\n",(0,r.jsx)(n.h3,{id:"1-docker-compose",children:"1. Docker Compose"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:'# docker-compose.yml\nversion: \'3.8\'\n\nservices:\n  postgres:\n    image: postgres:15-alpine\n    ports:\n      - "5432:5432"\n    environment:\n      POSTGRES_USER: erp_user\n      POSTGRES_PASSWORD: erp_password\n      POSTGRES_DB: postgres\n    volumes:\n      - postgres_data:/var/lib/postgresql/data\n      - ./init-dbs.sql:/docker-entrypoint-initdb.d/init-dbs.sql\n\n  redis:\n    image: redis:7-alpine\n    ports:\n      - "6379:6379"\n    command: redis-server --appendonly yes\n    volumes:\n      - redis_data:/data\n\n  rabbitmq:\n    image: rabbitmq:3.12-management\n    ports:\n      - "5672:5672"\n      - "15672:15672"\n    environment:\n      RABBITMQ_DEFAULT_USER: admin\n      RABBITMQ_DEFAULT_PASS: admin123\n    volumes:\n      - rabbitmq_data:/var/lib/rabbitmq\n\nvolumes:\n  postgres_data:\n  redis_data:\n  rabbitmq_data:\n'})}),"\n",(0,r.jsx)(n.h3,{id:"2-inicializar-bases-de-datos",children:"2. Inicializar Bases de Datos"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:'-- init-dbs.sql\nCREATE DATABASE auth_db;\nCREATE DATABASE catalog_db;\nCREATE DATABASE audit_db;\n\n\\c auth_db\nCREATE EXTENSION IF NOT EXISTS "uuid-ossp";\nCREATE EXTENSION IF NOT EXISTS "pg_trgm";\n\n\\c catalog_db\nCREATE EXTENSION IF NOT EXISTS "uuid-ossp";\nCREATE EXTENSION IF NOT EXISTS "pg_trgm";\nCREATE EXTENSION IF NOT EXISTS "btree_gist";\n\n\\c audit_db\nCREATE EXTENSION IF NOT EXISTS "uuid-ossp";\n'})}),"\n",(0,r.jsx)(n.h3,{id:"3-levantar-infraestructura",children:"3. Levantar Infraestructura"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# Iniciar servicios\ndocker-compose up -d\n\n# Verificar que est\xe9n corriendo\ndocker-compose ps\n\n# Ver logs\ndocker-compose logs -f\n\n# Estado esperado:\n# postgres    Up      5432/tcp\n# redis       Up      6379/tcp\n# rabbitmq    Up      5672/tcp, 15672/tcp\n"})}),"\n",(0,r.jsx)(n.h2,{id:"configuraci\xf3n-de-auth-service",children:"Configuraci\xf3n de Auth Service"}),"\n",(0,r.jsx)(n.h3,{id:"1-crear-virtual-environment",children:"1. Crear Virtual Environment"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"cd services/auth-service\n\n# Crear virtualenv\npython3.11 -m venv venv\n\n# Activar\nsource venv/bin/activate  # Linux/macOS\n# o\nvenv\\Scripts\\activate     # Windows\n\n# Actualizar pip\npip install --upgrade pip\n"})}),"\n",(0,r.jsx)(n.h3,{id:"2-instalar-dependencias",children:"2. Instalar Dependencias"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# Instalar desde requirements.txt\npip install -r requirements.txt\n\n# O instalar manualmente las principales\npip install fastapi==0.104.1\npip install uvicorn[standard]==0.24.0\npip install sqlalchemy[asyncio]==2.0.23\npip install asyncpg==0.29.0\npip install alembic==1.12.1\npip install pydantic==2.5.0\npip install pydantic-settings==2.1.0\npip install python-jose[cryptography]==3.3.0\npip install passlib[bcrypt]==1.7.4\npip install aio-pika==9.3.0\npip install aioredis==2.0.1\npip install grpcio==1.59.3\npip install grpcio-tools==1.59.3\npip install prometheus-client==0.19.0\n"})}),"\n",(0,r.jsx)(n.h3,{id:"3-configurar-variables-de-entorno",children:"3. Configurar Variables de Entorno"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# Copiar template\ncp .env.example .env\n\n# Editar .env\nnano .env\n"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# .env - Auth Service\nSERVICE_NAME=auth-service\nAPI_PORT=8001\nGRPC_PORT=50051\n\n# Database\nDATABASE_URL=postgresql+asyncpg://erp_user:erp_password@localhost:5432/auth_db\n\n# Redis\nREDIS_URL=redis://localhost:6379/0\n\n# RabbitMQ\nRABBITMQ_URL=amqp://admin:admin123@localhost:5672/\nRABBITMQ_EXCHANGE=erp.events\n\n# JWT\nSECRET_KEY=your-secret-key-here-change-in-production\nALGORITHM=RS256\nACCESS_TOKEN_EXPIRE_MINUTES=15\nREFRESH_TOKEN_EXPIRE_DAYS=7\n\n# CORS\nCORS_ORIGINS=http://localhost:3000,http://localhost:8080\n\n# Debug\nDEBUG=true\nLOG_LEVEL=INFO\n"})}),"\n",(0,r.jsx)(n.h3,{id:"4-generar-claves-rsa-para-jwt",children:"4. Generar Claves RSA (para JWT)"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# Generar clave privada\nopenssl genrsa -out private_key.pem 2048\n\n# Generar clave p\xfablica\nopenssl rsa -in private_key.pem -pubout -out public_key.pem\n\n# Mover a carpeta de secrets\nmkdir -p secrets\nmv private_key.pem public_key.pem secrets/\n"})}),"\n",(0,r.jsx)(n.h3,{id:"5-ejecutar-migraciones",children:"5. Ejecutar Migraciones"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'# Inicializar Alembic (si no est\xe1 inicializado)\nalembic init alembic\n\n# Generar migraci\xf3n inicial\nalembic revision --autogenerate -m "initial schema"\n\n# Aplicar migraciones\nalembic upgrade head\n\n# Verificar en PostgreSQL\npsql -U erp_user -d auth_db -c "\\dt"\n'})}),"\n",(0,r.jsx)(n.h3,{id:"6-seed-de-datos-iniciales",children:"6. Seed de Datos Iniciales"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# Ejecutar seed script\npython scripts/seed_data.py\n"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:'# scripts/seed_data.py\nimport asyncio\nfrom app.database import get_db\nfrom app.models import Organization, User, Role, Permission\nfrom app.services.auth_service import AuthService\n\nasync def seed():\n    """Seed datos iniciales."""\n\n    async with get_db() as db:\n        # Crear organizaci\xf3n demo\n        org = Organization(\n            name="Demo Organization",\n            is_active=True\n        )\n        db.add(org)\n        await db.commit()\n\n        # Crear rol admin\n        admin_role = Role(\n            organization_id=org.id,\n            name="admin",\n            description="Administrator role",\n            is_system_role=True\n        )\n        db.add(admin_role)\n        await db.commit()\n\n        # Crear usuario admin\n        auth_service = AuthService(db)\n        admin_user = await auth_service.create_user(\n            email="admin@demo.com",\n            password="admin123",\n            organization_id=org.id\n        )\n\n        # Asignar rol\n        admin_user.roles.append(admin_role)\n        await db.commit()\n\n        print("Seed completed!")\n        print(f"Admin user: admin@demo.com / admin123")\n\nif __name__ == "__main__":\n    asyncio.run(seed())\n'})}),"\n",(0,r.jsx)(n.h3,{id:"7-iniciar-servidor",children:"7. Iniciar Servidor"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# Desarrollo (con hot reload)\nuvicorn app.main:app --reload --port 8001\n\n# O con script\npython run.py\n"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:'# run.py\nimport uvicorn\n\nif __name__ == "__main__":\n    uvicorn.run(\n        "app.main:app",\n        host="0.0.0.0",\n        port=8001,\n        reload=True,\n        log_level="info"\n    )\n'})}),"\n",(0,r.jsx)(n.h2,{id:"configuraci\xf3n-de-catalog-service",children:"Configuraci\xf3n de Catalog Service"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"cd ../catalog-service\n\n# Mismo proceso que Auth Service\npython3.11 -m venv venv\nsource venv/bin/activate\npip install -r requirements.txt\ncp .env.example .env\n\n# Editar .env\nnano .env\n"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# .env - Catalog Service\nSERVICE_NAME=catalog-service\nAPI_PORT=8002\n\nDATABASE_URL=postgresql+asyncpg://erp_user:erp_password@localhost:5432/catalog_db\nREDIS_URL=redis://localhost:6379/1\nRABBITMQ_URL=amqp://admin:admin123@localhost:5672/\n\n# Auth Service gRPC\nAUTH_GRPC_URL=localhost:50051\n\nDEBUG=true\n"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# Migraciones\nalembic upgrade head\n\n# Iniciar servidor\nuvicorn app.main:app --reload --port 8002\n"})}),"\n",(0,r.jsx)(n.h2,{id:"configuraci\xf3n-de-audit-service",children:"Configuraci\xf3n de Audit Service"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"cd ../audit-service\n\npython3.11 -m venv venv\nsource venv/bin/activate\npip install -r requirements.txt\ncp .env.example .env\n"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# .env - Audit Service\nSERVICE_NAME=audit-service\nAPI_PORT=8003\n\nDATABASE_URL=postgresql+asyncpg://erp_user:erp_password@localhost:5432/audit_db\nRABBITMQ_URL=amqp://admin:admin123@localhost:5672/\n\nDEBUG=true\n"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# Migraciones\nalembic upgrade head\n\n# Iniciar servidor\nuvicorn app.main:app --reload --port 8003\n"})}),"\n",(0,r.jsx)(n.h2,{id:"verificaci\xf3n",children:"Verificaci\xf3n"}),"\n",(0,r.jsx)(n.h3,{id:"health-checks",children:"Health Checks"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# Auth Service\ncurl http://localhost:8001/health\n\n# Catalog Service\ncurl http://localhost:8002/health\n\n# Audit Service\ncurl http://localhost:8003/health\n"})}),"\n",(0,r.jsx)(n.h3,{id:"api-docs",children:"API Docs"}),"\n",(0,r.jsx)(n.p,{children:"Abrir en navegador:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Auth: ",(0,r.jsx)(n.a,{href:"http://localhost:8001/docs",children:"http://localhost:8001/docs"})]}),"\n",(0,r.jsxs)(n.li,{children:["Catalog: ",(0,r.jsx)(n.a,{href:"http://localhost:8002/docs",children:"http://localhost:8002/docs"})]}),"\n",(0,r.jsxs)(n.li,{children:["Audit: ",(0,r.jsx)(n.a,{href:"http://localhost:8003/docs",children:"http://localhost:8003/docs"})]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"rabbitmq-management",children:"RabbitMQ Management"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["URL: ",(0,r.jsx)(n.a,{href:"http://localhost:15672",children:"http://localhost:15672"})]}),"\n",(0,r.jsx)(n.li,{children:"User: admin"}),"\n",(0,r.jsx)(n.li,{children:"Password: admin123"}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"testing",children:"Testing"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# Instalar dependencias de testing\npip install pytest pytest-asyncio pytest-cov httpx\n\n# Ejecutar tests\npytest\n\n# Con coverage\npytest --cov=app --cov-report=html\n\n# Tests espec\xedficos\npytest tests/test_auth.py -v\n"})}),"\n",(0,r.jsx)(n.h2,{id:"troubleshooting",children:"Troubleshooting"}),"\n",(0,r.jsx)(n.h3,{id:"error-connection-refused-postgresql",children:"Error: Connection refused (PostgreSQL)"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# Verificar que PostgreSQL est\xe9 corriendo\ndocker-compose ps postgres\n\n# Ver logs\ndocker-compose logs postgres\n\n# Reiniciar\ndocker-compose restart postgres\n"})}),"\n",(0,r.jsx)(n.h3,{id:"error-modulenotfounderror",children:"Error: ModuleNotFoundError"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# Verificar que virtualenv est\xe9 activado\nwhich python  # Debe apuntar a venv/bin/python\n\n# Reinstalar dependencias\npip install -r requirements.txt\n"})}),"\n",(0,r.jsx)(n.h3,{id:"error-alembic-migration-failed",children:"Error: Alembic migration failed"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'# Rollback\nalembic downgrade -1\n\n# Revisar logs\nalembic history\n\n# Regenerar migraci\xf3n\nalembic revision --autogenerate -m "fix migration"\n'})}),"\n",(0,r.jsx)(n.h2,{id:"scripts-\xfatiles",children:"Scripts \xdatiles"}),"\n",(0,r.jsx)(n.h3,{id:"start-all-services",children:"Start All Services"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'#!/bin/bash\n# scripts/start-all.sh\n\n# Start infrastructure\ndocker-compose up -d\n\n# Wait for services\nsleep 5\n\n# Start Auth Service\ncd services/auth-service\nsource venv/bin/activate\nuvicorn app.main:app --reload --port 8001 &\n\n# Start Catalog Service\ncd ../catalog-service\nsource venv/bin/activate\nuvicorn app.main:app --reload --port 8002 &\n\n# Start Audit Service\ncd ../audit-service\nsource venv/bin/activate\nuvicorn app.main:app --reload --port 8003 &\n\necho "All services started!"\n'})}),"\n",(0,r.jsx)(n.h3,{id:"stop-all",children:"Stop All"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'#!/bin/bash\n# scripts/stop-all.sh\n\n# Stop Python services\npkill -f uvicorn\n\n# Stop infrastructure\ndocker-compose down\n\necho "All services stopped!"\n'})}),"\n",(0,r.jsx)(n.h2,{id:"pr\xf3ximos-pasos",children:"Pr\xf3ximos Pasos"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"/guias/crear-microservicio",children:"Crear un Nuevo Microservicio"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"/guias/testing",children:"Testing"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"/guias/deployment",children:"Deployment"})}),"\n"]})]})}function p(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}},8453:(e,n,a)=>{a.d(n,{R:()=>l,x:()=>o});var i=a(6540);const r={},s=i.createContext(r);function l(e){const n=i.useContext(s);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:l(e.components),i.createElement(s.Provider,{value:n},e.children)}}}]);