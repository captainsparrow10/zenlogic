"use strict";(globalThis.webpackChunkerp_docs=globalThis.webpackChunkerp_docs||[]).push([[4465],{1111:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>t,contentTitle:()=>o,default:()=>h,frontMatter:()=>d,metadata:()=>i,toc:()=>c});const i=JSON.parse('{"id":"microservicios/auth-service/eventos-publicados","title":"Eventos Publicados","description":"Auth Service publica eventos a RabbitMQ para notificar cambios a otros microservicios.","source":"@site/docs/02-microservicios/auth-service/05-eventos-publicados.md","sourceDirName":"02-microservicios/auth-service","slug":"/microservicios/auth-service/eventos-publicados","permalink":"/zenlogic/microservicios/auth-service/eventos-publicados","draft":false,"unlisted":false,"editUrl":"https://github.com/your-repo/edit/main/docs/02-microservicios/auth-service/05-eventos-publicados.md","tags":[],"version":"current","sidebarPosition":6,"frontMatter":{"sidebar_position":6},"sidebar":"docs","previous":{"title":"Configuraci\xf3n","permalink":"/zenlogic/microservicios/auth-service/configuracion"},"next":{"title":"gRPC Server","permalink":"/zenlogic/microservicios/auth-service/grpc-server"}}');var a=s(4848),r=s(8453);const d={sidebar_position:6},o="Eventos Publicados",t={},c=[{value:"Exchange Configuration",id:"exchange-configuration",level:2},{value:"Formato de Eventos",id:"formato-de-eventos",level:2},{value:"Eventos de Usuarios",id:"eventos-de-usuarios",level:2},{value:"auth.user.created",id:"authusercreated",level:3},{value:"auth.user.updated",id:"authuserupdated",level:3},{value:"auth.user.deactivated",id:"authuserdeactivated",level:3},{value:"auth.user.deleted",id:"authuserdeleted",level:3},{value:"auth.user.password_changed",id:"authuserpassword_changed",level:3},{value:"Eventos de Roles",id:"eventos-de-roles",level:2},{value:"auth.role.created",id:"authrolecreated",level:3},{value:"auth.role.permissions_changed",id:"authrolepermissions_changed",level:3},{value:"Eventos de Organizaciones",id:"eventos-de-organizaciones",level:2},{value:"auth.organization.created",id:"authorganizationcreated",level:3},{value:"auth.organization.module_enabled",id:"authorganizationmodule_enabled",level:3},{value:"auth.organization.suspended",id:"authorganizationsuspended",level:3},{value:"Eventos de Locales",id:"eventos-de-locales",level:2},{value:"auth.local.created",id:"authlocalcreated",level:3},{value:"Eventos de Sesiones",id:"eventos-de-sesiones",level:2},{value:"auth.session.created",id:"authsessioncreated",level:3},{value:"auth.session.revoked",id:"authsessionrevoked",level:3},{value:"Consumo de Eventos",id:"consumo-de-eventos",level:2},{value:"Ejemplo: Catalog Service",id:"ejemplo-catalog-service",level:3},{value:"Tabla de Routing Keys",id:"tabla-de-routing-keys",level:2},{value:"Pr\xf3ximos Pasos",id:"pr\xf3ximos-pasos",level:2}];function l(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.header,{children:(0,a.jsx)(n.h1,{id:"eventos-publicados",children:"Eventos Publicados"})}),"\n",(0,a.jsx)(n.p,{children:"Auth Service publica eventos a RabbitMQ para notificar cambios a otros microservicios."}),"\n",(0,a.jsx)(n.h2,{id:"exchange-configuration",children:"Exchange Configuration"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-python",children:'exchange_name = "auth_events"\nexchange_type = "topic"\ndurable = True\n'})}),"\n",(0,a.jsx)(n.h2,{id:"formato-de-eventos",children:"Formato de Eventos"}),"\n",(0,a.jsx)(n.p,{children:"Todos los eventos siguen este formato est\xe1ndar:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-json",children:'{\n  "event_type": "auth.user.created",\n  "timestamp": "2025-11-23T10:30:00Z",\n  "service": "auth-service",\n  "payload": {\n    "user_id": "user_001",\n    "organization_id": "org_123",\n    ...\n  }\n}\n'})}),"\n",(0,a.jsx)(n.h2,{id:"eventos-de-usuarios",children:"Eventos de Usuarios"}),"\n",(0,a.jsx)(n.h3,{id:"authusercreated",children:"auth.user.created"}),"\n",(0,a.jsx)(n.p,{children:"Publicado cuando se crea un nuevo usuario."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-json",children:'{\n  "event_type": "auth.user.created",\n  "timestamp": "2025-11-23T10:30:00Z",\n  "service": "auth-service",\n  "payload": {\n    "user_id": "user_001",\n    "organization_id": "org_123",\n    "email": "user@example.com",\n    "first_name": "Juan",\n    "last_name": "P\xe9rez",\n    "roles": ["role_admin"],\n    "locals": ["local_01"],\n    "active": true\n  }\n}\n'})}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Routing Key"}),": ",(0,a.jsx)(n.code,{children:"auth.user.created"})]}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Consumidores"}),":"]}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Audit Service"}),": Registra la creaci\xf3n"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Notification Service"}),": Env\xeda email de bienvenida"]}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"authuserupdated",children:"auth.user.updated"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-json",children:'{\n  "event_type": "auth.user.updated",\n  "timestamp": "2025-11-23T10:35:00Z",\n  "service": "auth-service",\n  "payload": {\n    "user_id": "user_001",\n    "organization_id": "org_123",\n    "changes": {\n      "email": {"old": "old@example.com", "new": "new@example.com"},\n      "roles": {"added": ["role_manager"], "removed": []}\n    }\n  }\n}\n'})}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Routing Key"}),": ",(0,a.jsx)(n.code,{children:"auth.user.updated"})]}),"\n",(0,a.jsx)(n.h3,{id:"authuserdeactivated",children:"auth.user.deactivated"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-json",children:'{\n  "event_type": "auth.user.deactivated",\n  "timestamp": "2025-11-23T10:40:00Z",\n  "service": "auth-service",\n  "payload": {\n    "user_id": "user_001",\n    "organization_id": "org_123",\n    "reason": "manual"  // "manual", "too_many_attempts"\n  }\n}\n'})}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Routing Key"}),": ",(0,a.jsx)(n.code,{children:"auth.user.deactivated"})]}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Consumidores"}),":"]}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Todos los servicios"}),": Invalidan cache de usuario"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Order Service"}),": Cancela \xf3rdenes pendientes del usuario"]}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"authuserdeleted",children:"auth.user.deleted"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-json",children:'{\n  "event_type": "auth.user.deleted",\n  "timestamp": "2025-11-23T10:45:00Z",\n  "service": "auth-service",\n  "payload": {\n    "user_id": "user_001",\n    "organization_id": "org_123"\n  }\n}\n'})}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Routing Key"}),": ",(0,a.jsx)(n.code,{children:"auth.user.deleted"})]}),"\n",(0,a.jsx)(n.h3,{id:"authuserpassword_changed",children:"auth.user.password_changed"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-json",children:'{\n  "event_type": "auth.user.password_changed",\n  "timestamp": "2025-11-23T10:50:00Z",\n  "service": "auth-service",\n  "payload": {\n    "user_id": "user_001",\n    "organization_id": "org_123",\n    "changed_by": "user_001"  // self-change\n  }\n}\n'})}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Routing Key"}),": ",(0,a.jsx)(n.code,{children:"auth.user.password_changed"})]}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Consumidores"}),":"]}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Audit Service"}),": Registra el cambio"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Notification Service"}),": Env\xeda notificaci\xf3n de seguridad"]}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"eventos-de-roles",children:"Eventos de Roles"}),"\n",(0,a.jsx)(n.h3,{id:"authrolecreated",children:"auth.role.created"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-json",children:'{\n  "event_type": "auth.role.created",\n  "timestamp": "2025-11-23T11:00:00Z",\n  "service": "auth-service",\n  "payload": {\n    "role_id": "role_custom_01",\n    "organization_id": "org_123",\n    "name": "Gerente de Ventas",\n    "permissions": ["catalog:read", "orders:create"]\n  }\n}\n'})}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Routing Key"}),": ",(0,a.jsx)(n.code,{children:"auth.role.created"})]}),"\n",(0,a.jsx)(n.h3,{id:"authrolepermissions_changed",children:"auth.role.permissions_changed"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-json",children:'{\n  "event_type": "auth.role.permissions_changed",\n  "timestamp": "2025-11-23T11:05:00Z",\n  "service": "auth-service",\n  "payload": {\n    "role_id": "role_custom_01",\n    "organization_id": "org_123",\n    "permissions": {\n      "added": ["catalog:edit"],\n      "removed": []\n    }\n  }\n}\n'})}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Routing Key"}),": ",(0,a.jsx)(n.code,{children:"auth.role.permissions_changed"})]}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Consumidores"}),":"]}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Todos los servicios"}),": Invalidan cache de permisos"]}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"eventos-de-organizaciones",children:"Eventos de Organizaciones"}),"\n",(0,a.jsx)(n.h3,{id:"authorganizationcreated",children:"auth.organization.created"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-json",children:'{\n  "event_type": "auth.organization.created",\n  "timestamp": "2025-11-23T11:10:00Z",\n  "service": "auth-service",\n  "payload": {\n    "organization_id": "org_456",\n    "name": "Nueva Empresa S.A.",\n    "slug": "nueva-empresa",\n    "plan": "pro",\n    "modules_enabled": ["catalog", "inventory", "orders"]\n  }\n}\n'})}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Routing Key"}),": ",(0,a.jsx)(n.code,{children:"auth.organization.created"})]}),"\n",(0,a.jsx)(n.h3,{id:"authorganizationmodule_enabled",children:"auth.organization.module_enabled"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-json",children:'{\n  "event_type": "auth.organization.module_enabled",\n  "timestamp": "2025-11-23T11:15:00Z",\n  "service": "auth-service",\n  "payload": {\n    "organization_id": "org_123",\n    "module_id": "module_pricing",\n    "module_name": "Precios"\n  }\n}\n'})}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Routing Key"}),": ",(0,a.jsx)(n.code,{children:"auth.organization.module_enabled"})]}),"\n",(0,a.jsx)(n.h3,{id:"authorganizationsuspended",children:"auth.organization.suspended"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-json",children:'{\n  "event_type": "auth.organization.suspended",\n  "timestamp": "2025-11-23T11:20:00Z",\n  "service": "auth-service",\n  "payload": {\n    "organization_id": "org_123",\n    "reason": "payment_failure"\n  }\n}\n'})}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Routing Key"}),": ",(0,a.jsx)(n.code,{children:"auth.organization.suspended"})]}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Consumidores"}),":"]}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Todos los servicios"}),": Rechazan requests de esta organizaci\xf3n"]}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"eventos-de-locales",children:"Eventos de Locales"}),"\n",(0,a.jsx)(n.h3,{id:"authlocalcreated",children:"auth.local.created"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-json",children:'{\n  "event_type": "auth.local.created",\n  "timestamp": "2025-11-23T11:25:00Z",\n  "service": "auth-service",\n  "payload": {\n    "local_id": "local_03",\n    "organization_id": "org_123",\n    "name": "Sucursal Norte",\n    "code": "SN-03"\n  }\n}\n'})}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Routing Key"}),": ",(0,a.jsx)(n.code,{children:"auth.local.created"})]}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Consumidores"}),":"]}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Inventory Service"}),": Inicializa stock para nuevo local"]}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"eventos-de-sesiones",children:"Eventos de Sesiones"}),"\n",(0,a.jsx)(n.h3,{id:"authsessioncreated",children:"auth.session.created"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-json",children:'{\n  "event_type": "auth.session.created",\n  "timestamp": "2025-11-23T11:30:00Z",\n  "service": "auth-service",\n  "payload": {\n    "user_id": "user_001",\n    "organization_id": "org_123",\n    "session_id": "session_abc123",\n    "ip_address": "192.168.1.100",\n    "user_agent": "Mozilla/5.0..."\n  }\n}\n'})}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Routing Key"}),": ",(0,a.jsx)(n.code,{children:"auth.session.created"})]}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Consumidores"}),":"]}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Audit Service"}),": Registra inicio de sesi\xf3n"]}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"authsessionrevoked",children:"auth.session.revoked"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-json",children:'{\n  "event_type": "auth.session.revoked",\n  "timestamp": "2025-11-23T12:00:00Z",\n  "service": "auth-service",\n  "payload": {\n    "user_id": "user_001",\n    "organization_id": "org_123",\n    "session_id": "session_abc123",\n    "reason": "logout"  // "logout", "expired", "revoked"\n  }\n}\n'})}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Routing Key"}),": ",(0,a.jsx)(n.code,{children:"auth.session.revoked"})]}),"\n",(0,a.jsx)(n.h2,{id:"consumo-de-eventos",children:"Consumo de Eventos"}),"\n",(0,a.jsx)(n.h3,{id:"ejemplo-catalog-service",children:"Ejemplo: Catalog Service"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-python",children:"import pika\nimport json\n\ndef callback(ch, method, properties, body):\n    event = json.loads(body)\n\n    if event[\"event_type\"] == \"auth.user.deactivated\":\n        user_id = event[\"payload\"][\"user_id\"]\n        # Invalidar cache\n        await cache.delete(f\"user:{user_id}\")\n        logger.info(f\"Cache invalidated for user {user_id}\")\n\n    ch.basic_ack(delivery_tag=method.delivery_tag)\n\nconnection = pika.BlockingConnection(pika.ConnectionParameters('localhost'))\nchannel = connection.channel()\n\n# Declarar exchange\nchannel.exchange_declare(\n    exchange='auth_events',\n    exchange_type='topic',\n    durable=True\n)\n\n# Crear queue\nchannel.queue_declare(queue='catalog_auth_events', durable=True)\n\n# Bind a eventos espec\xedficos\nchannel.queue_bind(\n    exchange='auth_events',\n    queue='catalog_auth_events',\n    routing_key='auth.user.*'\n)\nchannel.queue_bind(\n    exchange='auth_events',\n    queue='catalog_auth_events',\n    routing_key='auth.organization.*'\n)\n\n# Consumir\nchannel.basic_consume(\n    queue='catalog_auth_events',\n    on_message_callback=callback\n)\n\nchannel.start_consuming()\n"})}),"\n",(0,a.jsx)(n.h2,{id:"tabla-de-routing-keys",children:"Tabla de Routing Keys"}),"\n",(0,a.jsxs)(n.table,{children:[(0,a.jsx)(n.thead,{children:(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.th,{children:"Evento"}),(0,a.jsx)(n.th,{children:"Routing Key"}),(0,a.jsx)(n.th,{children:"Consumidores T\xedpicos"})]})}),(0,a.jsxs)(n.tbody,{children:[(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:"user.created"}),(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"auth.user.created"})}),(0,a.jsx)(n.td,{children:"Audit, Notification"})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:"user.updated"}),(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"auth.user.updated"})}),(0,a.jsx)(n.td,{children:"Audit, Cache"})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:"user.deactivated"}),(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"auth.user.deactivated"})}),(0,a.jsx)(n.td,{children:"Todos los servicios"})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:"role.permissions_changed"}),(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"auth.role.permissions_changed"})}),(0,a.jsx)(n.td,{children:"Todos los servicios"})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:"organization.suspended"}),(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"auth.organization.suspended"})}),(0,a.jsx)(n.td,{children:"Todos los servicios"})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:"local.created"}),(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"auth.local.created"})}),(0,a.jsx)(n.td,{children:"Inventory"})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:"session.created"}),(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"auth.session.created"})}),(0,a.jsx)(n.td,{children:"Audit"})]})]})]}),"\n",(0,a.jsx)(n.h2,{id:"pr\xf3ximos-pasos",children:"Pr\xf3ximos Pasos"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.a,{href:"/microservicios/auth-service/grpc-server",children:"gRPC Server"})}),"\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.a,{href:"/arquitectura/arquitectura-event-driven",children:"Arquitectura Event-Driven"})}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(l,{...e})}):l(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>d,x:()=>o});var i=s(6540);const a={},r=i.createContext(a);function d(e){const n=i.useContext(r);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:d(e.components),i.createElement(r.Provider,{value:n},e.children)}}}]);