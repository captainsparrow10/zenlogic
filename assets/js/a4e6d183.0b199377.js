"use strict";(globalThis.webpackChunkerp_docs=globalThis.webpackChunkerp_docs||[]).push([[3303],{5114:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>d,contentTitle:()=>c,default:()=>p,frontMatter:()=>a,metadata:()=>i,toc:()=>o});const i=JSON.parse('{"id":"arquitectura/patrones-diseno","title":"Patrones de Dise\xf1o","description":"Introducci\xf3n","source":"@site/docs/01-arquitectura/06-patrones-diseno.md","sourceDirName":"01-arquitectura","slug":"/arquitectura/patrones-diseno","permalink":"/zenlogic/arquitectura/patrones-diseno","draft":false,"unlisted":false,"editUrl":"https://github.com/your-repo/edit/main/docs/01-arquitectura/06-patrones-diseno.md","tags":[],"version":"current","sidebarPosition":7,"frontMatter":{"sidebar_position":7},"sidebar":"docs","previous":{"title":"Seguridad y RBAC","permalink":"/zenlogic/arquitectura/seguridad-rbac"},"next":{"title":"Auth Service - Overview","permalink":"/zenlogic/microservicios/auth-service/overview"}}');var s=r(4848),t=r(8453);const a={sidebar_position:7},c="Patrones de Dise\xf1o",d={},o=[{value:"Introducci\xf3n",id:"introducci\xf3n",level:2},{value:"Patrones Arquitect\xf3nicos",id:"patrones-arquitect\xf3nicos",level:2},{value:"1. Microservicios",id:"1-microservicios",level:3},{value:"2. Event-Driven Architecture",id:"2-event-driven-architecture",level:3},{value:"3. API Gateway",id:"3-api-gateway",level:3},{value:"Patrones de Aplicaci\xf3n",id:"patrones-de-aplicaci\xf3n",level:2},{value:"4. Repository Pattern",id:"4-repository-pattern",level:3},{value:"5. Service Layer",id:"5-service-layer",level:3},{value:"6. Dependency Injection",id:"6-dependency-injection",level:3},{value:"Patrones de Resilencia",id:"patrones-de-resilencia",level:2},{value:"7. Circuit Breaker",id:"7-circuit-breaker",level:3},{value:"8. Retry con Backoff Exponencial",id:"8-retry-con-backoff-exponencial",level:3},{value:"9. Fallback",id:"9-fallback",level:3},{value:"Patrones de Datos",id:"patrones-de-datos",level:2},{value:"10. Cache-Aside",id:"10-cache-aside",level:3},{value:"11. Unit of Work",id:"11-unit-of-work",level:3},{value:"12. Event Sourcing (Parcial)",id:"12-event-sourcing-parcial",level:3},{value:"Patrones de Integraci\xf3n",id:"patrones-de-integraci\xf3n",level:2},{value:"13. Adapter Pattern",id:"13-adapter-pattern",level:3},{value:"14. Saga Pattern (Futuro)",id:"14-saga-pattern-futuro",level:3},{value:"Patrones de API",id:"patrones-de-api",level:2},{value:"15. Cursor Pagination",id:"15-cursor-pagination",level:3},{value:"16. API Versioning",id:"16-api-versioning",level:3},{value:"Tabla Resumen de Patrones",id:"tabla-resumen-de-patrones",level:2},{value:"Pr\xf3ximos Pasos",id:"pr\xf3ximos-pasos",level:2}];function l(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",mermaid:"mermaid",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"patrones-de-dise\xf1o",children:"Patrones de Dise\xf1o"})}),"\n",(0,s.jsx)(n.h2,{id:"introducci\xf3n",children:"Introducci\xf3n"}),"\n",(0,s.jsx)(n.p,{children:"El zenLogic implementa m\xfaltiples patrones de dise\xf1o reconocidos en la industria para garantizar mantenibilidad, escalabilidad y robustez."}),"\n",(0,s.jsx)(n.h2,{id:"patrones-arquitect\xf3nicos",children:"Patrones Arquitect\xf3nicos"}),"\n",(0,s.jsx)(n.h3,{id:"1-microservicios",children:"1. Microservicios"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Descripci\xf3n"}),": Dividir la aplicaci\xf3n en servicios peque\xf1os, independientes y desplegables por separado."]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Implementaci\xf3n"}),":"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Auth Service"}),"\n",(0,s.jsx)(n.li,{children:"Catalog Service"}),"\n",(0,s.jsx)(n.li,{children:"Audit Service"}),"\n",(0,s.jsx)(n.li,{children:"Inventory Service"}),"\n",(0,s.jsx)(n.li,{children:"Order Service"}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Beneficios"}),":"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\u2705 Escalabilidad independiente"}),"\n",(0,s.jsx)(n.li,{children:"\u2705 Tecnolog\xedas heterog\xe9neas posibles"}),"\n",(0,s.jsx)(n.li,{children:"\u2705 Fallas aisladas"}),"\n",(0,s.jsx)(n.li,{children:"\u2705 Despliegues independientes"}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Trade-offs"}),":"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\u274c Complejidad operacional"}),"\n",(0,s.jsx)(n.li,{children:"\u274c Latencia de red"}),"\n",(0,s.jsx)(n.li,{children:"\u274c Debugging distribuido m\xe1s dif\xedcil"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"2-event-driven-architecture",children:"2. Event-Driven Architecture"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Descripci\xf3n"}),": Los componentes se comunican mediante eventos as\xedncronos."]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Implementaci\xf3n"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:'# Producer\nawait event_publisher.publish(\n    event_type="auth.user.deactivated",\n    payload={"user_id": "user_001"}\n)\n\n# Consumer\n@event_consumer.on("auth.user.deactivated")\nasync def handle_user_deactivated(event):\n    await cache.invalidate_user(event["user_id"])\n'})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Beneficios"}),":"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\u2705 Desacoplamiento temporal"}),"\n",(0,s.jsx)(n.li,{children:"\u2705 Escalabilidad"}),"\n",(0,s.jsx)(n.li,{children:"\u2705 Extensibilidad"}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Trade-offs"}),":"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\u274c Consistencia eventual"}),"\n",(0,s.jsx)(n.li,{children:"\u274c Debugging complejo"}),"\n",(0,s.jsx)(n.li,{children:"\u274c Gesti\xf3n de eventos duplicados"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"3-api-gateway",children:"3. API Gateway"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Descripci\xf3n"}),": Punto de entrada \xfanico para todas las requests externas."]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Implementaci\xf3n"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"Cliente \u2192 API Gateway \u2192 [Auth, Catalog, Inventory, Orders]\n"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Beneficios"}),":"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\u2705 Punto \xfanico de autenticaci\xf3n"}),"\n",(0,s.jsx)(n.li,{children:"\u2705 Rate limiting centralizado"}),"\n",(0,s.jsx)(n.li,{children:"\u2705 Routing simplificado"}),"\n",(0,s.jsx)(n.li,{children:"\u2705 CORS management"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"patrones-de-aplicaci\xf3n",children:"Patrones de Aplicaci\xf3n"}),"\n",(0,s.jsx)(n.h3,{id:"4-repository-pattern",children:"4. Repository Pattern"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Descripci\xf3n"}),": Abstracci\xf3n de acceso a datos, separando l\xf3gica de negocio de persistencia."]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Implementaci\xf3n"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:'# Repository\nclass ProductRepository:\n    def __init__(self, db: Session):\n        self.db = db\n\n    async def get_by_id(\n        self,\n        product_id: str,\n        organization_id: str\n    ) -> Product:\n        return await self.db.query(Product).filter(\n            Product.id == product_id,\n            Product.organization_id == organization_id\n        ).first()\n\n    async def create(self, product: Product) -> Product:\n        self.db.add(product)\n        await self.db.commit()\n        await self.db.refresh(product)\n        return product\n\n# Service usando repository\nclass ProductService:\n    def __init__(self, repo: ProductRepository):\n        self.repo = repo\n\n    async def get_product(\n        self,\n        product_id: str,\n        user: User\n    ) -> Product:\n        product = await self.repo.get_by_id(\n            product_id,\n            user.organization_id\n        )\n        if not product:\n            raise NotFoundError("Producto no encontrado")\n        return product\n'})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Beneficios"}),":"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\u2705 Testeable (f\xe1cil mockear repositorio)"}),"\n",(0,s.jsx)(n.li,{children:"\u2705 Cambio de BD simplificado"}),"\n",(0,s.jsx)(n.li,{children:"\u2705 Separaci\xf3n de responsabilidades"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"5-service-layer",children:"5. Service Layer"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Descripci\xf3n"}),": Capa intermedia que contiene l\xf3gica de negocio."]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Estructura"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"API Layer (FastAPI)\n    \u2193\nService Layer (L\xf3gica de negocio)\n    \u2193\nRepository Layer (Acceso a datos)\n    \u2193\nDatabase\n"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Implementaci\xf3n"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:'# Service con l\xf3gica de negocio\nclass OrderService:\n    def __init__(\n        self,\n        order_repo: OrderRepository,\n        inventory_service: InventoryService,\n        catalog_service: CatalogService\n    ):\n        self.order_repo = order_repo\n        self.inventory = inventory_service\n        self.catalog = catalog_service\n\n    async def create_order(\n        self,\n        data: OrderCreate,\n        user: User\n    ) -> Order:\n        # 1. Validar productos existen\n        for item in data.items:\n            product = await self.catalog.get_product(item.product_id)\n            if not product:\n                raise ValidationError(f"Producto {item.product_id} no existe")\n\n        # 2. Validar stock disponible\n        for item in data.items:\n            available = await self.inventory.check_stock(\n                item.variant_id,\n                item.quantity\n            )\n            if not available:\n                raise ValidationError(f"Stock insuficiente para {item.variant_id}")\n\n        # 3. Reservar stock\n        for item in data.items:\n            await self.inventory.reserve_stock(\n                item.variant_id,\n                item.quantity,\n                order_id=order.id\n            )\n\n        # 4. Crear orden\n        order = Order(**data.dict(), user_id=user.id)\n        order = await self.order_repo.create(order)\n\n        # 5. Publicar evento\n        await self.event_publisher.publish(\n            "order.created",\n            {"order_id": order.id}\n        )\n\n        return order\n'})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Beneficios"}),":"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\u2705 L\xf3gica centralizada"}),"\n",(0,s.jsx)(n.li,{children:"\u2705 Reutilizable"}),"\n",(0,s.jsx)(n.li,{children:"\u2705 Testeable"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"6-dependency-injection",children:"6. Dependency Injection"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Descripci\xf3n"}),": Inyectar dependencias en lugar de crearlas internamente."]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Implementaci\xf3n"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:'from fastapi import Depends\n\n# Dependency providers\ndef get_db() -> Session:\n    db = SessionLocal()\n    try:\n        yield db\n    finally:\n        db.close()\n\ndef get_product_repository(\n    db: Session = Depends(get_db)\n) -> ProductRepository:\n    return ProductRepository(db)\n\ndef get_product_service(\n    repo: ProductRepository = Depends(get_product_repository),\n    event_publisher: EventPublisher = Depends(get_event_publisher)\n) -> ProductService:\n    return ProductService(repo, event_publisher)\n\n# Endpoint con DI\n@router.get("/products/{product_id}")\nasync def get_product(\n    product_id: str,\n    service: ProductService = Depends(get_product_service),\n    user: User = Depends(get_current_user)\n):\n    return await service.get_product(product_id, user)\n'})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Beneficios"}),":"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\u2705 Testeable (inyectar mocks)"}),"\n",(0,s.jsx)(n.li,{children:"\u2705 Desacoplamiento"}),"\n",(0,s.jsx)(n.li,{children:"\u2705 Configuraci\xf3n centralizada"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"patrones-de-resilencia",children:"Patrones de Resilencia"}),"\n",(0,s.jsx)(n.h3,{id:"7-circuit-breaker",children:"7. Circuit Breaker"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Descripci\xf3n"}),": Prevenir llamadas a servicios que est\xe1n fallando."]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Estados"}),":"]}),"\n",(0,s.jsx)(n.mermaid,{value:"stateDiagram-v2\n    [*] --\x3e Closed: Estado inicial\n    Closed --\x3e Open: N errores consecutivos\n    Open --\x3e HalfOpen: Timeout\n    HalfOpen --\x3e Closed: Request exitoso\n    HalfOpen --\x3e Open: Request falla"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Implementaci\xf3n"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:'from pybreaker import CircuitBreaker\n\n# Configuraci\xf3n\nauth_breaker = CircuitBreaker(\n    fail_max=5,           # Abrir tras 5 fallos\n    timeout_duration=60,  # Reintento en 60s\n    expected_exception=ServiceUnavailableError\n)\n\n# Uso\n@auth_breaker\nasync def verify_token_grpc(token: str):\n    """\n    Llamada protegida por circuit breaker\n    """\n    try:\n        return await auth_grpc_client.verify(token)\n    except grpc.RpcError as e:\n        raise ServiceUnavailableError("Auth Service unavailable")\n'})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Beneficios"}),":"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\u2705 Previene cascading failures"}),"\n",(0,s.jsx)(n.li,{children:"\u2705 Fail fast"}),"\n",(0,s.jsx)(n.li,{children:"\u2705 Auto-recovery"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"8-retry-con-backoff-exponencial",children:"8. Retry con Backoff Exponencial"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Descripci\xf3n"}),": Reintentar operaciones fallidas con delays crecientes."]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Implementaci\xf3n"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:'from tenacity import retry, stop_after_attempt, wait_exponential\n\n@retry(\n    stop=stop_after_attempt(3),\n    wait=wait_exponential(multiplier=1, min=1, max=10),\n    reraise=True\n)\nasync def call_external_api():\n    """\n    Intenta 3 veces con delays de 1s, 2s, 4s\n    """\n    response = await httpx.get("https://api.external.com")\n    response.raise_for_status()\n    return response.json()\n'})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Beneficios"}),":"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\u2705 Tolera fallos transitorios"}),"\n",(0,s.jsx)(n.li,{children:"\u2705 No sobrecarga servicios"}),"\n",(0,s.jsx)(n.li,{children:"\u2705 Configurable"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"9-fallback",children:"9. Fallback"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Descripci\xf3n"}),": Proveer alternativa cuando servicio principal falla."]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Implementaci\xf3n"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:'async def verify_token(token: str):\n    """\n    Intenta gRPC, fallback a REST\n    """\n    try:\n        # Primero gRPC (m\xe1s r\xe1pido)\n        return await auth_grpc_client.verify(token)\n    except grpc.RpcError:\n        logger.warning("gRPC failed, falling back to REST")\n        # Fallback a REST\n        return await auth_rest_client.verify(token)\n    except Exception:\n        # Fallback a cache (si existe)\n        cached = await cache.get(f"token:{token}")\n        if cached:\n            logger.warning("Using cached token verification")\n            return cached\n        raise\n'})}),"\n",(0,s.jsx)(n.h2,{id:"patrones-de-datos",children:"Patrones de Datos"}),"\n",(0,s.jsx)(n.h3,{id:"10-cache-aside",children:"10. Cache-Aside"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Descripci\xf3n"}),": Leer de cache primero, si no existe leer de BD y cachear."]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Implementaci\xf3n"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:'async def get_product(product_id: str, org_id: str):\n    """\n    Cache-aside pattern\n    """\n    cache_key = f"product:{org_id}:{product_id}"\n\n    # 1. Intentar leer de cache\n    cached = await redis.get(cache_key)\n    if cached:\n        return json.loads(cached)\n\n    # 2. Si no existe, leer de BD\n    product = await db.query(Product).filter(\n        Product.id == product_id,\n        Product.organization_id == org_id\n    ).first()\n\n    if not product:\n        raise NotFoundError()\n\n    # 3. Guardar en cache\n    await redis.setex(\n        cache_key,\n        300,  # TTL 5 minutos\n        json.dumps(product.dict())\n    )\n\n    return product\n'})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Invalidaci\xf3n de cache"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:'async def update_product(product_id: str, data: ProductUpdate):\n    # 1. Actualizar en BD\n    product = await db.update(product_id, data)\n\n    # 2. Invalidar cache\n    cache_key = f"product:{product.organization_id}:{product_id}"\n    await redis.delete(cache_key)\n\n    return product\n'})}),"\n",(0,s.jsx)(n.h3,{id:"11-unit-of-work",children:"11. Unit of Work"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Descripci\xf3n"}),": Agrupar operaciones de BD en una transacci\xf3n."]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Implementaci\xf3n"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"class UnitOfWork:\n    def __init__(self, session: Session):\n        self.session = session\n        self._committed = False\n\n    async def __aenter__(self):\n        return self\n\n    async def __aexit__(self, exc_type, exc_val, exc_tb):\n        if exc_type is None:\n            await self.commit()\n        else:\n            await self.rollback()\n\n    async def commit(self):\n        await self.session.commit()\n        self._committed = True\n\n    async def rollback(self):\n        await self.session.rollback()\n\n# Uso\nasync def transfer_stock(\n    from_local: str,\n    to_local: str,\n    variant_id: str,\n    quantity: int\n):\n    async with UnitOfWork(db) as uow:\n        # Todas estas operaciones en una transacci\xf3n\n        await inventory_repo.decrease_stock(from_local, variant_id, quantity)\n        await inventory_repo.increase_stock(to_local, variant_id, quantity)\n        await movement_repo.create_transfer(from_local, to_local, variant_id, quantity)\n        # Si cualquier operaci\xf3n falla, rollback autom\xe1tico\n"})}),"\n",(0,s.jsx)(n.h3,{id:"12-event-sourcing-parcial",children:"12. Event Sourcing (Parcial)"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Descripci\xf3n"}),": Almacenar eventos en lugar de estado actual."]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Implementaci\xf3n"})," (en Audit Service):"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:'# En lugar de guardar solo el estado actual\n# Guardamos cada evento que ocurre\nevents = [\n    {"event": "product.created", "data": {...}, "timestamp": "..."},\n    {"event": "product.price_updated", "old": 10, "new": 15, "timestamp": "..."},\n    {"event": "product.deactivated", "timestamp": "..."}\n]\n\n# Podemos reconstruir el estado en cualquier momento\ndef rebuild_product_state(product_id: str):\n    events = get_all_events(product_id)\n    state = {}\n    for event in events:\n        state = apply_event(state, event)\n    return state\n'})}),"\n",(0,s.jsx)(n.h2,{id:"patrones-de-integraci\xf3n",children:"Patrones de Integraci\xf3n"}),"\n",(0,s.jsx)(n.h3,{id:"13-adapter-pattern",children:"13. Adapter Pattern"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Descripci\xf3n"}),": Adaptar interfaces incompatibles."]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Implementaci\xf3n"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:'# Interfaz com\xfan\nclass AuthClientInterface(ABC):\n    @abstractmethod\n    async def verify_token(self, token: str) -> User:\n        pass\n\n# Adapter para gRPC\nclass AuthGrpcAdapter(AuthClientInterface):\n    def __init__(self, grpc_client):\n        self.client = grpc_client\n\n    async def verify_token(self, token: str) -> User:\n        response = await self.client.VerifyToken(token)\n        return User(\n            id=response.user_id,\n            email=response.email,\n            permissions=list(response.permissions)\n        )\n\n# Adapter para REST\nclass AuthRestAdapter(AuthClientInterface):\n    def __init__(self, http_client):\n        self.client = http_client\n\n    async def verify_token(self, token: str) -> User:\n        response = await self.client.post("/verify", json={"token": token})\n        data = response.json()\n        return User(**data["user"])\n\n# Service usa interfaz com\xfan\nclass ProductService:\n    def __init__(self, auth_client: AuthClientInterface):\n        self.auth = auth_client\n\n    async def get_product(self, token: str, product_id: str):\n        user = await self.auth.verify_token(token)\n        # ... resto de l\xf3gica\n'})}),"\n",(0,s.jsx)(n.h3,{id:"14-saga-pattern-futuro",children:"14. Saga Pattern (Futuro)"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Descripci\xf3n"}),": Transacciones distribuidas mediante eventos compensatorios."]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Ejemplo conceptual"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"# Crear orden (happy path)\n1. Order Service: Crear orden \u2192 OK\n2. Inventory Service: Reservar stock \u2192 OK\n3. Payment Service: Procesar pago \u2192 OK\n4. Order Service: Confirmar orden \u2192 OK\n\n# Crear orden (con error en pago)\n1. Order Service: Crear orden \u2192 OK\n2. Inventory Service: Reservar stock \u2192 OK\n3. Payment Service: Procesar pago \u2192 ERROR\n4. Inventory Service: Liberar stock (compensaci\xf3n)\n5. Order Service: Cancelar orden (compensaci\xf3n)\n"})}),"\n",(0,s.jsx)(n.h2,{id:"patrones-de-api",children:"Patrones de API"}),"\n",(0,s.jsx)(n.h3,{id:"15-cursor-pagination",children:"15. Cursor Pagination"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Descripci\xf3n"}),": Paginaci\xf3n eficiente basada en cursors en lugar de offset."]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Implementaci\xf3n"}),": Ver ",(0,s.jsx)(n.a,{href:"/decisiones-arquitectura/adr-007-cursor-pagination",children:"ADR-007"})]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'{\n  "edges": [\n    {"cursor": "Y3Vyc29yX3Byb2RfMDAx", "node": {...}},\n    {"cursor": "Y3Vyc29yX3Byb2RfMDAy", "node": {...}}\n  ],\n  "pageInfo": {\n    "hasNextPage": true,\n    "hasPreviousPage": false,\n    "startCursor": "Y3Vyc29yX3Byb2RfMDAx",\n    "endCursor": "Y3Vyc29yX3Byb2RfMDAy"\n  }\n}\n'})}),"\n",(0,s.jsx)(n.h3,{id:"16-api-versioning",children:"16. API Versioning"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Descripci\xf3n"}),": Mantener compatibilidad mientras evoluciona la API."]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Implementaci\xf3n"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:'# v1\n@router.get("/api/v1/products")\nasync def list_products_v1():\n    return {"products": [...]}\n\n# v2 con cambios\n@router.get("/api/v2/products")\nasync def list_products_v2():\n    return {\n        "data": {\n            "products": {\n                "edges": [...],\n                "pageInfo": {...}\n            }\n        }\n    }\n'})}),"\n",(0,s.jsx)(n.h2,{id:"tabla-resumen-de-patrones",children:"Tabla Resumen de Patrones"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Patr\xf3n"}),(0,s.jsx)(n.th,{children:"Categor\xeda"}),(0,s.jsx)(n.th,{children:"Usado en"}),(0,s.jsx)(n.th,{children:"Beneficio Principal"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Microservicios"}),(0,s.jsx)(n.td,{children:"Arquitectura"}),(0,s.jsx)(n.td,{children:"Todo el sistema"}),(0,s.jsx)(n.td,{children:"Escalabilidad independiente"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Event-Driven"}),(0,s.jsx)(n.td,{children:"Arquitectura"}),(0,s.jsx)(n.td,{children:"Auth, Catalog, Audit"}),(0,s.jsx)(n.td,{children:"Desacoplamiento"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"API Gateway"}),(0,s.jsx)(n.td,{children:"Arquitectura"}),(0,s.jsx)(n.td,{children:"Entry point"}),(0,s.jsx)(n.td,{children:"Centralizaci\xf3n"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Repository"}),(0,s.jsx)(n.td,{children:"Aplicaci\xf3n"}),(0,s.jsx)(n.td,{children:"Todos los servicios"}),(0,s.jsx)(n.td,{children:"Abstracci\xf3n de datos"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Service Layer"}),(0,s.jsx)(n.td,{children:"Aplicaci\xf3n"}),(0,s.jsx)(n.td,{children:"Todos los servicios"}),(0,s.jsx)(n.td,{children:"L\xf3gica de negocio"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Dependency Injection"}),(0,s.jsx)(n.td,{children:"Aplicaci\xf3n"}),(0,s.jsx)(n.td,{children:"FastAPI"}),(0,s.jsx)(n.td,{children:"Testabilidad"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Circuit Breaker"}),(0,s.jsx)(n.td,{children:"Resilencia"}),(0,s.jsx)(n.td,{children:"Catalog \u2194 Auth"}),(0,s.jsx)(n.td,{children:"Prevenir fallos en cascada"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Retry"}),(0,s.jsx)(n.td,{children:"Resilencia"}),(0,s.jsx)(n.td,{children:"Llamadas externas"}),(0,s.jsx)(n.td,{children:"Tolerar fallos transitorios"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Fallback"}),(0,s.jsx)(n.td,{children:"Resilencia"}),(0,s.jsx)(n.td,{children:"gRPC \u2192 REST"}),(0,s.jsx)(n.td,{children:"Alta disponibilidad"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Cache-Aside"}),(0,s.jsx)(n.td,{children:"Datos"}),(0,s.jsx)(n.td,{children:"Catalog, Auth"}),(0,s.jsx)(n.td,{children:"Performance"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Unit of Work"}),(0,s.jsx)(n.td,{children:"Datos"}),(0,s.jsx)(n.td,{children:"Transacciones"}),(0,s.jsx)(n.td,{children:"Consistencia"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Event Sourcing"}),(0,s.jsx)(n.td,{children:"Datos"}),(0,s.jsx)(n.td,{children:"Audit Service"}),(0,s.jsx)(n.td,{children:"Trazabilidad completa"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Adapter"}),(0,s.jsx)(n.td,{children:"Integraci\xf3n"}),(0,s.jsx)(n.td,{children:"Auth clients"}),(0,s.jsx)(n.td,{children:"Interfaces compatibles"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Cursor Pagination"}),(0,s.jsx)(n.td,{children:"API"}),(0,s.jsx)(n.td,{children:"Todas las APIs"}),(0,s.jsx)(n.td,{children:"Performance en paginaci\xf3n"})]})]})]}),"\n",(0,s.jsx)(n.h2,{id:"pr\xf3ximos-pasos",children:"Pr\xf3ximos Pasos"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"/microservicios/auth-service/overview",children:"Auth Service"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"/microservicios/catalog-service/overview",children:"Catalog Service"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"/decisiones-arquitectura/00-introduccion-adrs",children:"Decisiones de Arquitectura"})}),"\n"]})]})}function p(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(l,{...e})}):l(e)}},8453:(e,n,r)=>{r.d(n,{R:()=>a,x:()=>c});var i=r(6540);const s={},t=i.createContext(s);function a(e){const n=i.useContext(t);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:a(e.components),i.createElement(t.Provider,{value:n},e.children)}}}]);