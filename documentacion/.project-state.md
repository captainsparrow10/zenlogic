# Estado del Proyecto de Documentaci√≥n zenLogic

**Fecha:** 2025-11-23
**Progreso:** 48/73 archivos (66%)
**URL:** http://localhost:3000

## Decisiones Arquitect√≥nicas Tomadas

### Soluciones Implementadas (Seleccionadas por el usuario)

1. **Event-Driven Architecture**: Opci√≥n A - Event-Driven Granular
   - Eventos espec√≠ficos por cada cambio
   - RabbitMQ con exchanges topic
   - Routing keys espec√≠ficos

2. **Audit Service**: Opci√≥n A - Audit Service Independiente
   - Microservicio separado para auditor√≠a
   - Consume todos los eventos del sistema
   - PostgreSQL para almacenamiento de logs

3. **Validaci√≥n de Locales**: Opci√≥n A - Middleware de Validaci√≥n
   - Validaci√≥n centralizada en middleware
   - Cache en Redis
   - Sincronizaci√≥n v√≠a eventos

4. **Comunicaci√≥n**: Opci√≥n C - H√≠brido REST + gRPC
   - REST para clientes externos
   - gRPC para comunicaci√≥n entre microservicios
   - Fallback de gRPC a REST

### Formato de Documentaci√≥n

- **Nombre del Proyecto**: zenLogic
- **Herramienta**: Docusaurus 3.1.0
- **Idioma**: Espa√±ol
- **Formato**: ADRs (Architecture Decision Records)
- **Audiencia**: Mixta (acad√©mica + t√©cnica)
- **Ubicaci√≥n**: `/Users/sparrow/Universidad/ERP/documentacion/`

## Estructura de Archivos (73 totales)

### ‚úÖ Completados (48 archivos - 66%)

#### 1. Introducci√≥n (1 archivo)
- ‚úÖ `intro.md`

#### 2. Arquitectura General (7 archivos)
- ‚úÖ `01-arquitectura/00-vision-general.md`
- ‚úÖ `01-arquitectura/01-stack-tecnologico.md`
- ‚úÖ `01-arquitectura/02-arquitectura-event-driven.md`
- ‚úÖ `01-arquitectura/03-comunicacion-microservicios.md`
- ‚úÖ `01-arquitectura/04-multi-tenancy.md`
- ‚úÖ `01-arquitectura/05-seguridad-rbac.md`
- ‚úÖ `01-arquitectura/06-patrones-diseno.md`

#### 3. Auth Service (14 archivos) ‚úÖ COMPLETO
- ‚úÖ `02-microservicios/auth-service/00-overview.md`
- ‚úÖ `02-microservicios/auth-service/01-alcance.md`
- ‚úÖ `02-microservicios/auth-service/02-arquitectura.md`
- ‚úÖ `02-microservicios/auth-service/03-modelo-datos.md`
- ‚úÖ `02-microservicios/auth-service/04-configuracion.md`
- ‚úÖ `02-microservicios/auth-service/05-eventos-publicados.md`
- ‚úÖ `02-microservicios/auth-service/06-grpc-server.md`
- ‚úÖ `02-microservicios/auth-service/07-api-auth.md`
- ‚úÖ `02-microservicios/auth-service/08-api-users.md`
- ‚úÖ `02-microservicios/auth-service/09-api-roles.md`
- ‚úÖ `02-microservicios/auth-service/10-api-permissions.md`
- ‚úÖ `02-microservicios/auth-service/11-api-locals.md`
- ‚úÖ `02-microservicios/auth-service/12-api-organizations.md`
- ‚úÖ `02-microservicios/auth-service/13-flujos-negocio.md`

#### 4. Catalog Service (18 archivos) ‚úÖ COMPLETO
- ‚úÖ `02-microservicios/catalog-service/00-overview.md`
- ‚úÖ `02-microservicios/catalog-service/01-alcance.md`
- ‚úÖ `02-microservicios/catalog-service/02-arquitectura.md`
- ‚úÖ `02-microservicios/catalog-service/03-modelo-datos.md`
- ‚úÖ `02-microservicios/catalog-service/04-configuracion.md`
- ‚úÖ `02-microservicios/catalog-service/05-eventos-publicados.md`
- ‚úÖ `02-microservicios/catalog-service/06-eventos-consumidos.md`
- ‚úÖ `02-microservicios/catalog-service/07-validacion-locales.md`
- ‚úÖ `02-microservicios/catalog-service/08-auth-client-grpc.md`
- ‚úÖ `02-microservicios/catalog-service/09-api-products.md`
- ‚úÖ `02-microservicios/catalog-service/10-api-variants.md`
- ‚úÖ `02-microservicios/catalog-service/11-api-options.md`
- ‚úÖ `02-microservicios/catalog-service/12-paginacion-cursor.md`
- ‚úÖ `02-microservicios/catalog-service/13-cache-strategy.md`
- ‚úÖ `02-microservicios/catalog-service/14-flujos-negocio.md`
- ‚úÖ `02-microservicios/catalog-service/15-testing.md`
- ‚úÖ `02-microservicios/catalog-service/16-errores-comunes.md`
- ‚úÖ `02-microservicios/catalog-service/17-migraciones.md`

#### 5. Audit Service (8 archivos) ‚úÖ COMPLETO
- ‚úÖ `02-microservicios/audit-service/00-overview.md`
- ‚úÖ `02-microservicios/audit-service/01-alcance.md`
- ‚úÖ `02-microservicios/audit-service/02-arquitectura.md`
- ‚úÖ `02-microservicios/audit-service/03-modelo-datos.md`
- ‚úÖ `02-microservicios/audit-service/04-event-consumer.md`
- ‚úÖ `02-microservicios/audit-service/05-api-logs.md`
- ‚úÖ `02-microservicios/audit-service/06-retention-policy.md`
- ‚úÖ `02-microservicios/audit-service/07-queries-comunes.md`

### ‚è≥ Pendientes (25 archivos - 34%)

#### ADRs (8 archivos)
- ‚è≥ `03-decisiones-arquitectura/00-introduccion-adrs.md`
- ‚è≥ `03-decisiones-arquitectura/adr-001-python-fastapi.md`
- ‚è≥ `03-decisiones-arquitectura/adr-002-postgresql.md`
- ‚è≥ `03-decisiones-arquitectura/adr-003-event-driven.md`
- ‚è≥ `03-decisiones-arquitectura/adr-004-grpc-internal.md`
- ‚è≥ `03-decisiones-arquitectura/adr-005-rbac-multinivel.md`
- ‚è≥ `03-decisiones-arquitectura/adr-006-postgresql-multi-tenant.md`
- ‚è≥ `03-decisiones-arquitectura/adr-007-cursor-pagination.md`

#### Integraciones (5 archivos)
- ‚è≥ `04-integraciones/00-overview.md`
- ‚è≥ `04-integraciones/01-rabbitmq.md`
- ‚è≥ `04-integraciones/02-redis.md`
- ‚è≥ `04-integraciones/03-grpc.md`
- ‚è≥ `04-integraciones/04-postgresql.md`

#### Gu√≠as (5 archivos)
- ‚è≥ `05-guias/00-setup-local.md`
- ‚è≥ `05-guias/01-crear-microservicio.md`
- ‚è≥ `05-guias/02-testing.md`
- ‚è≥ `05-guias/03-deployment.md`
- ‚è≥ `05-guias/04-troubleshooting.md`

#### Anexos (4 archivos)
- ‚è≥ `06-anexos/00-glosario.md`
- ‚è≥ `06-anexos/01-convenciones.md`
- ‚è≥ `06-anexos/02-referencias.md`
- ‚è≥ `06-anexos/03-diagramas.md`

#### Testing (3 archivos)
- ‚è≥ Verificaci√≥n de links internos
- ‚è≥ Verificaci√≥n de diagramas Mermaid
- ‚è≥ Testing de navegaci√≥n

## Configuraci√≥n T√©cnica

### Docusaurus Config

**Archivo**: `documentacion/docusaurus.config.js`

```javascript
{
  title: 'zenLogic',
  tagline: 'Sistema ERP empresarial con arquitectura de microservicios',
  i18n: {
    defaultLocale: 'es',
    locales: ['es'],
  },
  markdown: {
    mermaid: true,
  },
  themes: ['@docusaurus/theme-mermaid'],
}
```

### Sidebars

**Archivo**: `documentacion/sidebars.js`

Configurado con:
- üìê Arquitectura General (7 archivos) - collapsed: false
- üîß Microservicios - collapsed: false
  - Auth Service (14 archivos) - collapsed: true ‚úÖ
  - Catalog Service (18 archivos) - collapsed: true ‚úÖ
  - Audit Service (8 archivos) - collapsed: true ‚úÖ

### Package.json

```json
{
  "name": "erp-docs",
  "scripts": {
    "start": "docusaurus start",
    "build": "docusaurus build"
  },
  "dependencies": {
    "@docusaurus/core": "^3.1.0",
    "@docusaurus/preset-classic": "^3.1.0",
    "@docusaurus/theme-mermaid": "^3.1.0"
  }
}
```

## Stack Tecnol√≥gico del ERP

### Microservicios
- **Lenguaje**: Python 3.11
- **Framework**: FastAPI
- **ORM**: SQLAlchemy 2.0 (async)
- **Validaci√≥n**: Pydantic v2

### Infraestructura
- **Base de Datos**: PostgreSQL 15+
- **Cache**: Redis 7.0
- **Message Broker**: RabbitMQ
- **Comunicaci√≥n Interna**: gRPC
- **Comunicaci√≥n Externa**: REST

### Seguridad
- **Autenticaci√≥n**: JWT (RS256)
- **Autorizaci√≥n**: RBAC multinivel
- **Password Hashing**: bcrypt
- **Access Token TTL**: 15 minutos
- **Refresh Token TTL**: 7 d√≠as

### Multi-tenancy
- **Estrategia**: Row-level isolation
- **Filtro**: `organization_id` en todas las tablas
- **Validaci√≥n**: Header `X-Tenant-ID` obligatorio

## Microservicios Documentados

### 1. Auth Service (Puerto 8001, gRPC 50051) ‚úÖ

**Responsabilidades**:
- Identity Management (usuarios, roles, permisos)
- Authentication (login, tokens)
- Authorization (RBAC)
- Gesti√≥n de organizaciones y locales
- Token Service (JWT RS256)

**Base de Datos**: `erp_auth`

**Eventos Publicados**: 21 eventos
- `auth.user.*` (5 eventos)
- `auth.role.*` (3 eventos)
- `auth.organization.*` (6 eventos)
- `auth.local.*` (3 eventos)
- `auth.session.*` (2 eventos)

**APIs**:
- REST: `/auth/*`, `/api/v1/users`, `/api/v1/roles`, etc.
- gRPC: `VerifyToken`, `GetUserPermissions`, `CheckPermission`, `GetOrganization`

### 2. Catalog Service (Puerto 8002) ‚úÖ

**Responsabilidades**:
- Gesti√≥n de productos
- Gesti√≥n de variantes
- Gesti√≥n de opciones (Color, Talla, etc.)
- Validaci√≥n de locales (v√≠a Auth Service)

**Base de Datos**: `erp_catalog`

**Eventos Publicados**:
- `catalog.product.*` (5 eventos)
- `catalog.variant.*` (3 eventos)
- `catalog.option.*` (3 eventos)

**Eventos Consumidos**:
- `auth.user.deactivated`
- `auth.local.*`
- `auth.organization.suspended`

**APIs**:
- REST: `/api/v1/products`, `/api/v1/variants`, `/api/v1/options`

**Features**:
- Paginaci√≥n estilo Shopify (cursor-based)
- Circuit Breaker para gRPC
- Cache con Redis (TTL configurables)
- Middleware de validaci√≥n de locales

### 3. Audit Service (Puerto 8003) ‚úÖ

**Responsabilidades**:
- Consumir todos los eventos del sistema
- Almacenar logs de auditor√≠a inmutables
- Proporcionar API de consulta de logs
- Gestionar retenci√≥n de datos (90 d√≠as activos, 2 a√±os archivados)

**Base de Datos**: `erp_audit`

**Eventos Consumidos**: Todos (wildcard `#`)

**APIs**:
- REST: `/api/v1/logs`, `/api/v1/logs/timeline`, `/api/v1/logs/stats`

**Features**:
- Particionamiento por mes
- Inmutabilidad (triggers que previenen UPDATE/DELETE)
- Retention policy autom√°tico
- Archivado a S3
- Queries optimizadas con √≠ndices GIN para JSONB

## Patrones de Dise√±o Implementados

1. **Microservicios** - Arquitectura base
2. **Event-Driven Architecture** - Comunicaci√≥n as√≠ncrona
3. **API Gateway** - Punto de entrada √∫nico (futuro)
4. **Repository Pattern** - Abstracci√≥n de datos
5. **Service Layer** - L√≥gica de negocio
6. **Dependency Injection** - FastAPI Depends
7. **Circuit Breaker** - Resiliencia en llamadas gRPC
8. **Retry con Backoff Exponencial** - Tolerancia a fallos
9. **Fallback** - gRPC ‚Üí REST
10. **Cache-Aside** - Redis para performance
11. **Unit of Work** - Transacciones
12. **Event Sourcing** (Parcial en Audit)
13. **Adapter Pattern** - Auth clients
14. **Cursor Pagination** - Estilo Shopify
15. **API Versioning** - `/api/v1/*`
16. **CQRS** - Separaci√≥n read/write en Audit Service

## Comandos √ötiles

### Desarrollo
```bash
cd documentacion
npm start  # http://localhost:3000
npm run build  # Compilar para producci√≥n
```

### Limpiar Cache
```bash
rm -rf .docusaurus node_modules/.cache
npm start
```

### Docker
```bash
docker-compose up -d postgres redis rabbitmq
```

### Migraciones (Alembic)
```bash
alembic revision --autogenerate -m "mensaje"
alembic upgrade head
```

## URLs Importantes

- **Docs**: http://localhost:3000
- **RabbitMQ Management**: http://localhost:15672 (guest/guest)
- **Auth Service REST**: http://localhost:8001
- **Auth Service gRPC**: grpc://localhost:50051
- **Catalog Service REST**: http://localhost:8002
- **Audit Service REST**: http://localhost:8003

## Progreso de Tareas

- [x] Inicializar Docusaurus
- [x] Configurar Docusaurus
- [x] Crear estructura de carpetas
- [x] Generar documentaci√≥n Arquitectura (7/7)
- [x] Verificar Docusaurus funcionando
- [x] Generar documentaci√≥n Auth Service (14/14)
- [x] Generar documentaci√≥n Catalog Service (18/18)
- [x] Generar documentaci√≥n Audit Service (8/8)
- [x] Actualizar sidebars.js con todos los servicios
- [x] Corregir links en intro.md
- [x] Limpiar cache de Docusaurus
- [ ] Generar ADRs (0/8)
- [ ] Generar documentaci√≥n Integraciones (0/5)
- [ ] Generar documentaci√≥n Gu√≠as (0/5)
- [ ] Generar documentaci√≥n Anexos (0/4)
- [ ] Testing y verificaci√≥n

## Notas T√©cnicas Importantes

### Convenciones de Nombres de Archivos

**Carpetas principales**: Usan prefijo num√©rico `NN-nombre/`
```
‚úÖ 01-arquitectura/
‚úÖ 02-microservicios/
‚úÖ 03-decisiones-arquitectura/
```

**Archivos**: Usan prefijo num√©rico `NN-nombre.md`
```
‚úÖ 00-overview.md
‚úÖ 01-alcance.md
‚úÖ 07-api-auth.md
```

**Subcarpetas de servicios**: NO usan prefijo num√©rico
```
‚úÖ auth-service/
‚úÖ catalog-service/
‚úÖ audit-service/
```

**IDs de Docusaurus**: Sin prefijos num√©ricos
```
Archivo: 02-microservicios/auth-service/07-api-auth.md
ID: microservicios/auth-service/api-auth
```

### Multi-tenancy
- **SIEMPRE** filtrar por `organization_id` en queries
- **NUNCA** hacer queries sin filtro de tenant
- Header `X-Tenant-ID` debe coincidir con token JWT

### Eventos
- Formato est√°ndar con `event_type`, `timestamp`, `service`, `payload`
- Exchange: `{service}_events` (topic)
- Routing keys: `{service}.{entity}.{action}`

### gRPC
- Usar Circuit Breaker
- Implementar fallback a REST
- Timeout: 5 segundos
- Cache de responses: 5 minutos

### Cache
- TTL por defecto: 5 minutos (300s)
- Invalidar en cada UPDATE/DELETE
- Pattern: `{entity}:{org_id}:{entity_id}`

### JWT
- Access Token: 15 min
- Refresh Token: 7 d√≠as
- Algoritmo: RS256 (claves en `/keys`)
- Claims obligatorios: `user_id`, `organization_id`, `permissions`, `locals`

## Problemas Resueltos

### 1. Links Rotos (2025-11-23)
**Problema**: Intro.md ten√≠a links a p√°ginas que no existen (guias, anexos, etc.)
**Soluci√≥n**: Actualizado intro.md para mostrar solo links existentes y marcar secciones futuras como "Pr√≥ximamente"

### 2. Cache Viejo de Docusaurus (2025-11-23)
**Problema**: Sidebar no aparec√≠a en algunas p√°ginas debido a cache viejo
**Soluci√≥n**: `rm -rf .docusaurus node_modules/.cache && npm start`

### 3. Sidebar con IDs Incorrectos (2025-11-23)
**Problema**: Error mostrando IDs con prefijos num√©ricos vs IDs sin prefijos
**Soluci√≥n**: Cache viejo - limpiar cache resolvi√≥ el problema

## Pr√≥ximos Pasos Inmediatos

1. ‚è≥ Crear documentaci√≥n ADRs (8 archivos)
2. ‚è≥ Crear documentaci√≥n Integraciones (5 archivos)
3. ‚è≥ Crear documentaci√≥n Gu√≠as (5 archivos)
4. ‚è≥ Crear documentaci√≥n Anexos (4 archivos)
5. ‚è≥ Testing de links y diagramas Mermaid
6. ‚è≥ Actualizar sidebar.js con nuevas secciones
7. ‚è≥ Verificaci√≥n final de coherencia

**√öltima actualizaci√≥n**: 2025-11-23 16:35 UTC
**Mantenido por**: Claude Code Agent
**Versi√≥n del Documento**: 2.0
